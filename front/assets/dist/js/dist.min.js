function allowPatternDirective(){return{restrict:"A",compile:function(t,e){return function(t,e,n){e.bind("keypress",function(t){var e=t.which||t.keyCode,i=String.fromCharCode(e);return i.match(new RegExp(n.allowPattern,"i"))?void 0:(t.preventDefault(),!1)})}}}}angular.module("edison",["chart.js","browserify","mm.iban","ui.slimscroll","ngMaterial","lumx","ngAnimate","xeditable","btford.socket-io","ngFileUpload","pickadate","ngRoute","ngResource","ngTable","ngMap"]).config(["$mdThemingProvider",function(t){"use strict";t.theme("default").primaryPalette("indigo").accentPalette("blue-grey")}]).run(["editableOptions",function(t){"use strict";t.theme="bs3"}]).run(["$templateCache","$route","$http",function(t,e,n){var i;for(var o in e.routes)(i=e.routes[o].templateUrl)&&n.get(i,{cache:t});n.get("/Directives/dropdown-row.html",{cache:t}),n.get("/Templates/artisan-categorie.html",{cache:t}),n.get("/Templates/info-client.html",{cache:t}),n.get("/Templates/info-categorie.html",{cache:t}),n.get("/Templates/autocomplete-map.html",{cache:t})}]).config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|callto|mailto|file|tel):/)}]),angular.module("edison").controller("MainController",["$timeout","LxNotificationService","dialog","$q","DataProvider","TabContainer","$scope","socket","config","$rootScope","$location","edisonAPI","taskList","$window",function(t,e,n,i,o,r,a,s,l,c,u,d,p,f){"use strict";c.app_users=app_users,c.displayUser=app_session,a.sidebarHeight=$("#main-menu-bg").height(),a.config=l,a._=_,c.loadingData=!0,c.$on("$routeChangeSuccess",function(){f.scrollTo(0,0),c.loadingData=!1});var m=this;c.toggleSidebar=function(t){c.sideBarMode===!0&&(c.sideBarIsClosed=t)},c.addIntervention=function(){"INTERVENTION"!==a.user.service||!a.userStats.i_avr.total||!a.userStats.i_avr.total||a.user.maxInterAverif>a.userStats.i_avr.total?u.url("/intervention"):e.error("Impossible: Vous avez dépasser votre quota d'intervention à vérifié ("+a.userStats.i_avr.total+" > "+a.user.maxInterAverif+")")},c.toggleSidebarMode=function(t){c.sideBarMode=_.isUndefined(t)?!c.sideBarMode:t,c.sideBarIsClosed=c.sideBarMode};var h=function(){return c.smallWin=window.innerWidth<1350,c.toggleSidebarMode(c.smallWin)};$(window).resize(h),h(),a.dateFormat=moment().format("llll").slice(0,-5),c.options={showMap:!0};var v=function(){d.signalement.stats().then(function(t){a.signalementStats=t.data})};v();var g=function(){d.stats.telepro().success(function(t){a.userStats=_.find(t,function(t){return t.login===a.user.login}),c.interventionsStats=t}),d.intervention.dashboardStats({date:moment().startOf("day").toDate()}).then(function(t){m.statsTeleproBfm=_.sortBy(t.data.weekStats,"total").reverse().slice(0,6)})};c.user=window.app_session,g(),s.on("filterStatsReload",_.debounce(g,_.random(0,1e3))),f.notify=function(){e.notify("test","android",!1,"red")},s.on("test",function(t){console.log(new Date,"notif test",t)}),s.on("notification",function(t){console.log("NOTIF",t),t.dest!==c.user.login||t.dest===t.origin&&!t.self||e.notify(t.message,t.icon||"android",!1,t.color),t.service&&t.service===c.user.service&&e.notify(t.message,t.icon||"android",!1,t.color)}),c.openTab=function(t){},c.closeContextMenu=function(t){c.$broadcast("closeContextMenu")};new o("devis"),new o("artisan"),new o("intervention");this.tabContainer=r,a.$on("$locationChangeStart",function(t){return _.includes(["/intervention","/devis","/artisan","/"],u.path())?0:void r.add(u).order()}),a.taskList=p,a.linkClick=function(t){t.preventDefault(),t.stopPropagation()},Mousetrap.bind(["command+i","ctrl+i"],function(){n.declareBug(m.tabContainer,function(t,n){d.bug.declare(n).then(function(){e.error("Le Serice informatique en a été prevenu")})})}),a.tabIconClick=function(t,e){t.preventDefault(),t.stopPropagation(),a.tabs.close(e)}}]);var getIntervention=function(t,e,n){"use strict";var i=t.current.params.id;if(t.current.params.d){var o=e.defer();return e.all([n.devis.get(t.current.params.d,{select:"date login produits tva client prixAnnonce categorie -_id"}),n.intervention.getTmp(0)]).then(function(t){o.resolve(_.merge(t[1],t[0]))}),o.promise}return i.length>10?n.intervention.getTmp(i):n.intervention.get(i,{populate:"sst"})};getIntervention.$inject=["$route","$q","edisonAPI"];var statsTelepro=function(t,e,n){return n.stats.telepro()};statsTelepro.$inject=["$route","$q","edisonAPI"];var getDevis=function(t,e,n){"use strict";var i=t.current.params.id;return t.current.params.i?n.intervention.get(t.current.params.i,{select:"client categorie tva -_id conversations"}):i.length>10?n.devis.getTmp(i):n.devis.get(i)};getDevis.$inject=["$route","$q","edisonAPI"];var getArtisan=function(t,e,n){"use strict";var i=t.current.params.id;return i.length>10?n.artisan.getTmp(i):n.artisan.get(i)};getArtisan.$inject=["$route","$q","edisonAPI"],angular.module("edison").config(["$routeProvider","$locationProvider",function(t,e){"use strict";t.when("/",{redirectTo:"/dashboard"}).when("/intervention/list",{templateUrl:"Pages/ListeInterventions/listeInterventions.html",controller:"ListeInterventionController",controllerAs:"vm",reloadOnSearch:!1}).when("/intervention/list/:fltr",{templateUrl:"Pages/ListeInterventions/listeInterventions.html",controller:"ListeInterventionController",controllerAs:"vm",reloadOnSearch:!1}).when("/intervention",{redirectTo:function(t,e,n){var i=n.devis?"?d="+n.devis:"";return"/intervention/"+Date.now()+i}}).when("/intervention/:id",{templateUrl:"Pages/Intervention/intervention.html",controller:"InterventionController",controllerAs:"vm",reloadOnSearch:!1,resolve:{interventionPrm:getIntervention}}).when("/devis/list",{templateUrl:"Pages/ListeDevis/listeDevis.html",controller:"ListeDevisController",controllerAs:"vm",reloadOnSearch:!1}).when("/devis/list/:fltr",{templateUrl:"Pages/ListeDevis/listeDevis.html",controller:"ListeDevisController",controllerAs:"vm",reloadOnSearch:!1}).when("/devis",{redirectTo:function(t,e,n){var i=n.i?"?i="+n.i:"";return"/devis/"+Date.now()+i}}).when("/devis/:id",{templateUrl:"Pages/Intervention/devis.html",controller:"DevisController",controllerAs:"vm",resolve:{devisPrm:getDevis}}).when("/artisan/contact",{templateUrl:"Pages/ListeArtisan/contactArtisan.html",controller:"ContactArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan/:sstid/recap",{templateUrl:"Pages/ListeArtisan/contactArtisan.html",controller:"ContactArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan/list",{templateUrl:"Pages/ListeArtisan/listeArtisan.html",controller:"ListeArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan/list/:fltr",{templateUrl:"Pages/ListeArtisan/listeArtisan.html",controller:"ListeArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan",{redirectTo:function(){return"/artisan/"+Date.now()}}).when("/artisan/:id",{templateUrl:"Pages/Artisan/artisan.html",controller:"ArtisanController",controllerAs:"vm",resolve:{artisanPrm:getArtisan}}).when("/dashboard",{controller:"DashboardController",templateUrl:"Pages/Dashboard/dashboard.html",controllerAs:"vm",resolve:{statsTelepro:statsTelepro}}).when("/search/:query",{templateUrl:"Pages/Search/search.html",controller:"SearchController",controllerAs:"vm"}).when("/compta/lpa",{templateUrl:"Pages/LPA/LPA.html",controller:"LpaController",controllerAs:"vm"}).when("/compta/avoirs",{templateUrl:"Pages/Avoirs/avoirs.html",controller:"avoirsController",controllerAs:"vm"}).when("/compta/archivesPaiement",{templateUrl:"Pages/Archives/archives.html",controller:"archivesPaiementController",controllerAs:"vm"}).when("/compta/archivesReglement",{templateUrl:"Pages/Archives/archives.html",controller:"archivesReglementController",controllerAs:"vm"}).when("/tools/telephoneMatch",{templateUrl:"Pages/Tools/telephoneMatch.html",controller:"telephoneMatch",controllerAs:"vm"}).when("/tools/editProducts",{templateUrl:"Pages/Tools/edit-products.html",controller:"editProducts",controllerAs:"vm"}).when("/tools/editSignalements",{templateUrl:"Pages/Tools/edit-signalements.html",controller:"editSignalements",controllerAs:"vm"}).when("/listeSignalements",{templateUrl:"Pages/ListeSignalements/liste-signalements.html",controller:"listeSignalements",controllerAs:"vm"}).when("/tools/editComptes",{templateUrl:"Pages/Tools/edit-comptes.html",controller:"editComptes",controllerAs:"vm"}).when("/tools/editCombos",{templateUrl:"Pages/Tools/edit-combos.html",controller:"editCombos",controllerAs:"vm"}).when("/tools/editUsers",{templateUrl:"Pages/Tools/edit-users.html",controller:"editUsers",controllerAs:"vm"}).when("/partenariat/comissions",{templateUrl:"Pages/Tools/commissions-partenariat.html",controller:"commissionsPartenariat",controllerAs:"vm"}).when("/tools/commissions",{templateUrl:"Pages/Tools/commissions.html",controller:"CommissionsController",controllerAs:"vm",reloadOnSearch:!1}).when("/stats/:type",{templateUrl:"Pages/Stats/stats.html",controller:"StatsController",controllerAs:"vm",reloadOnSearch:!1}).when("/statsnew/:type",{templateUrl:"Pages/Stats/stats-new.html",controller:"StatsNewController",controllerAs:"vm",reloadOnSearch:!1}).when("/user/history",{templateUrl:"Pages/User/historique.html",controller:"userHistory",controllerAs:"vm",reloadOnSearch:!1}).otherwise({redirectTo:"/dashboard"}),e.html5Mode(!0)}]),angular.module("edison").directive("absenceSst",["edisonAPI","LxNotificationService","user",function(t,e,n){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/absence-sst.html",scope:{data:"=",exit:"&"},link:function(n,i){n.absence={start:moment().add(-1,"hours").toDate(),end:moment().hour(23).minute(43).toDate()},n.save=function(){t.artisan.absence(n.data.id,n.absence).then(function(){e.success("L'absence à été enregistrer"),(n.exit||_.noop)()})}}}}]),angular.module("edison").directive("allowPattern",[allowPatternDirective]),angular.module("edison").directive("capitalize",function(){"use strict";return{require:"ngModel",link:function(t,e,n,i){i.$parsers.push(function(t){return"string"==typeof t?t.toUpperCase():""}),e.css("text-transform","uppercase")}}}),angular.module("edison").directive("creditcard",function(){"use strict";return{require:"ngModel",scope:{inline:"="},link:function(t,e,n,i){i.$parsers.push(function(t){return t.replace("x","AAA")})}}}),angular.module("edison").directive("dropdownRow",["Devis","productsList","edisonAPI","config","$q","$timeout","Intervention",function(t,e,n,i,o,r,a){"use strict";return{restrict:"E",replace:!0,templateUrl:"/Directives/dropdown-row.html",scope:{model:"@",row:"="},link:function(r,s,l){if(r._=_,r.Intervention=a,r.Devis=t,r._model=r.model||"intervention",r.expendedStyle={height:0,overflow:"hidden"},r.expendedReady=!1,r.data={},r.config=i,"intervention"===r._model)n.intervention.get(r.row.id,{populate:["sst","devisOrigine"].join(",")}).then(function(t){r.data=t.data,r.data.produits&&(r.produits=new e(r.data.produits)),r.client=r.data.client,r.address=r.client.address});else if("devis"===r._model)var c=[n.devis.get(r.row.id,{populate:"transfertId"})],u=function(t){r.data=t[0].data,r.produits=new e(r.data.produits),r.hist=r.data.historique,r.client=r.data.client,r.address=r.client.address};else"artisan"===r._model&&(r.loadPanel=function(t){n.artisan.getStats(t).then(function(t){new Chartist.Pie(".ct-chart",{series:[{value:t.data.envoye.total,name:"En cours",className:"ct-orange",meta:"Meta One"},{value:t.data.annule.total,name:"annulé",className:"ct-red",meta:"Meta One"},{value:t.data.paye.total,name:"payé",className:"ct-green",meta:"Meta One"}]},{total:t.data.annule.total+t.data.paye.total+t.data.envoye.total,donut:!0,startAngle:270,donutWidth:62}),r.stats=t.data})},r.loadPanel(r.row.id),c=[n.artisan.get(r.row.id),n.artisan.getStats(r.row.id)],u=function(t){r.data=t[0].data,r.artisan=r.data,r.artisan.stats=t[1].data,r.address=r.artisan.address});o.all(c).then(u),r.getStaticMap=function(){var t="?format=jpg&width=411&height=210px&precision=0&origin="+r.address.lt+", "+r.address.lg;return t+=_.get(r,"data.artisan.address.lt")?"&destination="+r.data.artisan.address.lt+", "+r.data.artisan.address.lg:"&zoom=15","/api/mapGetStatic"+t}}}}]),angular.module("edison").directive("elastic",["$timeout",function(t){return{restrict:"A",link:function(e,n){e.initialHeight=e.initialHeight||n[0].style.height;var i=function(){n[0].style.height=e.initialHeight,n[0].style.height=""+n[0].scrollHeight+"px"};n.on("input change",i),t(i,0)}}}]),angular.module("edison").directive("ngEnter",function(){"use strict";return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ngEnter)}),e.preventDefault())})}}),angular.module("edison").directive("historiquePaiementSst",["edisonAPI","FlushList",function(t,e){"use strict";return{restrict:"E",replace:!0,templateUrl:"/Templates/historique-paiement-sst.html",scope:{data:"=",exit:"&"},link:function(n,i,o){var r=function(){if(!n.data||!n.data.id)return 0;n.getTotal=function(t){var e=0;return _.each(t,function(t){e+=t.original.compta.paiement.historique["final"]}),_.round(e,2)},t.artisan.getCompteTiers(n.data.id).then(function(t){n.historiquePaiement=_.map(t.data,function(t){return t.flushList=new e(t.list,_.map(t.list,"_id")),_.map(t.flushList.getList(),function(e){e.original=_.find(t.list,"id",e.id)}),t})})};n.$watch("data.id",r),n.check=function(e){t.signalement.check(e._id,e.text).then(function(t){e=_.merge(e,t.data)}),n.exit&&n.exit(),console.log("=>",e)},n.comment=function(){t.artisan.comment(n.data.id,n.comm).then(r),n.comm=""}}}}]),angular.module("edison").directive("historiqueSst",["edisonAPI",function(t){"use strict";return{restrict:"E",replace:!0,templateUrl:"/Templates/historique-sst.html",scope:{data:"=",exit:"&"},link:function(e,n,i){var o=function(){return e.data&&e.data.id?void t.artisan.fullHistory(e.data.id).then(function(t){e.hist=t.data}):0};e.$watch("data.id",o),e.check=function(n){t.signalement.check(n._id,n.text).then(function(t){n=_.merge(n,t.data)}),e.exit&&e.exit()},e.comment=function(){t.artisan.comment(e.data.id,e.comm).then(o),e.comm=""}}}}]),angular.module("edison").directive("infoComment",["user",function(t){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-comment.html",scope:{data:"="},link:function(e,n,i){e.height=i.height||216,e.user=t,e.addComment=function(){e.data.comments.push({login:t.login,text:e.commentText,date:new Date}),e.commentText=""}}}}]),angular.module("edison").directive("infoLitige",function(){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-litige.html",scope:{data:"="},link:function(t,e){t.$watch("data.litige.description",function(e,n){t.data.litige&&!t.data.litige.closed&&t.data.litige.description&&(t.data.litige.open=!0),t.data.litige&&!t.data.litige.description&&(t.data.litige.open=!1)})}}}),angular.module("edison").directive("infoPaiement",["config",function(t){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-paiement.html",scope:{data:"=",artisans:"="},link:function(e,n){e.config=t}}}]),angular.module("edison").directive("infoSav",["config",function(t){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-sav.html",scope:{data:"=",artisans:"="},link:function(e,n){e.config=t}}}]);var Controller=function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m){var h=this;h._=_,r.circular.show("#5fa2db","#globalProgress");var v,g=c.hash(),b=new s(h.model,l.hashModel),y=new n(h.model);l.fltr&&(v=y.getFilterByUrl(l.fltr));var w=new Date,T=moment().add(-13,"month").toDate();h.dateSelectList=m(T,w).range("month").map(function(t){return{ts:t.unix(),t:t.format("MMM YYYY"),m:t.month()+1,y:t.year()}}),h.routeParamsFilter=l.fltr,h.embedded&&h.$watch("filter",function(){_.size(h.filter)&&(h.customFilter=function(t){for(var e in h.filter)if(h.filter[e]!==t[e])return!1;return!0},h.tableParams&&(b.applyFilter({},h.tab.hash,h.customFilter),h.tableParams.reload()))}),h.displaySubRow=function(t){return h.expendedRow&&h.expendedRow===t.id},h.smallWin=window.innerWidth<1400,$(window).resize(function(){h.smallWin=window.innerWidth<1400}),h.tab=e.getCurrentTab(),h.tab.hash=g,h.config=p;var C=v?v.long_name:h.model;if(l.sstid){var S=parseInt(l.sstid);h.customFilter=function(t){return t.ai===S}}else h.tab.setTitle(C,g);if(l.sstids_in&&(h.customFilter=function(t){return _.includes(l.sstids_in,t.id)}),l.ids_in){var P=JSON.parse(l.ids_in);h.customFilter=function(t){return _.includes(P,t.id)}}h.$watch(function(){return c.search()},_.after(2,function(t,e){h.tableParams.filter(_.omit(t,"hashModel","page","sstid","ids_in"))}),!0),h.$watch(function(){return c.hash()},function(t,e){h.tableParams&&(b.applyFilter(v,t,h.customFilter),h.tableParams.reload())},!0);var D=v&&v.sortBy||{id:"desc"};b.init(function(t,e){b.applyFilter(v,h.tab.hash,h.customFilter);var n={page:c.search().page||1,total:b.filteredData.length,filter:h.embedded?{}:_.omit(c.search(),"hashModel","page","sstid","ids_in"),sorting:D,count:h.limit||100},i={total:b.filteredData,getData:function(t,e){var n=b.filteredData;h.embedded||(n=d("tableFilter")(n,e.filter())),h.currentFilter=_.clone(e.filter()),e.total(n.length),n=d("orderBy")(n,e.orderBy()),t.resolve(n.slice((e.page()-1)*e.count(),e.page()*e.count()))},filterDelay:100};h.tableParams=new f(n,i),r.circular.hide()});if(u.$on(h.model.toUpperCase()+"_CACHE_LIST_CHANGE",function(t,n){e.getCurrentTab()&&h.tab.fullUrl===e.getCurrentTab().fullUrl&&(b.applyFilter(v,h.tab.hash,h.customFilter),h.tableParams.reload())}),h.contextMenu=new o(h.model),"COMPTABILITE"===i.service){var A=_.findIndex(h.contextMenu.list,"title","Appels");if(A){var x=h.contextMenu.list[A];h.contextMenu.list.splice(A,1),h.contextMenu.list.push(x)}}h.rowRightClick=function(t,e){a[h.model].get(e.id,{populate:"sst"}).then(function(e){h.contextMenu.setData(e.data),h.contextMenu.setPosition(t.pageX-(l.sstid||h.embedded?50:0),t.pageY+(l.sstid||h.embedded?0:200)),h.contextMenu.open()})},h.rowClick=function(t,n){return h.contextMenu.active?h.contextMenu.close():void(t.metaKey||t.ctrlKey?e.addTab("/"+h.model+"/"+n.id,{title:"#"+n.id,setFocus:!1,allowDuplicates:!1}):h.expendedRow===n.id?h.expendedRow=void 0:h.expendedRow=n.id)}};angular.module("edison").directive("lineupIntervention",["$timeout","TabContainer","FiltersFactory","user","ContextMenu","LxProgressService","edisonAPI","DataProvider","$routeParams","$location","$rootScope","$filter","config","ngTableParams","MomentIterator",function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m){"use strict";var h=arguments;return{replace:!1,restrict:"E",templateUrl:"/Templates/lineup-intervention.html",scope:{limit:"=",embedded:"=",filter:"="},controller:["$scope",function(t){t.model="intervention",Controller.apply(t,h)}]}}]),angular.module("edison").directive("lineupDevis",["$timeout","TabContainer","FiltersFactory","user","ContextMenu","LxProgressService","edisonAPI","DataProvider","$routeParams","$location","$rootScope","$filter","config","ngTableParams","MomentIterator",function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m){"use strict";var h=arguments;return{replace:!1,restrict:"E",templateUrl:"/Templates/lineup-devis.html",scope:{filter:"="},controller:["$scope",function(t){t.model="devis",Controller.apply(t,h)}]}}]),angular.module("edison").directive("lineupArtisan",["$timeout","TabContainer","FiltersFactory","user","ContextMenu","LxProgressService","edisonAPI","DataProvider","$routeParams","$location","$rootScope","$filter","config","ngTableParams","MomentIterator",function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m){"use strict";var h=arguments;return{replace:!1,restrict:"E",templateUrl:"/Templates/lineup-artisan.html",scope:{},controller:["$scope",function(t){t.model="artisan",Controller.apply(t,h)}]}}]),angular.module("edison").directive("ngRightClick",["$parse",function(t){"use strict";return function(e,n,i){n.bind("contextmenu",function(n){n.altKey||n.ctrlKey||n.shiftKey||["INPUT","TEXTAREA"].indexOf(n.target.nodeName)>=0||e.$apply(function(){n.preventDefault(),t(i.ngRightClick)(e,{$event:n})})})}}]),angular.module("edison").directive("link",["FiltersFactory","$rootScope",function(t,e){"use strict";return{restrict:"AE",replace:!0,template:'<li>      <a href="{{fullUrl}}" >            <i ng-if="icon" class = "menu-icon fa fa-{{icon}}"> </i>            <span ng-class="{bold : bold, textWhite: textWhite}" class="mm-text">{{title || exFltr.long_name}}</span>            <span ng-if="total"class="label label-{{_color}}">{{total}}</span>        </a>      </li>',scope:{fltr:"@",login:"@",today:"@",icon:"@",title:"@",url:"@",textWhite:"@",model:"@",bold:"@",count:"@",noCounter:"@",color:"@",hashModel:"@"},link:function(n,i,o){var r=function(){if(n.count)return n.count;if(!n.noCounter){var t=0;if(n.login){var i=_.find(e.interventionsStats,function(t){return t.login===n.login});t+=_.get(i,n.fltr+".total",0)}else _.each(e.interventionsStats,function(e){t+=_.get(e,n.fltr+".total",0)});return t}};e.$watch("interventionsStats",function(){n.total=r()}),n.$watch("login",function(e,i){n._color=n.color||"success",n._model=n.model||"intervention";var o=new t(n._model);n.exFltr=o.getFilterByName(n.fltr),n.total=r(),n.exFltr=n.exFltr||{url:""},n._url=n.exFltr.url.length?"/"+n.exFltr.url:n.exFltr.url,n._login=n.login&&!n.hashModel?"#"+n.login:"",n._hashModel=n.hashModel?"?"+n.hashModel+"="+n.login:"",n.fullUrl=n.url||"/"+n._model+"/list"+n._url+n._hashModel+n._login})}}}]),angular.module("edison").directive("simpleLink",["FiltersFactory","$rootScope",function(t,e){"use strict";return{restrict:"AE",replace:!0,template:'<li>      <a href="{{url}}"  target="{{target}}">            <i ng-if="icon" class = "menu-icon fa fa-{{icon}}"> </i>            <span class="mm-text">{{title}}</span>        </a>      </li>',scope:{icon:"@",title:"@",url:"@"},link:function(t,e,n){t.target="string"==typeof n.extern?"_blank":""}}}]),angular.module("edison").directive("linkSeparator",function(){"use strict";return{restrict:"AE",replace:!0,template:'<li>      <a>            <i ng-if="icon" class = "menu-icon fa fa-{{icon}}"> </i>            <strong><span class="mm-text">{{title}}</span></strong>        </a>      </li>',scope:{icon:"@",title:"@"},link:function(t,e,n){}}}),angular.module("edison").service("sidebarSM",function(){var t=function(){this.display=!1};return t.prototype.set=function(t,e){this[t]=e},new t}),angular.module("edison").directive("sideBar",["sidebarSM",function(t){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Directives/side-bar.html",transclude:!0,scope:{},link:function(e,n,i){e.sidebarSM=t}}}]),angular.module("edison").directive("dropDown",["config","sidebarSM","$timeout",function(t,e,n){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Directives/dropdown.html",transclude:!0,scope:{title:"@",icon:"@",isOpen:"@",openDefault:"&"},link:function(t,i,o){t.openDefault=t.$eval(t.openDefault),t.isopen=t.openDefault,t.toggleSidebar=function(o,r){var a=$(i).find(">ul");$("#main-menu").width()>200?t.isopen?a.velocity({height:0},200,function(){t.$apply(function(){t.isopen=!1})}):(a.css("height","100%"),t.isopen=!0):($("#mmc-ul > .mmc-wrapper").html(a.find("> *")),e.set("display",!0),n(function s(){$("#mmc-ul").is(":hover")?n(s,1e3):(e.set("display",!1),a.html($("#mmc-ul > .mmc-wrapper").find(">*")),$("#mmc-ul > .mmc-wrapper").html(""))},1e3))}}}}]),angular.module("edison").directive("signalement",["edisonAPI","LxNotificationService",function(t,e){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/signalement.html",scope:{data:"=",exit:"&"},link:function(n,i){n.setSelectedSubType=function(t){n.selectedSubType=n.selectedSubType===t?null:t},t.signal.list().then(function(t){n.signalementsGrp=_.groupBy(t.data,"subType")}),n.hide=function(i){return t.signalement.add(_.merge(i,{inter_id:n.data.id||n.data.tmpID,sst_id:n.data.sst&&n.data.sst.id,sst_nom:n.data.sst&&n.data.sst.nomSociete})).then(function(){e.success("Le service "+i.service.toLowerCase()+" en a été notifié")}),n.exit&&n.exit()}}}}]),angular.module("edison").directive("trello",["user","edisonAPI",function(t,e){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/trello.html",scope:{data:"="},link:function(n,i){var o=function(t){return t.checked="complete"===t.state,t};n.reload=function(){e.tasklist.get(moment().format("DD-MM-YYYY"),t.login).then(function(t){n.tasklist=t.data,t.data.checkItems=t.data.checkItems.map(o)})},n.reload(),n.check=function(t){t.listID=n.tasklist.id,t.cardID=n.tasklist.cardID,e.tasklist.update(_.clone(t)).then(function(e){t=o(e.data)}),t.checked=!t.checked}}}}]),angular.module("edison").filter("contactFilter",["config",function(t){"use strict";var e=function(t){return _.deburr(t).toLowerCase()};return function(t,n){var i=[];return n=e(n),_.each(t,function(t){t.stringify||(t.stringify=e(JSON.stringify(t))),(!n||t.stringify.indexOf(n)>=0)&&i.push(t)}),i}}]),angular.module("edison").filter("crlf",function(){"use strict";return function(t){return t.split(/\n/g).join("<br>")}}),angular.module("edison").filter("frnbr",function(){"use strict";return function(t){var e=_.round(t||0,2).toString(),n=e.indexOf(".");return e.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,function(t,e){return(0>n||n>e?t+" ":t).replace(".",",")})}}),angular.module("edison").filter("loginify",function(){"use strict";return function(t){return t?t.slice(0,1).toUpperCase()+t.slice(1,-2):""}}),angular.module("edison").filter("relativeDate",function(){"use strict";return function(t,e){var n=moment(1e4*(t+137e6)),i=moment().subtract(4,"days");if(i>n)return e?n.format("DD/MM"):n.format("DD/MM/YY");var o=n.fromNow().toString();return e&&(o=o.replace("quelques secondes","").replace(" minutes","mn").replace(" minute","mn").replace(" une","1").replace(" heures","H").replace(" heure","H").replace(" jours","J").replace(" jour","J").replace("il y a","-").replace(" un","1").replace("dans ","+")),o}}),angular.module("edison").filter("reverse",function(){"use strict";return function(t){return t?t.slice().reverse():[]}}),angular.module("edison").filter("tableFilter",["config",function(t){"use strict";var e=function(t){return _.deburr(t).toLowerCase()},n=function(t,n,i){return"string"==typeof t?e(t).includes(n):i?t===parseInt(n):e(String(t)).startsWith(n)},i=function(e,i,o){if("_categorie"===e){var r=t.categoriesHash()[i.c].long_name;return n(r,o)}if("_etat"===e){var r=t.etatsHash()[i.s].long_name;return n(r,o)}return!0},o=function(t,e,n){var i=1e4*(e[t]+137e6);return i>n.start.getTime()&&i<n.end.getTime()?!0:!1},r=function(t){if(/^[0-9\/]+$/.test(t)&&!_.endsWith(t,"/")){var e=t.split("/");if(1===e.length){var n=parseInt(e[0]),i=(new Date).getFullYear();return{start:new Date(i,n-1),end:new Date(i,n)}}if(2===e.length){if(4==e[1].length){var n=parseInt(e[0]),i=parseInt(e[1]);return{start:new Date(i,n-1),end:new Date(i,n)}}var o=parseInt(e[0]),n=parseInt(e[1]),i=(new Date).getFullYear();return{start:new Date(i,n-1,o),end:new Date(i,n-1,o+1)}}}};return function(t,a,s){var l=[];return a=_.mapValues(a,e),_.each(a,function(t,e){"∆"===e.charAt(0)&&(a[e]=r(t))}),_.each(t,function(t){if(t.id){var e=!0;_.each(a,function(r,a){if(r&&_.size(r)>0)if("_"===a.charAt(0)){if(!i(a,t,r))return e=!1,!1}else if("∆"===a.charAt(0)){if(!o(a.slice(1),t,r))return e=!1,!1}else if(!n(t[a],r,s))return e=!1,!1}),e===!0&&l.push(t)}}),l}}]),angular.module("edison").factory("TabContainer",["$location","$window","$q","edisonAPI",function(t,e,n,i){"use strict";var o=function(t,e,n){"object"==typeof t?_.each(t,function(t,e){this[e]=t}):(this.prevTab=n||{},this.urlFilter=e.urlFilter,this.hash=e.hash,this.url=t,this.fullUrl=this.url+["",$.param(this.urlFilter)].join(_.isEmpty(this.urlFilter)?"":"?")+(this.hash?"#"+this.hash:""),this.title="",this.position=null,this.deleted=!1,this._timestamp=Date.now())};o.prototype.setData=function(t){this.data=t},o.prototype.setTitle=function(t,e){this.title=t};var r=function(){this._tabs=[],this.selectedTab=0};return r.prototype.loadSessionTabs=function(t){var e=this;return n(function(n,r){var a=!1;i.request({fn:"getSessionData"}).then(function(i){e.selectedTab=i.data.selectedTab;for(var s=0;s<i.data._tabs.length;s++)e._tabs.push(new o(i.data._tabs[s])),i.data._tabs[s].url===t&&(e.selectedTab=s,a=!0);return a?n():r()})["catch"](r)})},r.prototype.setFocus=function(t){this.selectedTab="number"==typeof t?t:t.position},r.prototype.createTab=function(t,e){var n=new o(t,e,this.getCurrentTab());return n.position=this._tabs.length,this._tabs.push(n),n},r.prototype.isOpen=function(t,e){var n=_.findIndex(this._tabs,function(n){return!n.deleted&&n.url===t&&(!e.hash&&!n.hash||e.hash==n.hash)&&_.isEqual(e.urlFilter,n.urlFilter)});return n>=0},r.prototype.getTab=function(t,e){return _.find(this._tabs,function(n){return!n.deleted&&n.url===t&&(!e.hash&&!n.hash||e.hash==n.hash)&&_.isEqual(e.urlFilter,n.urlFilter)})},r.prototype.getTabSimple=function(t,e){return _.find(this._tabs,function(e){return!e.deleted&&e.url.split("/")[1]===t.split("/")[1]})},r.prototype.len=function(){var t=0;return this._tabs.forEach(function(e){t+=!e.deleted}),t},r.prototype.getPrevTab=function(t){for(var e=t.position-1;e>=0;e--)if(this._tabs[e].deleted===!1)return this._tabs[e]},r.prototype.close=function(e){this.len()>1?(console.log("multiple tabs"),this.remove(e)&&t.url(e.prevTab.fullUrl||"/intervention/list")):(console.log("only tab"),t.url(e.prevTab.fullUrl||"/intervention/list"),this.noClose=!0)},r.prototype.remove=function(t){var e=[],n=0;if(this._tabs.length<=1)return!1;for(var i=this.selectedTab===t.position,o=0;o<this._tabs.length;o++)o!==t.position&&(e.push(this._tabs[o]),e[n].position=n,++n);return this._tabs=e,this.selectedTab===t.position&&0!==this.selectedTab&&this.selectedTab--,this.selectedTab>t.position&&this.selectedTab--,i},r.prototype.getCurrentTab=function(){return this._tabs[this.selectedTab]},r.prototype.addTab=function(t,e){var n,i=["/list","/search","/recap","lpa","/artisan/contact","/tools/edit"];n=this.noClose?this._tabs[0]:_.find(i,_.partial(_.includes,t))&&this.getTabSimple(t)?this.getTabSimple(t):this.noClose||this.isOpen(t,e)?this.getTab(t,e):this.createTab(t,e),this.noClose=!1,e&&e.setFocus===!1||this.setFocus(n),e&&e.title&&n.setTitle(e.title)},new r}]),angular.module("edison").factory("Signalement",["edisonAPI",function(t){"use strict";var e=function(t){this.intervention=t};return e.prototype.list=[],e}]),angular.module("edison").factory("Tab",function(){var t=function(t,e){this.container=t,this.title="...",this.path=e.path(),this.url=e.path().split("/").slice(1),this.model=this.url[0],this.route=this.url[1],this.hash=e.hash(),this.title=this.url[this.url.length-1],this.date=new Date};return t.prototype.setTitle=function(t){return this.title=t,this},t.prototype.close=function(){this.container.close(this)},t.prototype.setData=function(t){return this.data=t,this},t}),angular.module("edison").factory("TabContainer",["Tab","$location",function(t,e){"use strict";var n={__tabs:[],__ordered:{}};return n.find=function(e){var n=new t(this,e);return _.find(this.__tabs,function(t){return"list"===t.route&&"list"===n.route?n.model===t.model:t.path==e.path()&&t.hash==e.hash()})},n.ordered=function(){return this.__ordered},n.close=function(t){var n=_.findIndex(this.__tabs,function(e){return e.path==t.path&&e.hash==location.hash});this.__tabs.splice(n,1),e.url(this.prevTab&&this.prevTab.path!=this.selectedTab.path&&this.prevTab.path||"/intervention/list")},n.add=function(e){var n=this.find(e);return this.prevTab=this.selectedTab,n?this.selectedTab=n:(this.selectedTab=new t(this,e),this.__tabs.push(this.selectedTab)),this},n.getCurrentTab=function(){return this.selectedTab},n.order=function(){var t=this,e=["intervention","artisan","devis","tools","compta"],n={};return _.each(t.__tabs,function(t){if(_.includes(e,t.model)&&"list"!==t.url[1]&&"contact"!==t.url[1])var i=_.endsWith(t.model,"s")?t.model:t.model+"s";else i="Recents";n[i]=n[i]||{title:i,tabs:[]},n[i].tabs.push(t)}),this.__ordered=n,this},n.getOrdered=function(){return this.__ordered},n}]),angular.module("edison").factory("Address",function(){
"use strict";var t=function(t,e){t.lat&&t.lng?(this.lt=t.lat,this.lg=t.lng):e?(this.getAddressProprieties(t),this.streetAddress=!0):this.isStreetAddress(t)?this.getPlaceProprieties(t):this.isLocalityAddress(t)&&this.getPlaceLocalityProprieties(t),t.geometry&&(this.lt=t.geometry.location.lat(),this.lg=t.geometry.location.lng()),this.latLng=this.lt+", "+this.lg};return t.prototype.getPlaceLocalityProprieties=function(t){var e=t.address_components;this.cp=e[1]&&e[1].short_name,this.v=e[0]&&e[0].short_name},t.prototype.getPlaceProprieties=function(t){var e=t.address_components;this.n=e[0]&&e[0].short_name,this.r=e[1]&&e[1].short_name,this.cp=e[6]&&e[6].short_name,this.v=e[2]&&e[2].short_name},t.prototype.getAddressProprieties=function(t){this.n=t.n,this.r=t.r,this.cp=t.cp,this.v=t.v,this.lt=t.lt,this.lg=t.lg,this.code=t.code,this.etage=t.etage,this.batiment=t.batiment},t.prototype.isLocalityAddress=function(t){return this.localityAddress=t.types.indexOf("locality")>=0,this.localityAddress},t.prototype.isStreetAddress=function(t){var e=["locality","country","postal_code","route","sublocality"];return this.streetAddress=e.indexOf(t.types[0])<0,this.streetAddress},t.prototype.toString=function(){return this.n+" "+this.r+" "+this.cp+", "+this.v+", France"},function(e,n){return new t(e,n)}}),angular.module("edison").factory("edisonAPI",["$http","$location","Upload",function(t,e,n){"use strict";return{bug:{declare:function(e){return t.post("/api/bug/declare",e)}},user:{history:function(e){return t.get("/api/user/"+e+"/history")}},product:{list:function(){return t.get("/api/product/list")},save:function(e){return t.post("/api/product/__save",e)}},signal:{list:function(){return t.get("/api/signal/list")},save:function(e){return t.post("/api/signal/__save",e)}},compte:{list:function(){return t.get("/api/compte/list")},save:function(e){return t.post("/api/compte/__save",e)}},combo:{list:function(){return t.get("/api/combo/list")},save:function(e){return t.post("/api/combo/__save",e)}},stats:{telepro:function(){return t.get("/api/stats/telepro")},day:function(){return t.get("/api/stats/day")}},users:{logout:function(){return t.get("/logout")},save:function(e){return t.post("/api/user/__save",e)},list:function(){return t.get("/api/user/list")}},bfm:{get:function(){return t.get("/api/bfm")}},compta:{lpa:function(e){return t.get("/api/intervention/lpa?d="+(e.d||""))},flush:function(e){return t.post("/api/intervention/flush",e)},flushMail:function(e){return t.post("/api/intervention/flushMail",e)},archivesPaiement:function(){return t.get("/api/intervention/archivePaiement")},archivesReglement:function(){return t.get("/api/intervention/archiveReglement")},avoirs:function(){return t.get("/api/intervention/avoirs")},flushAvoirs:function(e){return t.post("/api/intervention/flushAvoirs",e)}},devis:{saveTmp:function(e){return t.post("/api/devis/temporarySaving",e)},getTmp:function(e){return t.get("/api/devis/temporarySaving?id="+e)},get:function(e,n){return t({method:"GET",cache:!1,url:"/api/devis/"+e,params:n||{}}).success(function(t){return t})},save:function(e){return e.id?t.post("/api/devis/"+e.id,e):t.post("/api/devis",e)},envoi:function(e,n){return t.post("/api/devis/"+e+"/envoi",n)},annulation:function(e,n){return t.post("/api/devis/"+e+"/annulation")},list:function(){return t.get("api/devis/getCacheList")}},intervention:{dashboardStats:function(e){return t.get("/api/intervention/dashboardStats",{params:e})},getTelMatch:function(e){return t.post("/api/intervention/telMatches",e)},saveTmp:function(e){return t.post("/api/intervention/temporarySaving",e)},getTmp:function(e){return t.get("/api/intervention/temporarySaving?id="+e)},demarcher:function(e){return t({method:"POST",url:"/api/intervention/"+e+"/demarcher"})},reactivation:function(e){return t.post("api/intervention/"+e+"/reactivation")},list:function(){return t.get("api/intervention/getCacheList")},get:function(e,n){return t({method:"GET",cache:!1,url:"/api/intervention/"+e,params:n||{}}).success(function(t){return t})},getCB:function(e){return t.get("/api/intervention/"+e+"/CB")},save:function(e){return e.id?t.post("/api/intervention/"+e.id,e):t.post("/api/intervention",e)},getFiles:function(e){return t({method:"GET",url:"/api/intervention/"+e+"/getFiles"})},verification:function(e,n){return t.post("/api/intervention/"+e+"/verification",n)},annulation:function(e,n){return t.post("/api/intervention/"+e+"/annulation",n)},envoi:function(e,n){return t.post("/api/intervention/"+e+"/envoi",n)},sendFacture:function(e,n){return t.post("/api/intervention/"+e+"/sendFacture",n)},sendFactureAcquitte:function(e,n){return t.post("/api/intervention/"+e+"/sendFactureAcquitte",n)},statsBen:function(e){return t({method:"GET",url:"/api/intervention/statsBen",params:e})},statsBenYear:function(e){return t({method:"GET",url:"/api/intervention/statsBenYearly",params:e})},commissions:function(e){return t({method:"GET",url:"/api/intervention/commissions",params:e})},scan:function(e){return t.post("/api/intervention/"+e+"/scan")}},artisan:{tableauCom:function(){return t.get("/api/artisan/tableauCom")},manage:function(e){return t.post("/api/artisan/"+e+"/manage")},comment:function(e,n){return t.post("/api/artisan/"+e+"/comment",{text:n})},absence:function(e,n){return t.post("/api/artisan/"+e+"/absence",n)},needFacturier:function(e){return t.post("/api/artisan/"+e+"/needFacturier")},sendFacturier:function(e,n,i){return t.post("/api/artisan/"+e+"/sendFacturier",{facturier:n,deviseur:i})},saveTmp:function(e){return t.post("/api/artisan/temporarySaving",e)},fullHistory:function(e){return t.get("/api/artisan/"+e+"/fullHistory")},getTmp:function(e){return t.get("/api/artisan/temporarySaving?id="+e)},getCompteTiers:function(e){return t.get(["/api/artisan",e,"compteTiers"].join("/"))},envoiContrat:function(e,n){return t.post("/api/artisan/"+e+"/sendContrat",n)},upload:function(t,e,i){return n.upload({url:"/api/artisan/"+i+"/upload",fields:{name:e,id:i},file:t})},getFiles:function(e){return t({method:"GET",url:"/api/artisan/"+e+"/getFiles"})},extendedStats:function(e){return t.get("/api/artisan/"+e+"/extendedStats")},statsMonths:function(e){return t.get("/api/artisan/"+e+"/statsMonths")},save:function(e){return e.id?t.post("/api/artisan/"+e.id,e):t.post("/api/artisan",e)},list:function(e){return t.get("api/artisan/getCacheList")},lastInters:function(e){return t({method:"GET",url:"/api/artisan/"+e+"/lastInters"})},get:function(e,n){return t({method:"GET",cache:!1,url:"/api/artisan/"+e,params:n||{}}).success(function(t){return t})},getNearest:function(e,n){return t({method:"GET",url:"/api/artisan/rank",cache:!1,params:{categorie:n,lat:e.lt,lng:e.lg,limit:150,maxDistance:100}})},getStats:function(e){return t({method:"GET",url:"/api/artisan/"+e+"/stats"})}},tasklist:{get:function(e,n){return t.get("/api/tasklist/"+e+"/"+n)},check:function(e,n){return t.post("/api/tasklist/"+e+"/check/"+n)},update:function(e){return t.post("/api/tasklist/",{task:e})}},task:{add:function(e){return t.post("/api/task/add",e)},check:function(e){return t.post("/api/task/"+e+"/check")},listRelevant:function(e){return t.get("/api/task/relevant",{params:e})}},signalement:{check:function(e,n){return t.post("/api/signalement/"+e+"/check",{text:n})},add:function(e){return t.post("/api/signalement/add",e)},list:function(e){return t.get("/api/signalement/list",{params:e})},stats:function(){return t.get("/api/signalement/stats")}},file:{uploadScans:function(t,e){return n.upload({url:"/api/document/uploadScans",fields:e,file:t})},upload:function(t,e){return n.upload({url:"/api/document/upload",fields:e,file:t})},scan:function(e){return t.post("/api/document/scan",e)}},call:{get:function(e,n){return t({method:"GET",url:"/api/calls/get",params:{q:JSON.stringify({link:n})}})},save:function(e){return t.post("/api/calls",e)}},sms:{get:function(e,n){return t({method:"GET",url:"/api/sms/get",params:{q:JSON.stringify({link:n,origin:e})}})},send:function(e){return t.post("/api/sms/send",e)}},getDistance:function(e,n){return t({method:"GET",cache:!0,url:"/api/mapGetDistance",params:{origin:e,destination:n}})},request:function(e){return t({method:e.method||"GET",url:"/api/"+e.fn,params:e.data})},searchPhone:function(e){return t({method:"GET",url:"api/arcep/"+e+"/search"})},getUser:function(){return t({method:"GET",cache:!0,url:"/api/whoAmI"})},searchText:function(e,n){return t({method:"GET",params:n,url:["api","search",e].join("/")})},bigSearch:function(e,n){return t({method:"GET",params:n,url:["api","bigSearch",e].join("/")})}}}]),angular.module("edison").factory("Artisan",["$window","$rootScope","user","$location","LxNotificationService","LxProgressService","dialog","edisonAPI","textTemplate",function(t,e,n,i,o,r,a,s,l){"use strict";var c=function(t){if(!(this instanceof c))return new c(t);for(var e in t)this[e]=t[e]},u=function(e){e&&t.open("callto:"+e,"_self",!1)};return c.prototype.callTel1=function(){u(this.telephone.tel1)},c.prototype.callTel2=function(){u(this.telephone.tel2)},c.prototype.typeOf=function(){return"Artisan"},c.prototype.ouvrirFiche=function(){i.url("/artisan/"+this.id)},c.prototype.ouvrirRecap=function(){i.url("/artisan/"+this.id+"/recap")},c.prototype.facturierDeviseur=function(){var t=this;a.facturierDeviseur(this,function(e,n){s.artisan.sendFacturier(t.id,e,n)})},c.prototype.tutelleIn=function(t){this.tutelle=!0,c(this).save()},c.prototype.tutelleOut=function(t){this.tutelle=!1,c(this).save()},c.prototype.deArchiver=function(){this.status="ACT",c(this).save()},c.prototype.archiver=function(){this.status="ARC",c(this).save()},c.prototype.call=function(e){var n=this;Date.now();t.open("callto:"+n.telephone.tel1,"_self",!1)},c.prototype.refuseFacturier=function(){this.demandeFacturier.status="NO",c(this).save()},c.prototype.needFacturier=function(){return this.demandeFacturier&&moment(this.demandeFacturier.date).isAfter(moment().add(-10,"days"))?("PENDING"===this.demandeFacturier.status&&o.error(moment(this.demandeFacturier.date).format("[Une demande à deja été éffectué le ]LLL")),"OK"===this.demandeFacturier.status&&o.error("Un facturier à deja été envoyé dans les 10 derniers jours"),"NO"===this.demandeFacturier.status&&o.error("L'envoi d'un facturier à deja été refusé dans les 10 derniers jours"),0):void s.artisan.needFacturier(this.id).then(function(t){o.success("Une notification a été envoyer au service partenariat")})},c.prototype.save=function(t){var e=this;s.artisan.save(e).then(function(e){o.success("Les données ont à été enregistré"),"function"==typeof t&&t(null,e.data)})["catch"](function(e){o.error(e.data),"function"==typeof t&&t(e.data)})},c.prototype.manager=function(t){var e=this;e.login.management=n.login,s.artisan.save(e).then(function(n){o.success("Vous manager désormais "+e.nomSociete),"function"==typeof t&&t(null,n.data)})["catch"](function(e){o.error(e.data),"function"==typeof t&&t(e.data)})},c.prototype.upload=function(t,e,n){var i=this;t&&(r.circular.show("#5fa2db","#fileUploadProgress"),s.artisan.upload(t,e,i.id).success(function(t){i.document=t.document,r.circular.hide(),"function"==typeof n&&n(null,t)})["catch"](function(t){r.circular.hide(),"function"==typeof n&&n(t)}))},c.prototype.envoiContrat=function(t,e){var n=this;t=t||{},a.sendContrat({data:n,signe:t.signe,text:_.template(l.mail.artisan.envoiContrat())(n)},function(t){r.circular.show("#5fa2db","#globalProgress"),s.artisan.envoiContrat(n.id,{text:t.text,signe:t.signe}).success(function(t){r.circular.hide(),"function"==typeof e&&e(null,t)})})},c.prototype.relanceDocuments=function(t){var e=this;e.datePlain=moment(e.date.ajout).format("ll"),a.sendContrat({data:e,text:_.template(l.mail.artisan.relanceDocuments())(e)},function(n){r.circular.show("#5fa2db","#globalProgress"),s.artisan.envoiContrat(e.id,{text:n.text,signe:n.signe,rappel:!0}).success(function(e){r.circular.hide(),"function"==typeof t&&t(null,e)})})},c.prototype.ouvrirFiche=function(){i.url("/artisan/"+this.id)},c}]),angular.module("edison").factory("ContextMenu",["$rootScope","$location","edisonAPI","user","$window","$timeout","dialog","Devis","Intervention","Artisan","contextMenuData",function(t,e,n,i,o,r,a,s,l,c,u){"use strict";var d=function(e){var n=this;this.model=e,this.list=u[e],t.$on("closeContextMenu",function(){return n.active&&n.close()}),this.style={left:0,top:0,display:"none"}};return d.prototype.openSub=function(t){var e=this;this.openSubTimeout=r(function(){e.mouseOverCM=!0},t||0)},d.prototype.closeSub=function(){this.openSubTimeout&&r.cancel(this.openSubTimeout),this.mouseOverCM=!1},d.prototype.getData=function(){return this.data},d.prototype.setData=function(t){this.data=t},d.prototype.setPosition=function(t,e){this.style.left=t-$("#main-menu-inner").width()-4,this.style.top=e-48},d.prototype.active=!1,d.prototype.open=function(){var t=this;return this.closeSub(),this.list.forEach(function(e){e.subs?_.each(e.subs,function(e){e.hidden=e.hide&&e.hide(t.data)}):e.hidden=e.hide&&e.hide(t.data,i)}),this.style.display="block",this.active=!0,this},d.prototype.onClose=function(t){this.onCloseCallback=t},d.prototype.close=function(){this.style.display="none",this.active=!1,this.onCloseCallback&&(this.onCloseCallback(),this.onCloseCallback=null)},d.prototype.modelObject={intervention:l,devis:s,artisan:c},d.prototype.tooltip=function(t){return _.get(this.data,t.binding,"")},d.prototype.click=function(t){return"function"==typeof t.action?t.action(this.getData()):"string"==typeof t.action?this.modelObject[this.model]()[t.action].bind(this.data)():void console.error("error here")},d}]),angular.module("edison").factory("DataProvider",["$timeout","edisonAPI","socket","$rootScope","config",function(t,e,n,i,o){"use strict";var r=function(t,e){var i=this;this.model=t,this.hashModel=e||"t",this.rand=new Date,n.on(i.socketListChange(),function(t){-1===i.appliedList.indexOf(t.ts)&&(i.appliedList.push(t.ts),i.updateData(t.data))})};return r.prototype.socketListChange=function(){var t=this;return t.model.toUpperCase()+"_CACHE_LIST_CHANGE"},r.prototype.appliedList=[],r.prototype.data={},r.prototype.trie={},r.prototype.setData=function(t){var e=this;this.data[this.model]=t,e.trie[this.model]={},_.each(t,function(t){e.getTrie()[t.id]=t})},r.prototype.init=function(t){var n=this;return n.getData()?t(n.getData()):void e[n.model].list({cache:!0}).success(function(e){return n.setData(e),t(null,e)})},r.prototype.rowFilterFactory=function(t,e){var n=this;return!t&&e?function(t){return t[n.hashModel]===e}:t&&e?function(i){return i.f&&1===i.f[t.short_name]&&i[n.hashModel]===e}:t&&!e?function(e){return e.f&&1===e.f[t.short_name]}:void 0},r.prototype.applyFilter=function(t,e,n){this.filteredData=this.getData(),this.getData()&&(t||e||n)&&(this.filteredData=_.filter(this.getData(),n||this.rowFilterFactory(t,e)))},r.prototype.flash=function(e){e.flash=!0,t(function(){e.flash=!1},1e3)},r.prototype.updateData=function(t){var e=this;this.getData()&&(_.each(t,function(t){var n=e.getTrie()[t.id];n?_.merge(e.getTrie()[t.id],t):(e.getData().unshift(t),e.getTrie()[t.id]=t)}),i.$broadcast(e.socketListChange()))},r.prototype.getData=function(){return this.data[this.model]},r.prototype.getTrie=function(){return this.trie[this.model]},r.prototype.isInit=function(){return this.model&&this.data&&this.data[this.model]},r}]),angular.module("edison").factory("DateSelect",function(){"use strict";var t=function(t,e){var n=this,i=new Date;n.start={m:t?t.getMonth()+1:9,y:t?t.getFullYear():2013},n.current={m:i.getMonth()+1,y:i.getFullYear()};var o=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"];n._list=[],_.times(n.current.y-n.start.y+1,function(t){_.times(12,function(e){n._list.push({m:e+1,y:n.start.y+t,t:o[e]+" "+(n.start.y+t),o:n.start.y+t+.01*(e+1)})})}),n._list.splice(n.current.m-12)};return t.prototype.list=function(){return this._list},t}),angular.module("edison").factory("Devis",["openPost","$window","$rootScope","$location","LxNotificationService","LxProgressService","dialog","edisonAPI","textTemplate",function(t,e,n,i,o,r,a,s,l){"use strict";var c=function(t){if(!(this instanceof c))return new c(t);for(var e in t)this[e]=t[e]},u=function(t){console.log("---->",t),t&&e.open("callto:"+t,"_self",!1)};return c.prototype.callTel1=function(){u(this.client.telephone.tel1)},c.prototype.callTel2=function(){u(this.client.telephone.tel2)},c.prototype.callTel3=function(){u(this.client.telephone.tel3)},c.prototype.typeOf=function(){return"Devis"},c.prototype.save=function(t){var e=this;console.log("yay"),s.devis.save(e).then(function(e){console.log("resp");var n=_.template("Les données du devis {{id}} ont à été enregistré")(e.data);o.success(n),"function"==typeof t&&t(null,e.data)},function(e){console.log("err"),o.error(e.data),"function"==typeof t&&t("une erreur est "+e.data)})["catch"](function(t){console.log("ERRRR:>",t)})},c.prototype.devisPreview=function(){return this.client.nom&&this.client.address.r&&this.client.address.v&&this.client.address.cp&&this.client.address.n?this.produits&&this.produits.length?void t("/api/intervention/devisPreview",{data:JSON.stringify(this),html:!0}):o.error("Veuillez renseigner au moins 1 produits"):o.error("Les Coordonnées du devis sont incompletes")},c.prototype.sendDevis=function(t){var e=this;if(!/\S+@\S+\.\S+/.test(e.client.email))return o.error("L'addresse email est invalide"),t("err");var i=c(this).devisPreview.bind(this);a.getTextDevis(i,{text:l.mail.devis.envoi.bind(e)(n.user),width:"900px",height:"700px"},function(n){r.circular.show("#5fa2db","#globalProgress"),s.devis.envoi(e.id,{text:n}).success(function(n){r.circular.hide();var i=_.template("le devis {{id}} à été envoyé")(e);o.success(i),"function"==typeof t&&(console.log("yes cb"),t(null,n))},function(n){r.circular.hide();var i=_.template("L'envoi du devis {{id}} à échoué\n")(e);n&&n.data&&"string"==typeof n.data&&(i+="\n("+n.data+")"),o.error(i),"function"==typeof t&&t(n)})["catch"](function(n){r.circular.hide();var i=_.template("L'envoi du devis {{id}} à échoué\n")(e);n&&n.data&&"string"==typeof n.data&&(i+="\n("+n.data+")"),o.error(i),"function"==typeof t&&t(n)})})},c.prototype.annulation=function(t){var e=this;s.devis.annulation(e.id).then(function(e){var n=_.template("Le devis {{id}} est annulé")(e.data);o.success(n),"function"==typeof t&&t(null,e.data)})},c.prototype.ouvrirFiche=function(){i.url("/devis/"+this.id)},c.prototype.transfert=function(){i.url("/intervention?devis="+this.id)},c}]),angular.module("edison").factory("dialog",["openPost","$mdDialog","edisonAPI","config","$window","LxNotificationService",function(t,e,n,i,o,r){"use strict";return{declareBug:function(t,n){e.show({controller:["$scope","$mdDialog","config",function(e,i,o){e.resp={location:t.getCurrentTab().path},e.answer=function(t){return i.hide(),t?void 0:n(null,e.resp)}}],templateUrl:"/DialogTemplates/declare-bug.html"})},verification:function(t,n){e.show({controller:["$scope","$mdDialog","config",function(e,i,a){e.data=t,e.config=a,e.answer=function(a){e.window=o,e.inter=t,a?i.hide():e.inter.prixFinal?(i.hide(),n(t)):r.error("Veuillez renseigner un prix final")}}],templateUrl:"/DialogTemplates/verification.html"})},recouvrement:function(t,n){e.show({controller:["$scope","$mdDialog","config",function(e,i,o){e.data=t,e.answer=function(e){i.hide(),e||n(t)}}],templateUrl:"/DialogTemplates/recouvrement.html"})},validationReglement:function(t,i){e.show({controller:["$scope","$mdDialog",function(e,a){e.data=t,Mousetrap.bind(["command+k","ctrl+k","command+f1","ctrl+f1"],function(){return o.open("appurl:","_self"),n.intervention.scan(t.id).then(function(){r.success("Le fichier est enregistré")}),!1}),e.answer=function(n){return e.data=t,a.hide(),null===n?i("nope"):(0!==e.data.compta.reglement.montant&&(e.data.compta.reglement.recu=n),i(null,e.data))}}],templateUrl:"/DialogTemplates/validationReglement.html"})},validationPaiement:function(i,a){e.show({controller:["$scope","$mdDialog",function(e,s){e.data=i,Mousetrap.bind(["command+k","ctrl+k","command+f1","ctrl+f1"],function(){return o.open("appurl:","_self"),console.log("scane"),n.intervention.scan(i.id).then(function(){r.success("Le fichier est enregistré")}),!1}),e.data.compta.paiement.ready=!0,e.preview=function(){t("/api/intervention/autofacture",{data:JSON.stringify(e.data),html:!0})},e.answer=function(t){return e.data=i,s.hide(),null===t?a("nope"):a(null,e.data)}}],templateUrl:"/DialogTemplates/validationPaiement.html"})},facturierDeviseur:function(t,n){e.show({controller:["$scope","$mdDialog","config",function(e,i,o){e.sst=t,e.deviseur=!0,e.facturier=!0,e.answer=function(t){i.hide(),t||n(e.facturier,e.deviseur)}}],templateUrl:"/DialogTemplates/facturierDeviseur.html"})},envoiFacture:function(t,n,i,o){e.show({controller:["$scope","$mdDialog",function(t,e){t.text=n,t.date=new Date,t.showAcquitte=i,t.acquitte=i,t.answer=function(n){e.hide(),n?o("nope"):o(null,t.text,t.acquitte,t.date)}}],templateUrl:"/DialogTemplates/envoiFacture.html"})},recap:function(t){e.show({controller:["$scope","$mdDialog","config",function(e,n,i){e.inters=t,e.config=i,e.answer=function(){n.hide()}}],templateUrl:"/DialogTemplates/recapList.html"})},callsList:function(t){e.show({controller:["$scope","$mdDialog",function(e,n){e.sst=t,e.answer=function(){n.hide()}}],templateUrl:"/DialogTemplates/callsList.html"})},smsList:function(t){e.show({controller:["$scope","$mdDialog",function(e,n){e.sst=t,e.answer=function(){n.hide()}}],templateUrl:"/DialogTemplates/smsList.html"})},choiceText:function(t,n){e.show({controller:["$scope","$mdDialog",function(e,i){e.options=t,e.answer=function(t,e){return i.hide(),n(t,e)}}],templateUrl:"/DialogTemplates/choiceText.html"})},addProd:function(t){e.show({controller:["$scope","$mdDialog","$window",function(e,n,i){e.pu=0,e.window=i,e.quantite=1,e.prod={quantite:1,pu:0,title:"",ref:""},e.$watch("prod",function(){e.prod.ref=e.prod.ref.toUpperCase(),e.prod.title=e.prod.title.toUpperCase(),e.prod.desc=e.prod.title,e.prod.pu=e.prod.pu,e.prod.quantite=e.prod.quantite},!0),e.answer=function(i){return n.hide(),i?void 0:t(e.prod)}}],templateUrl:"/DialogTemplates/getProd.html"})},getCauseAnnulation:function(t,n){e.show({controller:["$scope","config",function(i,o){i.causeAnnulation=o.causeAnnulation,t.datePlain=moment(t.date.intervention).format("DD/MM/YYYY"),i.textSms=_.template("L'intervention {{id}} chez {{client.civilite}} {{client.nom}} à {{client.address.v}} le {{datePlain}} a été annulé. \nMerci de ne pas intervenir. \nEdison Services")(t),i.answer=function(t){return t&&!i.ca?r.error("Veuillez renseigner une raison d'annulation"):(e.hide(),t?n(null,i.ca,i.reinit,i.sendSms,i.textSms):n("nope"))}}],templateUrl:"/DialogTemplates/causeAnnulation.html"})},sendContrat:function(t,n){e.show({controller:["$scope","$mdDialog",function(e,i){e.options=t,console.log(t.signe),e.answer=function(t){return i.hide(),t?void 0:n(e.options)}}],templateUrl:"/DialogTemplates/sendContrat.html"})},getText:function(t,n){e.show({controller:["$scope","$mdDialog",function(e,i){e.options=t,e.answer=function(t){return i.hide(),t?void 0:n(e.options.text)}}],templateUrl:"/DialogTemplates/text.html"})},getTextDevis:function(t,n,i){e.show({controller:["$scope","$mdDialog",function(e,o){e.options=n,e.previewFunction=t,e.answer=function(t){return o.hide(),t?void 0:i(e.options.text)}}],templateUrl:"/DialogTemplates/textDevis.html"})},getFileAndText:function(t,n,i,o){e.show({controller:["$scope","$mdDialog",function(t,e){t.Math=Math,t.xfiles=_.clone(i||[]),t.smsText=n,t.answer=function(n){return e.hide(),n===!1?o(null,t.smsText,t.addedFile):o("nope")}}],templateUrl:"/DialogTemplates/fileAndText.html"})},envoiIntervention:function(t,n,i){e.show({controller:["$scope","$mdDialog",function(e,o){e.data=t,e.smsText=n,e.answer=function(t){return o.hide(),t===!1?i(null,e.smsText,e.addedFile):i("nope")}}],templateUrl:"/DialogTemplates/envoi.html"})},editProduct:{open:function(t,n){e.show({controller:["$scope","$mdDialog",function(e,i){e.produit=_.clone(t),e.mdDialog=i,e.answer=function(t){return i.hide(t),n(t)}}],templateUrl:"/DialogTemplates/edit.html"})}},selectSubProduct:function(t,n){e.show({controller:["$scope","$mdDialog",function(e,i){e.elem=t,e.answer=function(t,e){return i.hide(),t?void 0:n(e)}}],templateUrl:"/DialogTemplates/selectSubProduct.html"})}}}]),angular.module("edison").factory("fourniture",function(){"use strict";return{init:function(t){return this.fourniture=t,this.fourniture||(this.fourniture=[]),this},remove:function(t){this.fourniture.splice(t,1)},moveTop:function(t){if(0!==t){var e=this.fourniture[t-1];this.fourniture[t-1]=this.fourniture[t],this.fourniture[t]=e}},moveDown:function(t){if(t!==this.fourniture.length-1){var e=this.fourniture[t+1];this.fourniture[t+1]=this.fourniture[t],this.fourniture[t]=e}},add:function(){this.fourniture.push({bl:"0",title:"Fourniture",quantite:1,pu:0})},total:function(){var t=0;return this.fourniture&&this.fourniture.forEach(function(e){t+=e.pu*e.quantite}),t}}}),angular.module("edison").factory("Intervention",["$location","$window","openPost","LxNotificationService","LxProgressService","dialog","user","config","edisonAPI","Devis","$rootScope","textTemplate",function(t,e,n,i,o,r,a,s,l,c,u,d){"use strict";var p=function(t){if(!(this instanceof p))return new p(t);for(var e in t)this[e]=t[e]},f=function(t){console.log("---->",t),t&&e.open("callto:"+t,"_self",!1)};return p.prototype.callTel1=function(){f(this.client.telephone.tel1)},p.prototype.callTel2=function(){f(this.client.telephone.tel2)},p.prototype.callTel3=function(){f(this.client.telephone.tel3)},p.prototype.callSst1=function(){f(this.sst.telephone.tel1)},p.prototype.callSst2=function(){f(this.sst.telephone.tel2)},p.prototype.callPayeur1=function(){f(this.facture.tel)},p.prototype.callPayeur2=function(){f(this.facture.tel2)},p.prototype.typeOf=function(){return"Intervention"},p.prototype.envoiDevis=function(t){c().envoi.bind(this)(t)},p.prototype.validerReglement=function(t){var e=this;r.validationReglement(this,function(n,o){return n?t&&t(n):void l.intervention.save(e).then(function(t){i.success("L'intervention "+e.id+" est modifié")},function(t){i.error("Une erreur est survenu ("+t.data+")")})})},p.prototype.validerPaiement=function(t){var e=this;r.validationPaiement(this,function(n,o){return n?t&&t(n):void l.intervention.save(e).then(function(t){i.success("L'intervention "+e.id+" est modifié")},function(t){i.error("Une erreur est survenu ("+t.data+")")})})},p.prototype.demarcher=function(t){l.intervention.demarcher(this.id).success(function(){i.success("Vous demarchez l'intervention")},function(){i.error("Une erreur est survenu")})},p.prototype.facturePreview=function(){n("/api/intervention/facturePreview",{data:JSON.stringify(this),html:!0})},p.prototype.factureAcquittePreview=function(){n("/api/intervention/factureAcquittePreview",{data:JSON.stringify(this),html:!0})},p.prototype.sendFactureAcquitte=function(t){var e=this,n=moment(this.date.intervention).format("LL"),a=d.mail.intervention.factureAcquitte.bind(e)(n),s=_.template(a)(this);r.envoiFacture(e,s,!0,function(n,r,a,s){return n?t("nope"):(o.circular.show("#5fa2db","#globalProgress"),void l.intervention.sendFactureAcquitte(e.id,{text:r,acquitte:a,date:s,data:e}).success(function(n){o.circular.hide();var r=_.template("La facture de l'intervention {{id}} à été envoyé")(e);i.success(r),"function"==typeof t&&t(null,n)})["catch"](function(n){o.circular.hide();var r=_.template("L'envoi de la facture {{id}} à échoué\n("+n.data+")")(e);i.error(r),"function"==typeof t&&t(n)}))})},p.prototype.sendFacture=function(t){var e=this,n=moment(this.date.intervention).format("LL"),a=d.mail.intervention.envoiFacture.bind(e)(n),s=_.template(a)(this);r.envoiFacture(e,s,!1,function(n,r,a,s){return n?t("nope"):(o.circular.show("#5fa2db","#globalProgress"),void l.intervention.sendFacture(e.id,{text:r}).success(function(n){o.circular.hide();var r=_.template("La facture de l'intervention {{id}} à été envoyé")(e);i.success(r),"function"==typeof t&&t(null,n)})["catch"](function(n){o.circular.hide();var r=_.template("L'envoi de la facture {{id}} à échoué\n("+n.data+")")(e);i.error(r),"function"==typeof t&&t(n)}))})},p.prototype.ouvrirFicheV1=function(){e.open("http://electricien13003.com/alvin/5_Gestion_des_interventions/show_res_bis_2.php?id_client="+this.id)},p.prototype.autoFacture=function(){e.open("/api/intervention/"+this.id+"/autoFacture")},p.prototype.ouvrirFiche=function(){t.url("/intervention/"+this.id)},p.prototype.ouvrirRecapSST=function(){t.url(["/artisan",this.artisan.id,"recap"].join("/")+"#interventions")},p.prototype.smsArtisan=function(t){var e=this,n=d.sms.intervention.demande.bind(this)(a,s);n=_.template(n)(this),r.getFileAndText(e,n,[],function(n,o){return n?t(n):void l.sms.send({dest:e.sst.nomSociete,text:o,to:e.sst.telephone.tel1}).success(function(n){var o=_.template("Un sms a été envoyé à M. {{sst.representant.nom}}")(e);i.success(o),"function"==typeof t&&t(null,n)})["catch"](function(e){i.success("L'envoi du sms a échoué"),"function"==typeof t&&t(e)})})},p.prototype.callClient=function(t){var n=this,i=Date.now();e.open("callto:"+n.client.telephone.tel1,"_self",!1),r.choiceText({subTitle:n.client.telephone.tel1,title:"Nouvel Appel Client"},function(e,o){l.call.save({date:i,to:n.client.telephone.tel1,link:n.id,origin:n.id||n.tmpID||0,description:o,response:e}).success(function(e){"function"==typeof t&&t(null,e)})["catch"](function(e){"function"==typeof t&&t(e)})})},p.prototype.callArtisan=function(t){var n=this,i=Date.now();e.open("callto:"+n.artisan.telephone.tel1,"_self",!1),r.choiceText({subTitle:n.artisan.telephone.tel1,title:"Nouvel Appel"},function(e,o){l.call.save({date:i,to:n.artisan.telephone.tel1,link:n.artisan.id,origin:n.id||n.tmpID||0,description:o,response:e}).success(function(e){"function"==typeof t&&t(null,e)})["catch"](function(e){"function"==typeof t&&t(e)})})},p.prototype.save=function(t){var e=this,n=_.find(this.fourniture,function(t){return!t.fournisseur}),o=_.find(this.fourniture,function(t){return!t.pu});return n?(i.error("Veuillez renseigner un fournisseur"),t(n)):o?(i.error("Veuillez renseigner un prix pour toutes les fournitures"),t(o)):void l.intervention.save(e).then(function(n){var o=_.template("Les données de l'intervention {{id}} ont à été enregistré.")(n.data);(e.tmpID&&e.sst||e.sst__id&&e.sst&&e.sst__id!==e.sst.id&&!e.sst.tutelle)&&(o+="\n\n Un sms à été envoyé"),i.success(o),"function"==typeof t&&t(null,n.data)},function(e){i.error(e.data),"function"==typeof t&&t(e.data)})},p.prototype.envoi=function(t){var e=this;if(!p(e).isEnvoyable())return i.error("Vous ne pouvez pas envoyer cette intervention");var n=d.sms.intervention.envoi.bind(e)(_.find(window.app_users,"login",e.login.ajout));r.envoiIntervention(e,n,function(n,r,a){return n?t&&t(n):(o.circular.show("#5fa2db","#globalProgress"),void l.intervention.envoi(e.id,{sms:r,file:a}).then(function(e){o.circular.hide(),console.log("ok");var n=_.template("L'intervention est envoyé");i.success(n),"function"==typeof t&&t(null,e.data)},function(e){o.circular.hide(),console.log("error"),i.error(e.data),"function"==typeof t&&t(e.data)}))})},p.prototype.reactivation=function(t){var e=this;l.intervention.reactivation(this.id).then(function(){i.success("L'intervention "+e.id+" est à programmer")})},p.prototype.annulation=function(t){var e=this;r.getCauseAnnulation(e,function(n,o,r,a,s){return n?"function"==typeof t&&t("err"):void l.intervention.annulation(e.id,{causeAnnulation:o,reinit:r,sms:a,textSms:s}).then(function(e){var n="L'intervention {{id}} est annulé";a&&(n+="\nUn sms à été envoyé au SST");var o=_.template(n)(e.data);i.success(o),"function"==typeof t&&t(null,e.data)})})},p.prototype.envoiFactureVerif=function(t){var e=this;return this.produits.length?void e.sendFacture(function(n){return n?t(n):void e.verificationSimple(t)}):(i.error("Veuillez renseigner les produits"),t("nope"))},p.prototype.verificationSimple=function(t){
var e=this;return o.circular.show("#5fa2db","#globalProgress"),console.log("==>",p(this).isVerifiable()),p(this).isVerifiable()?void l.intervention.verification(e.id).then(function(e){o.circular.hide();var n=_.template("L'intervention {{id}} est vérifié")(e.data);i.success(n),"function"==typeof t&&t(null,e.data)},function(e){o.circular.hide(),i.error(e.data),t(e.data)}):i.error("Vous ne pouvez pas verifier cette intervention")},p.prototype.verification=function(e){if(!p(this).isVerifiable())return i.error("Vous ne pouvez pas verifier cette intervention");var n=this;return n.reglementSurPlace?void r.verification(n,function(t){p(t).save(function(t,n){return t?void 0:p(n).verificationSimple(e)})}):t.url("/intervention/"+this.id)},p.prototype.recouvrement=function(t){var e=this;r.recouvrement(e,function(e){p(e).save(function(e,n){return(t||_.noop)()})})},p.prototype.fileUpload=function(t,e){var n=this;t&&(o.circular.show("#5fa2db","#fileUploadProgress"),l.file.upload(t,{link:n.id||n.tmpID,model:"intervention",type:"fiche"}).success(function(t){o.circular.hide(),"function"==typeof e&&e(null,t)})["catch"](function(t){o.circular.hide(),"function"==typeof e&&e(t)}))},p.prototype.editCB=function(){var t=this;l.intervention.getCB(this.id).success(function(e){t.cb=e},function(t){i.error(t.data)})},p.prototype.reinitCB=function(){this.cb={number:0}},p.prototype.isEnvoyable=function(){return this.sst?this.reglementSurPlace?"QUA"===this.sst.subStatus||this.sst.blocked?a.root:"NEW"===this.sst.subStatus||"TUT"===this.sst.subStatus?a.root||"PARTENARIAT"===a.service:_.includes(["ANN","APR","ENC",void 0],this.status):!0:!1},p.prototype.isPayable=function(){return("ENC"===this.status||"VRF"===this.status)&&a.root||"COMPTABILITE"===a.service},p.prototype.isVerifiable=function(){return this.artisan?"ENC"===this.status:!1},p}]),angular.module("edison").directive("whenScrollEnds",function(){return{restrict:"A",link:function(t,e,n){var i=e.height(),o=100;e.scroll(function(){var r=e.prop("scrollHeight"),a=r-i;a-e.scrollTop()<=o&&t.$apply(n.whenScrollEnds)})}}}),angular.module("edison").factory("Map",function(){"use strict";var t=function(){this.display=!1};return t.prototype.setCenter=function(t){var e=new google.maps.LatLng(t.lt,t.lg);this.center=t,window.map&&window.map.setCenter(e)},t.prototype.setZoom=function(t){window.map&&window.map.setZoom(t),this.zoom=t},t.prototype.show=function(){this.display=!0},t}),angular.module("edison").factory("mapAutocomplete",["$q","Address",function(t,e){"use strict";var n=function(){this.service=new google.maps.places.AutocompleteService,this.geocoder=new google.maps.Geocoder};return n.prototype.search=function(e){var n=t.defer();return this.service.getPlacePredictions({input:e,componentRestrictions:{country:"fr"}},function(t){t&&t.forEach(function(n){n.description===e&&(t=null)}),n.resolve(t||[])}),n.promise},n.prototype.getPlaceAddress=function(n){var i=this;return t(function(t,o){i.geocoder.geocode({address:n.description},function(n,i){return i!==google.maps.places.PlacesServiceStatus.OK?o(i):t(e(n[0]))})})},new n}]),angular.module("edison").factory("openPost",function(){"use strict";return function(t,e){var n=document.createElement("form");n.target="_blank",n.method="POST",n.action=t,_.each(e,function(t,e){var i=document.createElement("input");i.type="text",i.name=e,i.value="object"==typeof t?JSON.stringify(t):t,n.appendChild(i)}),document.body.appendChild(n),n.submit(),n.remove()}}),angular.module("edison").factory("productsList",["$q","dialog","openPost","edisonAPI",function(t,e,n,i){"use strict";var o=function(t){this.produits=t;var e=this;this.ps||i.product.list().then(function(t){e.ps=t.data}),_.each(this.produits,function(t){t.desc.toLowerCase()!=t.title.toLowerCase()&&(t.showDesc=!0)}),this.lastCall=_.now()};return o.prototype={remove:function(t){this.produits.splice(t,1)},moveTop:function(t){if(0!==t){var e=this.produits[t-1];this.produits[t-1]=this.produits[t],this.produits[t]=e}},moveDown:function(t){if(t!==this.produits.length-1){var e=this.produits[t+1];this.produits[t+1]=this.produits[t],this.produits[t]=e}},edit:function(t){var n=this;e.editProduct.open(this.produits[t],function(e){n.produits[t]=e})},add:function(t){return this.lastCall+100>_.now()?0:(this.lastCall=_.now(),this.searchText="",t.quantite=1,void this.produits.push(t))},search:function(t){for(var e=[],n=0;n<this.ps.length;++n){if(t===this.ps[n].title)return[];var i=_.deburr(t).toLowerCase(),o=_.deburr(this.ps[n].title).toLowerCase(),r=_.deburr(this.ps[n].ref).toLowerCase(),a=_.deburr(this.ps[n].desc).toLowerCase();if(_.includes(o,i)||_.includes(r,i)||_.includes(a,i)){var s=_.clone(this.ps[n]);s.random=_.random(),e.push(s)}}return e},getDetail:function(t){if(!t)return 0;var n=this;e.selectSubProduct(t,function(e){var i={showDesc:!0,quantite:1,ref:e.ref,title:t.nom,desc:e.nom+"\n"+t.description.split("-").join("\n"),pu:Number(e.prix)};n.add(i)})},flagship:function(){return _.mapBy(this.produits,"pu")},total:function(){var t=_.round(_.sum(this.produits,function(t){return(t.pu||0)*(t.quantite||0)}),2);return t}},o}]),angular.module("edison").factory("socket",["socketFactory",function(t){"use strict";return console.log(location.protocol+"//"+location.hostname+":1995"),t({ioSocket:io.connect(location.protocol+"//"+location.hostname+":1995")})}]),angular.module("edison").factory("taskList",["dialog","edisonAPI",function(t,e){"use strict";var n=function(t){e.get({to:t,done:!1})};return n.prototype={check:function(t){e.check({_id:t})},add:function(t){e.add(t)}},n}]),angular.module("edison").factory("user",["$window",function(t){"use strict";return t.app_session}]),angular.module("edison").directive("infoAppelSst",["mapAutocomplete","edisonAPI","config",function(t,e,n){"use strict";return{restrict:"E",templateUrl:"/Templates/info-appel-sst.html",scope:{data:"="},link:function(t,e,n){t.embedded=!!n.embedded,console.log(n.embedded)}}}]),angular.module("edison").directive("infoConversation",["mapAutocomplete","edisonAPI","config",function(t,e,n){"use strict";return{restrict:"E",templateUrl:"/Templates/info-conversation.html",scope:{data:"="},link:function(t,e,n){t.embedded=!!n.embedded,console.log(n.embedded)}}}]),angular.module("edison").directive("infoFacture",["mapAutocomplete","edisonAPI","config",function(t,e,n){"use strict";return{restrict:"E",templateUrl:"/Templates/info-facture.html",scope:{data:"="},link:function(i,o,r){i.data;i.config=n,i.autocomplete=t,i.changeAddressFacture=function(e){t.getPlaceAddress(e).then(function(t){i.data.facture=i.data.facture||{},i.data.facture.address=t})},e.compte.list().then(function(t){i.grndComptes=t.data}),i.changeGrandCompte=function(){var t=i.data.facture.compte;i.data.facture=_.find(i.grndComptes,"ref",i.data.facture.compte),i.data.facture.payeur="GRN",i.data.facture.compte=t}}}}]),angular.module("edison").directive("infoFourniture",["config","fourniture",function(t,e){"use strict";return{restrict:"E",templateUrl:"/Templates/info-fourniture.html",scope:{data:"=",display:"=",small:"="},link:function(n,i,o){n.config=t,n.dsp=n.display||!1,n.data.fourniture=n.data.fourniture||[],n.fourniture=e.init(n.data.fourniture)}}}]),angular.module("edison").directive("mainNavbar",["$q","edisonAPI","TabContainer","$timeout","$rootScope","$location","$window",function(t,e,n,i,o,r,a){"use strict";return{restrict:"E",templateUrl:"/Templates/main-navbar.html",scope:{data:"=",display:"=",small:"="},link:function(t,i,s){t.root=o,t._=_,t.tabContainer=n,t.select=function(e){t.selectedTab==e?t.selectedTab=null:t.selectedTab=e},o.$on("closeContextMenu",function(){t.selectedTab=null}),t.search=function(t){t.length>2&&r.url("/search/"+t)},t.logout=function(){e.users.logout().then(function(){a.location.reload()})},t.changeUser=function(t){o.displayUser=t}}}}]),angular.module("edison").directive("artisanCategorie",["config",function(t){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/artisan-categorie.html",transclude:!0,scope:{model:"="},link:function(e,n,i){e.config=t,e.findColor=function(t){var n=_.find(e.model.categories,function(e){return e===t.short_name});return n?t.color:"white"},e.toggleCategorie=function(t){var n=e.model.categories.indexOf(t);n>=0?e.model.categories.splice(n,1):e.model.categories.push(t)}}}}]);var ArtisanCtrl=function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m){"use strict";var h=this;h.config=d,h.dialog=p,h.moment=moment,h.contextMenu=new s("artisan");var v=u.getCurrentTab();if(v.data)var g=v.data;else{var g=new m(f.data);if(v.setData(g),a.id.length>12)h.isNew=!0,g.tmpID=a.id,v.setTitle("SST  "+moment(new Date(parseInt(g.tmpID)).toISOString()).format("HH:mm").toString());else if(v.setTitle("SST  "+a.id),!g)return c.error("Impossible de trouver les informations !"),r.url("/dashboard"),u.remove(v),0}h.data=v.data,h.saveArtisan=function(t){g.save(function(e,n){return e?!1:void(t.contrat?(g=new m(n),g.envoiContrat.bind(n)(t,function(t,e){t||u.close(v)})):u.close(v))})},h.onArtisanFileUpload=function(t,e){l.circular.show("#5fa2db","#fileUploadProgress"),o.artisan.upload(t,e,g.id).then(function(){console.log("reload"),l.circular.hide(),h.loadFilesList()})},h.artisanClickTrigger=function(t){setTimeout(function(){angular.element("#file_"+t+">input").trigger("click")},0)},h.rightClick=function(t){console.log("rightClick"),h.contextMenu.setPosition(t.pageX,t.pageY),h.contextMenu.setData(g),h.contextMenu.open()},h.validIBAN=function(e){return!e||t.isValid(e)},h.fileExist=function(t){return g.file?_.find(g.file,function(e){return _.startsWith(e,t)}):!1},h.loadFilesList=function(){o.artisan.getFiles(g.id).then(function(t){g.file=t.data},console.log)},g.id&&h.loadFilesList(),h.addComment=function(){g.comments.push({login:n.user.login,text:h.commentText,date:new Date}),g.id&&o.artisan.comment(g.id,h.commentText),h.commentText=""};var b=_.after(5,_.throttle(function(){o.artisan.saveTmp(g)},3e4));g.id||i.$watch(function(){return g},b,!0)};ArtisanCtrl.$inject=["IBAN","$timeout","$rootScope","$scope","edisonAPI","$location","$routeParams","ContextMenu","LxProgressService","LxNotificationService","TabContainer","config","dialog","artisanPrm","Artisan"],angular.module("edison").controller("ArtisanController",ArtisanCtrl);var archiveReglementController=function(t,e,n,i,o){var r=e.getCurrentTab(),a=this;a.title="Archives Reglements",r.setTitle("archives RGL"),o.circular.show("#5fa2db","#globalProgress"),t.compta.archivesReglement().success(function(t){o.circular.hide(),a.data=t}),a.moment=moment,a.openLink=function(t){i.url(t)}};archiveReglementController.$inject=["edisonAPI","TabContainer","$routeParams","$location","LxProgressService"],angular.module("edison").controller("archivesReglementController",archiveReglementController);var archivesPaiementController=function(t,e,n,i,o){var r=this,a=e.getCurrentTab();r.type="paiement",r.title="Archives Paiements",a.setTitle("archives PAY"),o.circular.show("#5fa2db","#globalProgress"),t.compta.archivesPaiement().success(function(t){o.circular.hide(),r.data=t}),r.moment=moment,r.openLink=function(t){i.url(t)}};archivesPaiementController.$inject=["edisonAPI","TabContainer","$routeParams","$location","LxProgressService"],angular.module("edison").controller("archivesPaiementController",archivesPaiementController);var AvoirsController=function(t,e,n,i,o,r,a){"use strict";var s=this,l=t.getCurrentTab();l.setTitle("Avoirs"),s.loadData=function(t){o.circular.show("#5fa2db","#globalProgress"),n.compta.avoirs().then(function(t){console.log(t),i.avoirs=t.data,o.circular.hide()})},i.avoirs||s.loadData(),s.reloadAvoir=function(){s.loadData()},s.print=function(t){e("/api/intervention/printAvoir",{data:i.avoirs})},s.printChq=function(t){e("/api/intervention/printAvoirChq",{data:i.avoirs})},s.flush=function(){var t=_.filter(i.avoirs,{checked:!0});n.compta.flushAvoirs(t).then(function(t){r.success(t.data),s.reloadAvoir()})["catch"](function(t){r.error(t.data)})}};AvoirsController.$inject=["TabContainer","openPost","edisonAPI","$rootScope","LxProgressService","LxNotificationService","FlushList"],angular.module("edison").controller("avoirsController",AvoirsController);var ContactArtisanController=function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m){"use strict";var h=this;h.loadPanel=function(t){a.artisan.get(t).then(function(t){h.sst=t.data,h.tab.setTitle("@"+h.sst.nomSociete.slice(0,10))}),a.artisan.getStats(t).then(function(t){new Chartist.Pie(".ct-chart",{series:[{value:t.data.envoye.total,name:"En cours",className:"ct-orange",meta:"Meta One"},{value:t.data.annule.total,name:"annulé",className:"ct-red",meta:"Meta One"},{value:t.data.paye.total,name:"payé",className:"ct-green",meta:"Meta One"}]},{total:t.data.annule.total+t.data.paye.total+t.data.envoye.total,donut:!0,startAngle:270,donutWidth:62}),h.stats=t.data})},h.reloadStats=function(){a.artisan.statsMonths(l.sstid).then(function(t){var e=["Annulé","Payé"],n=[],i=[[],[]];_.each(t.data,function(t){n.push(_.capitalize(moment([t.year,t.month-1]).format("MMMM YYYY"))),i[0].push(t.annule),i[1].push(t.paye)}),h.sstChart={series:e,data:i,labels:n,options:{scaleBeginAtZero:!0},colours:["#F7464A","#46BFBD"]}})},h.tbz=["informations","interventions","historique","signalement","stats","paiements"];var v=h.tbz.indexOf(c.hash());if(t.selectedIndex=v>=0?v:0,h.tab=n.getCurrentTab(),h.recap=c.url().includes("recap")?l.sstid:void 0,h.recap)h.loadPanel(h.recap);else{i.circular.show("#5fa2db","#globalProgress");var g=new s("artisan");g.init(function(t,e){h.config=f,h.moment=moment,g.isInit()||g.setData(e),h.tableFilter="",h.tableLimit=20,d.expendedRow=l.sstid||45,h.tableData=g.getData(),h.loadPanel(h.tableData[0].id),i.circular.hide()})}h.getStaticMap=function(t){return h.sst&&this.sst.address?"/api/mapGetStatic?width=500&height=400&precision=0&zoom=6&origin="+h.sst.address.lt+", "+h.sst.address.lg:void 0},h.reloadData=function(){h.tableData=p("contactFilter")(g.getData(),h.tableFilter)},h.loadMore=function(){h.tableLimit+=10},d.$on("ARTISAN_CACHE_LIST_CHANGE",function(){h.tab.fullUrl===n.getCurrentTab().fullUrl&&g.applyFilter(currentFilter,h.tab.hash)}),h.contextMenu=new r("artisan"),h.rowRightClick=function(t,e){console.log("contactclick"),h.contextMenu.setPosition(t.pageX,t.pageY+200),a.artisan.get(e.id).then(function(t){h.contextMenu.setData(t.data),h.contextMenu.open()})},t.addComment=function(){a.artisan.comment(h.sst.id,t.commentText).then(function(){h.loadPanel(h.sst.id),t.commentText=""})},h.rowClick=function(t,e){if(h.contextMenu.active)return h.contextMenu.close();if(t.metaKey||t.ctrlKey)n.addTab("/artisan/"+e.id,{title:"#"+e.id,setFocus:!1,allowDuplicates:!1});else{if(d.expendedRow===e.id)return 0;d.expendedRow=e.id,h.loadPanel(e.id),c.search("sstid",e.id)}},t.$watchCollection("[selectedIndex, expendedRow]",function(t,e){t&&void 0!==t[0]&&c.hash(h.tbz[t[0]]),"stats"===h.tbz[t[0]]&&h.reloadStats()})};ContactArtisanController.$inject=["$scope","$timeout","TabContainer","LxProgressService","FiltersFactory","ContextMenu","edisonAPI","DataProvider","$routeParams","$location","$q","$rootScope","$filter","config","ngTableParams"],angular.module("edison").controller("ContactArtisanController",ContactArtisanController);var DashboardController=function(t,e,n,i,o,r,a,s,l,c,u,d){var p=this;r._=_,r.root=t,p.openLink=function(t){u.url(t)},p.addTask=function(){o.task.add(p.newTask).then(_.partial(p.reloadTask,p.newTask.to))},p.check=function(t){o.task.check(t._id).then(_.partial(p.reloadTask,p.newTask.to))},p.reloadTask=function(t){p.newTask={to:t,from:i.login},o.task.listRelevant({login:t}).then(function(t){p.taskList=t.data})},p.reloadTask(i.login),p.reloadDashboardStats=function(t){o.intervention.dashboardStats(t).then(function(t){p.tableParams=new l({count:t.data.weekStats.length,sorting:{total:"desc"}},{counts:[],data:t.data.weekStats}),p.stats=t.data})},p.dateSelect=[{nom:"Du jour",date:moment().startOf("day").toDate()},{nom:"De la semaine",date:moment().startOf("week").toDate()},{nom:"Du mois",date:moment().startOf("month").toDate()},{nom:"De l'année",date:moment().startOf("year").toDate()}],p.dateChoice=p.dateSelect[1],this.reloadDashboardStats(p.dateChoice)};DashboardController.$inject=["$rootScope","statsTelepro","dialog","user","edisonAPI","$scope","$filter","TabContainer","NgTableParams","$routeParams","$location","LxProgressService"],angular.module("edison").controller("DashboardController",DashboardController),angular.module("edison").directive("edisonMap",["$window","Map","mapAutocomplete","Address",function(t,e,n,i){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/autocomplete-map.html",scope:{data:"=",client:"=",height:"@",xmarkers:"=",markerClick:"&",isNew:"=",firstAddress:"=",showAddress:"="},link:function(o,r,a){o._height=o.height||315,o.map=new e,o.map.setZoom(_.get(o,"client.address")?12:6),o.isNew&&o.map.show(),o.autocomplete=n,o.mapShow=function(){o.mapDisplay=!0},_.get(o,"client.address.lt")?(o.client.address=i(o.client.address,!0),o.map.setCenter(o.client.address)):(o.map.setCenter(i({lat:46.3333,lng:2.6})),o.map.setZoom(5)),o.changeAddress=function(t){o.firstAddress=!0,n.getPlaceAddress(t).then(function(t){o.map.setZoom(12),o.map.setCenter(t),o.client.address=t})},o.getStaticMap=function(){if(!_.get(o,"data.client.address.lt")&&!_.get(o,"data.address.lt"))return 0;var e="?width="+Math.round(t.outerWidth*("small"===o.height?.8:1.2));return o.client&&o.client.address&&o.client.address.latLng&&(e+="&origin="+o.client.address.latLng),o.data.artisan&&o.data.artisan.address&&(e+="&destination="+o.data.artisan.address.lt+","+o.data.artisan.address.lg),"/api/mapGetStatic"+e},o.showClientMarker=function(){return o.client.address&&o.client.address.latLng},o.clickOnArtisanMarker=function(t,e){o.markerClick({sst:e})}}}}]),angular.module("edison").directive("creditCard",["config",function(t){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/credit-card.html",scope:{model:"="},link:function(e,n,i){e.config=t}}}]);var DevisCtrl=function(t,e,n,i,o,r,a,s,l,c,u,d){"use strict";var p=this;p.config=l,p.dialog=c,p.moment=moment;var f=s.getCurrentTab();if(f.data)var m=f.data;else{var m=new d(u.data);if(f.setData(m),o.id.length>12)p.isNew=!0,m.tmpID=o.id,f.setTitle("DEVIS "+moment(new Date(parseInt(m.tmpID)).toISOString()).format("HH:mm").toString());else if(f.setTitle("DEVIS "+o.id),!m)return a.error("Impossible de trouver les informations !"),i.url("/dashboard"),s.remove(f),0}p.data=f.data;var h=function(t){t||s.close(f)};p.searchArtisans=function(e){_.get(m,"client.address.lt")&&t.artisan.getNearest(m.client.address,e||m.categorie).success(function(t){p.nearestArtisans=t})},p.searchArtisans(),p.saveDevis=function(t){return m.produits&&m.produits.length?void m.save(function(e,n){return e?!1:void(t.envoi?d(n).sendDevis(h):t.annulation?d(n).annulation(h):t.transfert?d(n).transfert():h())}):a.error("Veuillez ajouter au moins 1 produit")},e.$watch(function(){return m.client.civilite},function(t,e){e!=t&&(m.tva="Soc."==t?20:10)});var v=_.after(5,_.throttle(function(){t.devis.saveTmp(m)},3e4));m.id||e.$watch(function(){return m},v,!0)};DevisCtrl.$inject=["edisonAPI","$scope","$rootScope","$location","$routeParams","LxProgressService","LxNotificationService","TabContainer","config","dialog","devisPrm","Devis"],angular.module("edison").controller("DevisController",DevisCtrl),angular.module("edison").directive("infoCategorie",["config",function(t){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/info-categorie.html",transclude:!0,scope:{model:"=",change:"&"},link:function(e,n,i){e.config=t,e.callback=function(t){e.model=t,"function"==typeof e.change&&e.change({newCategorie:t})}}}}]),angular.module("edison").directive("infoClient",["config","edisonAPI",function(t,e){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/info-client.html",transclude:!0,scope:{client:"=model",data:"=",noDetails:"@"},link:function(n,i,o){n.config=t,n.searchPhone=function(t){t.length>2&&e.searchPhone(t).success(function(t){n.searchedPhone=t})["catch"](function(){n.searchedPhone={}})}}}}]),angular.module("edison").directive("infoCompta",["config","Paiement","Intervention",function(t,e,n){"use strict";return{restrict:"E",templateUrl:"/Templates/info-compta.html",scope:{data:"=",displayReglement:"@",dialog:"@",displayPaiement:"@",simulator:"@"},link:function(i,o,r){i.config=t,i.Intervention=n,i.displayReglement&&(i.showPaiement=!0),i.displayPaiement&&(i.showReglement=!0);var a=i.data.compta.reglement,s=i.data.compta.paiement;i.data.tva||(i.data.tva="Soc."==i.data.client.civilite?20:10),s.mode||(s.mode=_.get(i.data.sst,"document.rib.ok")?"VIR":"CHQ"),i.format=function(t){return _.round(t,2).toFixed(2)},i.getPaiement=function(t){var n=_.cloneDeep(i.data);return n.compta.paiement=_.cloneDeep(t),new e(n)},i.Paiement=e,i.compta=new e(i.data),a.montantTTC=i.compta.getMontantTTC(),i.$watchGroup(["data.compta.reglement.montantTTC","data.compta.reglement.avoir","data.tva"],function(t,n){var o=(a.montantTTC||0,100*(100/(100+i.data.tva)));a.montant=e().applyCoeff(a.montantTTC,o),s.base||(s.base=_.round(a.montant-(a.avoir||0),2))});var l=function(t,n,i){i.compta=new e(i.data),s.montant=i.compta.montantTotalTTC};i.$watch("data.fourniture",l,!0),i.$watch("data.compta.paiement.pourcentage.deplacement",l,!0),i.$watch("data.compta.paiement.pourcentage.maindOeuvre",l,!0),i.$watchGroup(["data.compta.reglement.montant","data.compta.paiement.base","data.compta.paiement.tva","data.compta.paiement.pourcentage.deplacement","data.compta.paiement.pourcentage.maindOeuvre"],l,!0),!i.data.compta.paiement.base&&i.data.compta.reglement.montant&&(i.data.compta.paiement.base=i.data.compta.reglement.montant,i.compta=new e(i.data),s.montant=i.compta.montantTotalTTC)}}}]),angular.module("edison").directive("produits",["config","productsList","dialog","openPost","LxNotificationService","Intervention","Devis","edisonAPI",function(t,e,n,i,o,r,a,s){"use strict";return{restrict:"E",templateUrl:"/Templates/info-produit.html",scope:{data:"=",tva:"=",display:"@",model:"@",embedded:"="},link:function(n,o,l){var c=n.data;n.config=t,c.produits=c.produits||[],n.config=t,n.produits=new e(c.produits),s.combo.list().then(function(t){n.combo=t.data}),n.Intervention=r,n.Devis=a,n.data.reglementSurPlace||(n.display=!0),n.$watch("data.produits",function(t,e){_.isEqual(t,e)||(n.data.prixFinal=n.produits.total(),n.data.prixAnnonce=n.produits.total())},!0),n.$watch("data.combo",function(t,i){if(t&&!_.isEqual(t,i)){var o=_.find(n.combo,function(e){return e.ref===t});_.each(o.produits,function(t){t.ref||(t.ref=t.desc.toUpperCase().slice(0,3)+"0"+_.random(9,99))}),c.comboText=o.text,c.produits=o.produits||[],n.produits=new e(c.produits)}},!0),n.displayfact=function(){return n.data.produits.length>0||!n.data.reglementSurPlace||n.dsf},n.changeElemTitle=function(t){t.showDesc||(t.desc=t.title)},n.createProd=function(){c.produits.push({showDesc:!1,desc:"",title:"",pu:0,quantite:0})},n.printDevis=function(){i("/api/intervention/printDevis",{data:JSON.stringify(n.data),html:!0})},n.printFactureAcquitte=function(){i("/api/intervention/printFactureAcquitte",{data:JSON.stringify(n.data),html:!0})}}}}]);var InterventionCtrl=function(t,e,n,i,o,r,a,s,l,c,u,d,p,f,m,h,v,g,b,y,w,T,C){"use strict";var S=this;S.config=y,S.dialog=c,S.autocomplete=g;var P=f.getCurrentTab();if(P.data)var D=P.data;else{var D=new T(w.data);if(D.sst__id=D.sst?D.sst.id:0,P.setData(D),l.id.length>12)S.isNew=!0,D.tmpID=l.id,D.tmpDate=moment.unix(D.tmpID/1e3).format("HH[h]mm"),P.setTitle(D.tmpDate);else{if(D&&D.client.nom){var A=D.client.civilite+D.client.nom;A=A.slice(0,10)}else var A="#"+l.id;if(P.setTitle(A),!D)return d.error("Impossible de trouver les informations !"),s.url("/dashboard"),f.remove(P),0}}l.d&&(D.devisOrigine=parseInt(l.d),D.date={ajout:new Date,intervention:new Date},D.reglementSurPlace=!0,D.modeReglement="CH",D.remarque="PAS DE REMARQUES"),S.data=P.data,a.bv={show:function(t){return this[t]?this[t]=!1:(this.historique=!1,this.absence=!1,this.signalement=!1,void(this[t]=!0))},init:function(){this.historique=this.absence=this.signalement=!1,S.searchArtisans(D.categorie),o(function(){S.searchArtisans(D.categorie)},666)}};var x=_.throttle(function(){P.setTitle(_.template("{{typeof tmpDate == 'undefined' ? id : tmpDate}} - {{client.civilite}} {{client.nom}} ({{client.address.cp}})")(D))},1e3);a.$watch("vm.data.client",x,!0),x(),S.description=new t(D),S.signalement=new e(D),S.contextMenuIntervention=new n("intervention"),S.contextMenuSST=new n("artisan"),S.contextMenu=S.contextMenuIntervention,S.contextMenu.setData(D),S.isAbsent=function(t){return t&&t.length?moment().isAfter(t[t.length-1].start)&&moment().isBefore(t[t.length-1].end):!1},S.rowRightClick=function(t,e){if($(".map-box").has(t.target).length){var n=t.target.getAttribute("id-sst")||_.get(D,"sst.id");n&&(S.rightClickArtisan=n,m.artisan.get(n).then(function(e){S.contextMenu=S.contextMenuSST,S.contextMenu.setData(e.data),S.contextMenu.setPosition(t.pageX,t.pageY+200),S.contextMenu.open().onClose(_.debounce(function(t){S.searchArtisans(D.categorie)},500))}))}else 0==$(".listeInterventions").has(t.target).length&&(S.contextMenu=this.contextMenuIntervention,S.contextMenu.setPosition(t.pageX,t.pageY+200),S.contextMenu.open())},Mousetrap.bind(["command+k","ctrl+k","command+f1","ctrl+f1"],function(){return i.open("appurl:","_self"),m.intervention.scan(D.id).then(function(){a.loadFilesList(),d.success("Le fichier est enregistré")}),!1}),a.calculPrixFinal=function(){return D.reglementSurPlace?0:(D.prixFinal=0,_.each(D.produits,function(t){D.prixFinal+=t.pu*t.quantite}),void(D.prixFinal=Math.round(100*D.prixFinal)/100))},a.addLitige=function(){c.getText({title:"Description du Litige",text:""},function(t){D.litiges||(D.litiges=[]),D.litiges.push({date:new Date,login:r.user.login,description:t,regle:!1})})},a.smsArtisan=function(){D.smsArtisan(function(t,e){t||D.sst.sms.unshift(e)})},a.clickTrigger=function(t){angular.element(t).trigger("click")},a.$watch("fileupload",function(t){t&&1===t.length&&D.fileUpload(t[0],function(t,e){a.fileUploadText="",a.loadFilesList()})}),a.loadFilesList=function(){m.intervention.getFiles(D.id||D.tmpID).then(function(t){D.files=t.data},console.log)},a.loadFilesList();var L=function(t,e,n){t&&t.envoiFacture&&t.verification?D.envoiFactureVerif(n):t&&t.envoiFacture?D.sendFacture(n):t&&t.envoi===!0?(e.files=D.files,D.envoi.bind(e)(n)):t&&t.annulation?D.annulation(n):t&&t.verification?D.verificationSimple(n):n(null)},I=function(t){a.saveInter=function(){console.log("noope")},D.save(function(e,n){e?a.saveInter=I:L(t,n,function(t){t||f.close(P),a.saveInter=I})})};a.saveInter=I;var k=function(t){return t.lt+", "+t.lg};S.selectArtisan=function(t,e){return t?void v.all([m.artisan.get(t.id,{cache:!1}),m.artisan.getStats(t.id,{cache:!0})]).then(function(n){D.sst=D.artisan=n[0].data,D.sst.stats=n[1].data,e||(D.compta.paiement.pourcentage=_.clone(D.sst.pourcentage)),m.getDistance(k(t.address),k(D.client.address)).then(function(t){D.sst.stats.direction=t.data}),S.recapFltr={ai:D.sst.id}}):(D.sst=D.artisan=null,!1)},S.showInterList=function(){},S.sstBase=D.sst,D.sst&&S.selectArtisan(D.sst,!0),S.searchArtisans=function(t){_.get(D,"client.address.lt")&&m.artisan.getNearest(D.client.address,t||D.categorie).success(function(t){S.nearestArtisans=t})},S.searchArtisans(),a.$watch(function(){return D.client.address},function(){S.searchArtisans(D.categorie)}),a.$watch(function(){return D.client.civilite},function(t,e){t!==e&&"Soc."===t&&(D.tva=20,d.info("La TVA à été mise a 20%"))});var M=_.after(5,_.throttle(function(){m.intervention.saveTmp(D)},3e4));D.id||a.$watch(function(){return D},M,!0)};InterventionCtrl.$inject=["Description","Signalement","ContextMenu","$window","$timeout","$rootScope","$scope","$location","$routeParams","dialog","fourniture","LxNotificationService","LxProgressService","TabContainer","edisonAPI","Address","$q","mapAutocomplete","productsList","config","interventionPrm","Intervention","Map"],angular.module("edison").controller("InterventionController",InterventionCtrl);var LpaController=function(t,e,n,i,o,r,a,s,l,c,u,d){"use strict";var p=this,f=a.getCurrentTab();f.setTitle("LPA"),p.search=o.search(),p.contextMenu=new i("intervention"),p.user=t,p.offsetX=1,p.offsetY=-5,console.log(t),p.loadData=function(t){c.circular.show("#5fa2db","#globalProgress"),s.compta.lpa(o.search()).then(function(e){_.each(e.data,function(e){e.list=new d(e.list,t),e.numeroCheque=e.list.getList()[0].numeroCheque,p.search.d&&p.checkArtisan(e),p.reloadList(e)}),l.lpa=e.data,c.circular.hide()})},p.rowRightClick=function(t,e){s.intervention.get(e.id,{populate:"sst"}).then(function(e){p.contextMenu.setData(e.data),p.contextMenu.setPosition(t.pageX,t.pageY+200),p.contextMenu.open()})},l.lpa||p.loadData(),p.checkArtisan=function(t){t.checked=!t.checked,_.each(t.list.getList(),function(e){e.checked=t.checked})},p.updateNumeroCheque=function(t){var e=l.lpa[t].numeroCheque;if(e)for(var n=t;n<l.lpa.length;n++)"CHQ"===l.lpa[n].list.getList()[0].mode&&(l.lpa[n].numeroCheque=e++)},p.flushMail=function(){var t=[];_.each(_.cloneDeep(l.lpa),function(e){e.list.__list=_.filter(e.list.__list,"checked",!0),e.list.__list.length&&t.push(e)}),c.circular.show("#5fa2db","#globalProgress"),s.compta.flushMail(t).then(function(t){console.log("ok"),c.circular.hide(),p.reloadLPA()},function(){console.log("failure"),c.circular.hide(),p.reloadLPA()})},p.flush=function(){var t=[];_.each(_.cloneDeep(l.lpa),function(e){e.list.__list=_.filter(e.list.__list,"checked",!0),e.list.__list.length&&t.push(e)}),c.circular.show("#5fa2db","#globalProgress"),s.compta.flush(t).then(function(t){c.circular.hide(),alert("Les éléments ont été flushés")},function(){c.circular.hide(),alert("Les éléments ont été flushés")})},n.on("intervention_db_flushMail",function(t){100===t?(l.globalProgressCounter="",c.circular.hide(),p.reloadLPA()):l.globalProgressCounter=t+"%"}),p.selectToggle=function(t,e){return this.search.d?!1:(e.checked=!e.checked,void p.reloadList(t))},p.reloadList=function(t){t.total=t.list.getTotal(),t.total=t.list.getTotal(!0),t.total=t.list.getTotal()},p.reloadLPA=function(){var t=[];_.each(l.lpa,function(e){_.each(e.list.getList(),function(e){e.checked&&t.push(e.id)})}),p.loadData(t)},p.clickTrigger=function(t){window.setTimeout(function(){angular.element(t).trigger("click")},0)},p.onFileUpload=function(t){var e=_(l.lpa).map(_.partial(_.pick,_,"numeroCheque","id")).value();c.circular.show("#5fa2db","#globalProgress"),s.file.uploadScans(t,{ids:e,date:p.search.d}).then(function(t){c.circular.hide()})},p.print=function(t){console.log(l.lpa),e("/api/intervention/print",{type:t,data:l.lpa,offsetX:p.offsetX||0,offsetY:p.offsetY||0})}};LpaController.$inject=["user","openPost","socket","ContextMenu","$location","$window","TabContainer","edisonAPI","$rootScope","LxProgressService","LxNotificationService","FlushList"],angular.module("edison").controller("LpaController",LpaController),angular.module("edison").controller("ListeArtisanController",_.noop),angular.module("edison").controller("ListeDevisController",_.noop),angular.module("edison").controller("ListeInterventionController",_.noop);var listeSignalements=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("Liste Signalements"),s.activeTab=parseInt(o.search().level||0);o.search();e.signalement.list(o.search()).then(function(t){i.pl=t.data})};listeSignalements.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("listeSignalements",listeSignalements);var SearchController=function(t,e,n,i,o,r){var a=e.getCurrentTab();a.setTitle("Search");var s=this;s.config=r,s.routeParams=n,o.circular.show("#5fa2db","#globalProgress"),t.bigSearch(n.query).success(function(t){o.circular.hide(),s.data=t}),s.openLink=function(t){i.url(t)},s.open=function(t){i.url(t)}};SearchController.$inject=["edisonAPI","TabContainer","$routeParams","$location","LxProgressService","config"],
angular.module("edison").controller("SearchController",SearchController);var StatsNewController=function(t,e,n,i,o,r,a,s,l){"use strict";var c=this;c.tab=e.getCurrentTab(),c.tab.setTitle("Stats");var u=new Date,d=new Date(2013,8,1);c.dateSelect=t(d,u).range("month").map(function(t){return{t:t.format("MMM YYYY"),m:t.month()+1,y:t.year()}}).reverse();var p=_.pick(c.dateSelect[0],"m","y");c.yearSelect=t(d,u).range("year",{format:"YYYY"}).map(function(t){return parseInt(t)});var f=function(t,e,n,i){return{chart:{zoomType:"x",type:t},title:{text:e},xAxis:{categories:i},yAxis:{min:0,title:{text:"Chiffre"}},tooltip:{shared:!0,valueSuffix:" €"},plotOptions:{animation:!1,column:{pointPadding:0,groupPadding:.04,borderWidth:0,animation:!1},area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}},areaspline:{stacking:"normal"}},series:n}};c.typeSelect=["column","areaspline","area","line","pie","bar","spline"],r.selectedType="column",c.dividerSelect=["categorie","chiffre","telepro"],r.selectedDivider="chiffre";var m=function(){i.intervention.statsBen({month:r.selectedDate.m,year:r.selectedDate.y,group:"day",model:"ca",divider:r.selectedDivider}).then(function(t){var e=t.data;$("#chartContainer").highcharts(f(r.selectedType,e.title,e.series,e.categories))})},h=function(){i.intervention.statsBen({year:r.selectedDate.y,group:"month",model:"ca",divider:r.selectedDivider}).then(function(t){g(t.data);var e=t.data;$("#chartContainer2").highcharts(f(r.selectedType,e.title,e.series,e.categories))})},v=function(){i.intervention.statsBen({year:r.selectedDate.y,group:"week",model:"ca",divider:r.selectedDivider}).then(function(t){var e=t.data;$("#chartContainer3").highcharts(f(r.selectedType,e.title,e.series,e.categories))})};r.$watch("selectedType",function(){m(),h(),v()});var g=function(t){r.totalYear={recu:0,potentiel:0},_.times(t.categories.length,function(e){r.totalYear[t.series[0].name]+=t.series[0].data[e],r.totalYear[t.series[1].name]+=t.series[1].data[e]})};r.$watch("selectedDivider",function(){m(),h(),v()}),r.$watch("selectedYear",function(){h(),v()}),r.$watch("selectedDate",function(t){return t&&t.m&&t.y?(a.search("m",t.m),a.search("y",t.y),m(t),void h()):!1},!0),a.search().m&&(p.m=parseInt(a.search().m)),a.search().y&&(p.y=parseInt(a.search().y)),r.selectedDate=_.find(c.dateSelect,p),r.selectedYear=r.selectedDate.y.toString()};StatsNewController.$inject=["MomentIterator","TabContainer","$routeParams","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("StatsNewController",StatsNewController);var StatsController=function(t,e,n,i,o,r,a,s,l){"use strict";var c=this;c.tab=e.getCurrentTab(),c.tab.setTitle("Stats");var u=new t;c.yearSelect=[],_.times(u.current.y-u.start.y+1,function(t){c.yearSelect.push(u.start.y+t)}),r.selectedYear=u.current.y,r.$watch("selectedYear",function(t){i.intervention.statsBen({y:t}).then(function(t){console.log(t.data),$("#chartContainer2 > *").remove();var e=dimple.newSvg("#chartContainer2",1070,400),n=new dimple.chart(e,t.data);n.setBounds(60,30,1e3,300);var i=(n.addCategoryAxis("x","mth"),n.addMeasureAxis("y","montant"));i.tickFormat=",.0f",n.addSeries("potentiel",dimple.plot.bar),n.addLegend(60,10,410,20,"right"),n.draw(),r.totalYear={potentiel:0,recu:0},_.each(t.data,function(t){r.totalYear[t.potentiel?"potentiel":"recu"]+=t.montant})})}),r.$watch("selectedDate",function(t){return t&&t.m&&t.y?(a.search("m",t.m),a.search("y",t.y),void i.intervention.statsBen(t).then(function(t){$("#chartContainer > *").remove();var e=dimple.newSvg("#chartContainer",1300,400),n=new dimple.chart(e,t.data);n.setBounds(60,30,1e3,300);var i=(n.addCategoryAxis("x","day"),n.addMeasureAxis("y","prix"));i.tickFormat=",.0f",n.addSeries("recu",dimple.plot.bar),n.assignColor("En Attente","#2196F3"),n.assignColor("Encaissé","#4CAF50"),n.addLegend(60,10,410,20,"right"),n.draw()})):!1}),a.search().m&&(u.current.m=parseInt(a.search().m)),a.search().y&&(u.current.y=parseInt(a.search().y)),c.dateSelect=u.list(),r.selectedDate=_.find(u.list(),u.current)};StatsController.$inject=["DateSelect","TabContainer","$routeParams","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("StatsController",StatsController);var commissionsPartenariat=function(t,e,n,i,o,r,a,s,l){"use strict";var c=this;c.tab=e.getCurrentTab(),c.tab.setTitle("Coms."),s.circular.show("#5fa2db","#globalProgress"),i.artisan.tableauCom().then(function(t){s.circular.hide(),console.log(t.data),c.data=t.data})};commissionsPartenariat.$inject=["MomentIterator","TabContainer","$routeParams","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("commissionsPartenariat",commissionsPartenariat);var CommissionsController=function(t,e,n,i,o,r,a,s,l){"use strict";var c=this;c.tab=e.getCurrentTab(),c.tab.setTitle("Coms."),c.xcalc=function(t){return"VT"===t.categorie?1.5:_.round(.01*(t.compta.reglement.montant||t.compta.paiement.base||t.prixFinal),2)},c.getTotal=function(){var t={com:0,all:0};return _.each(r.list,function(e){t.com+=c.xcalc(e),t.all+=e.compta.reglement.montant||0}),t};var u=new Date,d=new Date(2013,8,1);c.dateSelect=t(d,u).range("month").map(function(t){return{t:t.format("MMM YYYY"),m:t.month()+1,y:t.year()}}).reverse();var p=_.pick(c.dateSelect[0],"m","y");r.usrs=_.filter(window.app_users,"service","INTERVENTION"),r.selectedUser=a.search().l||r.usrs[0].login;var f=_.debounce(function(){s.circular.show("#5fa2db","#globalProgress"),i.intervention.commissions(_.merge(r.selectedDate,{l:r.selectedUser})).then(function(t){s.circular.hide(),r.list=t.data,r.total=c.getTotal()})},50);r.$watch("selectedUser",function(t,e){a.search("l",t),f()}),r.$watch("selectedDate",function(t,e){a.search("m",t.m),a.search("y",t.y),f()}),a.search().m&&(p.m=parseInt(a.search().m)),a.search().y&&(p.y=parseInt(a.search().y)),r.selectedDate=_.find(c.dateSelect,p)};CommissionsController.$inject=["MomentIterator","TabContainer","$routeParams","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("CommissionsController",CommissionsController);var editCombos=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("Combos");var l={id:29300,categorie:"PL",description:"RECHERCHE DE PANNE ELCTRIQUE",sst:31,file:[],tva:10,coutFourniture:0,enDemarchage:!1,aDemarcher:!1,reglementSurPlace:!1,prixFinal:0,prixAnnonce:130,modeReglement:"CH",fourniture:[],produits:[],remarque:"Pas de remarque(s)",descriptionTags:[],artisan:{id:31,nomSociete:"SODESEN"},savEnCours:!0,litigesEnCours:!0,litiges:[],sav:[],client:{civilite:"M.",nom:"DELORME",email:"",location:[45.7592,4.77779],address:{n:"19",r:"RUE DES CERISIERS",v:"TASSIN-LA-DEMI-LUNE",cp:"69160",lt:45.7592,lg:4.77779},telephone:{tel1:"0478346059",origine:"0478346059"},prenom:"CHRISTIAN"},facture:{civilite:"M.",nom:"DELORME",email:"",location:[45.7592,4.77779],address:{n:"19",r:"RUE DES CERISIERS",v:"TASSIN-LA-DEMI-LUNE",cp:"69160",lt:45.7592,lg:4.77779},telephone:{tel1:"0478346059",origine:"0478346059"},prenom:"CHRISTIAN"},produits:[],historique:[],comments:[],date:{intervention:"2015-09-17T11:00:00.000Z",envoi:"2015-09-17T09:11:14.000Z",ajout:"2015-09-17T09:11:14.000Z"},login:{ajout:"clement_b",envoi:"clement_b"},status:"ENC"};e.combo.list().then(function(t){i.plSave=t.data,i.pl=_.map(t.data,s.extend)}),s.extend=function(t){var e=_.assign(_.clone(l),t);return console.log(e,t),e},s.save=function(){e.combo.save(i.pl).then(function(t){i.pl=_.map(t.data,s.extend),r.success("Les produits on été mis a jour")},function(t){r.error("Une erreur est survenu ("+JSON.stringify(t.data)+")")})},s.remove=function(t){i.pl.splice(_.findIndex(i.pl,"_id",t._id),1)},s.getInter=function(t){var e=_.clone(l);return e.produits=t.produits,e},s.add=function(){i.pl.push({produits:[],title:"",open:!0,text:""})}};editCombos.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editCombos",editCombos);var editComptes=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("grand Comptes"),e.compte.list().then(function(t){i.pl=t.data,console.log(i.pl)}),s.save=function(){e.compte.save(i.pl).then(function(t){r.success("Les comptes on été mis a jour")},function(t){r.error("Une erreur est survenu ("+JSON.stringify(t.data)+")")})},s.remove=function(t){i.pl.splice(_.findIndex(i.pl,"_id",t._id),1)}};editComptes.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editComptes",editComptes);var editProducts=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("Produits");var l=function(t){return t.single=_(t.desc).deburr().toLowerCase()!==_(t.title).deburr().toLowerCase(),t};e.product.list().then(function(t){i.pl=_.map(t.data,l)}),s.remove=function(t){i.pl.splice(_.findIndex(i.pl,"_id",t._id),1)},s.save=function(){e.product.save(i.pl).then(function(t){i.pl=_.map(t.data,l),r.success("Les produits on été mis a jour")},function(t){r.error("Une erreur est survenu ("+JSON.stringify(t.data)+")")})}};editProducts.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editProducts",editProducts);var editSignalements=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("Signalements"),e.signal.list().then(function(t){i.pl=t.data}),s.remove=function(t){var e=_.findIndex(i.pl,"_id",t);i.pl.splice(e,1)},s.save=function(){e.signal.save(i.pl).then(function(t){i.pl=t.data,r.success("Les produits on été mis a jour")},function(t){r.error("Une erreur est survenu ("+JSON.stringify(t.data)+")")})}};editSignalements.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editSignalements",editSignalements);var editUsers=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("Utilisateurs"),e.users.list().then(function(t){i.usrs=t.data}),s.save=function(){e.users.save(i.usrs).then(function(){r.success("Les utilisateurs on été mis a jour")},function(t){r.error("Une erreur est survenu ("+JSON.stringify(t.data)+")")})},s.remove=function(t){i.usrs.splice(_.findIndex(i.usrs,"_id",t._id),1)}};editUsers.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editUsers",editUsers);var telephoneMatch=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("TelMatch"),i.__txt_tel=n.__txt_tel,n.getTelMatch=function(){r.circular.show("#5fa2db","#globalProgress"),n.__txt_tel=i.__txt_tel,e.intervention.getTelMatch({q:n.__txt_tel}).then(_.noop,function(){r.circular.hide()})},a.on("intervention_db_telMatches",function(t){n.globalProgressCounter=t+"%"}),a.on("telephoneMatch",function(t){n.globalProgressCounter="",r.circular.hide(),i.resp=t})};telephoneMatch.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("telephoneMatch",telephoneMatch);var userHistory=function(t,e,n,i,o,r,a){"use strict";var s=this;s.tab=t.getCurrentTab(),s.tab.setTitle("User History"),e.user.history(o.search().login).then(function(t){i.history=t.data}),s.xclick=function(t){s.selectedRow=s.selectedRow==t.date?null:t.date}};userHistory.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("userHistory",userHistory);
//# sourceMappingURL=dist.min.js.map
