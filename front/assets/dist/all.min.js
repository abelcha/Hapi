angular.module("edison",["browserify","ui.slimscroll","ngMaterial","lumx","ngAnimate","xeditable","btford.socket-io","ngFileUpload","pickadate","ngRoute","ngResource","ngTable","ngMap"]).config(["$mdThemingProvider",function(e){"use strict";e.theme("default").primaryPalette("indigo").accentPalette("blue-grey")}]).run(["editableOptions",function(e){"use strict";e.theme="bs3"}]).run(["$templateCache","$route","$http",function(e,t,a){var i;for(var l in t.routes)(i=t.routes[l].templateUrl)&&a.get(i,{cache:e});a.get("/Directives/dropdown-row.html",{cache:e}),a.get("/Templates/artisan-categorie.html",{cache:e}),a.get("/Templates/info-client.html",{cache:e}),a.get("/Templates/info-categorie.html",{cache:e}),a.get("/Templates/autocomplete-map.html",{cache:e})}]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|callto|mailto|file|tel):/)}]);
angular.module("edison").controller("MainController",["$timeout","LxNotificationService","$q","DataProvider","TabContainer","$scope","socket","config","$rootScope","$location","edisonAPI","taskList","$window",function(n,t,o,i,e,a,s,r,c,u,l,d,f){"use strict";c.app_users=app_users,c.displayUser=app_session,a.sidebarHeight=$("#main-menu-bg").height(),a.config=r,a._=_,c.loadingData=!0,c.$on("$routeChangeSuccess",function(){f.scrollTo(0,0),c.loadingData=!1});var p=function(){c.smallWin=window.innerWidth<1200,n(function(){c.smallWin&&(c.sideBarIsOpen=!0)})};$(window).resize(p),p(),a.toggleSidebar=function(n){return n&&!c.smallWin?0:void(a.sideBarIsOpen=n)},a.shadowClick=function(n){u.url(n)},a.dateFormat=moment().format("llll").slice(0,-5),c.options={showMap:!0};var g=function(){l.bfm.get().then(function(n){c.events=n.data})};s.on("event",_.debounce(g,_.random(0,3e3))),g();var v=function(){l.stats.telepro().success(function(n){a.userStats=_.find(n,function(n){return n.login===a.user.login}),c.interventionsStats=n})};c.user=window.app_session,v(),s.on("filterStatsReload",function(n){a.userStats=_.find(n,function(n){return n.login===a.user.login}),c.interventionsStats=n}),s.on("notification",function(n){n.dest===c.user.login&&n.dest!==n.origin&&t.notify(n.message,"android",!1,n.color)}),c.openTab=function(n){},c.closeContextMenu=function(n){c.$broadcast("closeContextMenu")};new i("devis"),new i("artisan"),new i("intervention");this.tabContainer=e,a.$on("$locationChangeStart",function(n){return _.includes(["/intervention","/devis","/artisan","/"],u.path())?0:void e.add(u).order()}),a.taskList=d,a.linkClick=function(n){n.preventDefault(),n.stopPropagation()},a.tabIconClick=function(n,t){n.preventDefault(),n.stopPropagation(),a.tabs.close(t)}}]);
var getIntervention=function(e,t,r){"use strict";var o=e.current.params.id;if(e.current.params.d){var n=t.defer();return t.all([r.devis.get(e.current.params.d,{select:"date login produits tva client prixAnnonce categorie -_id"}),r.intervention.getTmp(0)]).then(function(e){n.resolve(_.merge(e[1],e[0]))}),n.promise}return o.length>10?r.intervention.getTmp(o):r.intervention.get(o,{populate:"sst"})};getIntervention.$inject=["$route","$q","edisonAPI"];var getDevis=function(e,t,r){"use strict";var o=e.current.params.id;return e.current.params.i?r.intervention.get(e.current.params.i,{select:"client categorie tva -_id"}):o.length>10?r.devis.getTmp(o):r.devis.get(o)};getDevis.$inject=["$route","$q","edisonAPI"];var getArtisan=function(e,t,r){"use strict";var o=e.current.params.id;return o.length>10?r.artisan.getTmp(o):r.artisan.get(o)};angular.module("edison").config(["$routeProvider","$locationProvider",function(e,t){"use strict";e.when("/",{redirectTo:"/dashboard"}).when("/intervention/list",{templateUrl:"Pages/ListeInterventions/listeInterventions.html",controller:"ListeInterventionController",controllerAs:"vm",reloadOnSearch:!1}).when("/intervention/list/:fltr",{templateUrl:"Pages/ListeInterventions/listeInterventions.html",controller:"ListeInterventionController",controllerAs:"vm",reloadOnSearch:!1}).when("/intervention",{redirectTo:function(e,t,r){var o=r.devis?"?d="+r.devis:"";return"/intervention/"+Date.now()+o}}).when("/intervention/:id",{templateUrl:"Pages/Intervention/intervention.html",controller:"InterventionController",controllerAs:"vm",reloadOnSearch:!1,resolve:{interventionPrm:getIntervention}}).when("/devis/list",{templateUrl:"Pages/ListeDevis/listeDevis.html",controller:"ListeDevisController",controllerAs:"vm",reloadOnSearch:!1}).when("/devis/list/:fltr",{templateUrl:"Pages/ListeDevis/listeDevis.html",controller:"ListeDevisController",controllerAs:"vm",reloadOnSearch:!1}).when("/devis",{redirectTo:function(e,t,r){var o=r.i?"?i="+r.i:"";return"/devis/"+Date.now()+o}}).when("/devis/:id",{templateUrl:"Pages/Intervention/devis.html",controller:"DevisController",controllerAs:"vm",resolve:{devisPrm:getDevis}}).when("/artisan/contact",{templateUrl:"Pages/ListeArtisan/contactArtisan.html",controller:"ContactArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan/:sstid/recap",{templateUrl:"Pages/ListeArtisan/contactArtisan.html",controller:"ContactArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan/list",{templateUrl:"Pages/ListeArtisan/listeArtisan.html",controller:"ListeArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan/list/:fltr",{templateUrl:"Pages/ListeArtisan/listeArtisan.html",controller:"ListeArtisanController",controllerAs:"vm",reloadOnSearch:!1}).when("/artisan",{redirectTo:function(){return"/artisan/"+Date.now()}}).when("/artisan/:id",{templateUrl:"Pages/Artisan/artisan.html",controller:"ArtisanController",controllerAs:"vm",resolve:{artisanPrm:getIntervention}}).when("/dashboard",{controller:"DashboardController",templateUrl:"Pages/Dashboard/dashboard.html",controllerAs:"vm"}).when("/search/:query",{templateUrl:"Pages/Search/search.html",controller:"SearchController",controllerAs:"vm"}).when("/compta/lpa",{templateUrl:"Pages/LPA/LPA.html",controller:"LpaController",controllerAs:"vm"}).when("/compta/avoirs",{templateUrl:"Pages/Avoirs/avoirs.html",controller:"avoirsController",controllerAs:"vm"}).when("/compta/archivesPaiement",{templateUrl:"Pages/Archives/archives.html",controller:"archivesPaiementController",controllerAs:"vm"}).when("/compta/archivesReglement",{templateUrl:"Pages/Archives/archives.html",controller:"archivesReglementController",controllerAs:"vm"}).when("/tools/telephoneMatch",{templateUrl:"Pages/Tools/telephoneMatch.html",controller:"telephoneMatch",controllerAs:"vm"}).when("/tools/editProducts",{templateUrl:"Pages/Tools/edit-products.html",controller:"editProducts",controllerAs:"vm"}).when("/tools/editComptes",{templateUrl:"Pages/Tools/edit-comptes.html",controller:"editComptes",controllerAs:"vm"}).when("/tools/editCombos",{templateUrl:"Pages/Tools/edit-combos.html",controller:"editCombos",controllerAs:"vm"}).when("/tools/editUsers",{templateUrl:"Pages/Tools/edit-users.html",controller:"editUsers",controllerAs:"vm"}).when("/tools/commissions",{templateUrl:"Pages/Tools/commissions.html",controller:"CommissionsController",controllerAs:"vm",reloadOnSearch:!1}).when("/stats/:type",{templateUrl:"Pages/Stats/stats.html",controller:"StatsController",controllerAs:"vm",reloadOnSearch:!1}).otherwise({redirectTo:"/dashboard"}),t.html5Mode(!0)}]);
function allowPatternDirective(){return{restrict:"A",compile:function(e,t){return function(e,t,r){t.bind("keypress",function(e){var t=e.which||e.keyCode,n=String.fromCharCode(t);return n.match(new RegExp(r.allowPattern,"i"))?void 0:(e.preventDefault(),!1)})}}}}angular.module("edison").directive("allowPattern",[allowPatternDirective]);
angular.module("edison").directive("capitalize",function(){"use strict";return{require:"ngModel",link:function(e,r,t,n){n.$parsers.push(function(e){return"string"==typeof e?e.toUpperCase():""}),r.css("text-transform","uppercase")}}});

angular.module("edison").directive("creditcard",function(){"use strict";return{require:"ngModel",scope:{inline:"="},link:function(e,n,r,i){i.$parsers.push(function(e){return e.replace("x","AAA")})}}});
angular.module("edison").directive("dropdownRow",["Devis","productsList","edisonAPI","config","$q","$timeout","Intervention",function(t,e,a,d,i,n,s){"use strict";return{restrict:"E",replace:!0,templateUrl:"/Directives/dropdown-row.html",scope:{model:"@",row:"="},link:function(n,r,o){if(n._=_,n.Intervention=s,n.Devis=t,n._model=n.model||"intervention",n.expendedStyle={height:0,overflow:"hidden"},n.expendedReady=!1,n.data={},n.config=d,"intervention"===n._model)a.intervention.get(n.row.id,{populate:["sst","devisOrigine"].join(",")}).then(function(t){n.data=t.data,n.data.produits&&(n.produits=new e(n.data.produits)),n.client=n.data.client,n.address=n.client.address});else if("devis"===n._model)var l=[a.devis.get(n.row.id,{populate:"transfertId"})],c=function(t){n.data=t[0].data,n.produits=new e(n.data.produits),n.hist=n.data.historique,n.client=n.data.client,n.address=n.client.address};else"artisan"===n._model&&(l=[a.artisan.get(n.row.id),a.artisan.getStats(n.row.id)],c=function(t){n.data=t[0].data,n.artisan=n.data,n.artisan.stats=t[1].data,n.address=n.artisan.address});i.all(l).then(c),n.getStaticMap=function(){var t="?format=jpg&width=411&height=210px&precision=0&origin="+n.address.lt+", "+n.address.lg;return t+=_.get(n,"data.artisan.address.lt")?"&destination="+n.data.artisan.address.lt+", "+n.data.artisan.address.lg:"&zoom=15","/api/mapGetStatic"+t}}}}]);
angular.module("edison").directive("elastic",["$timeout",function(i){return{restrict:"A",link:function(t,e){t.initialHeight=t.initialHeight||e[0].style.height;var n=function(){e[0].style.height=t.initialHeight,e[0].style.height=""+e[0].scrollHeight+"px"};e.on("input change",n),i(n,0)}}}]);
angular.module("edison").directive("ngEnter",function(){"use strict";return function(n,e,t){e.bind("keydown keypress",function(e){13===e.which&&(n.$apply(function(){n.$eval(t.ngEnter)}),e.preventDefault())})}});
angular.module("edison").directive("infoComment",["user",function(e){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-comment.html",scope:{data:"="},link:function(t,n,m){t.height=m.height||216,t.user=e,t.addComment=function(){t.data.comments.push({login:e.login,text:t.commentText,date:new Date}),t.commentText=""}}}}]);
angular.module("edison").directive("infoLitige",function(){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-litige.html",scope:{data:"="},link:function(i,t){i.$watch("data.litige.description",function(t,e){i.data.litige&&!i.data.litige.closed&&i.data.litige.description&&(i.data.litige.open=!0),i.data.litige&&!i.data.litige.description&&(i.data.litige.open=!1)})}}});
angular.module("edison").directive("infoSav",["config",function(t){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/info-sav.html",scope:{data:"=",artisans:"="},link:function(e,n){e.config=t,console.log(t.savStatus)}}}]);
var Controller=function(e,t,r,i,n,o,a,l,s,c,d,u,p,m){var f=this;o.circular.show("#5fa2db","#globalProgress");var g,h=c.hash(),v=new l(f.model,s.hashModel),b=new r(f.model);s.fltr&&(g=b.getFilterByUrl(s.fltr)),f.routeParamsFilter=s.fltr,f.embedded&&f.$watch("filter",function(){_.size(f.filter)&&(f.customFilter=function(e){for(var t in f.filter)if(f.filter[t]!==e[t])return!1;return!0},f.tableParams&&(v.applyFilter({},f.tab.hash,f.customFilter),f.tableParams.reload()))}),f.displaySubRow=function(e){return f.expendedRow&&f.expendedRow===e.id},f.smallWin=window.innerWidth<1400,$(window).resize(function(){f.smallWin=window.innerWidth<1400}),f.tab=t.getCurrentTab(),f.tab.hash=h,f.config=p;var P=g?g.long_name:f.model;if(s.sstid){var x=parseInt(s.sstid);f.customFilter=function(e){return e.ai===x}}else f.tab.setTitle(P,h);s.sstids_in&&(f.customFilter=function(e){return _.contains(s.sstids_in,e.id)});var w=_.throttle(function(e,t){c.search("page",1!==t?t:void 0),_.each(e,function(e,t){e||(e=void 0),"hashModel"!==e&&c.search(t,e)})},250);"relanceClient"===f.routeParamsFilter?sorting={l:"asc"}:sorting={id:"desc"},v.init(function(e,t){v.applyFilter(g,f.tab.hash,f.customFilter);var r={page:c.search().page||1,total:v.filteredData.length,filter:_.omit(c.search(),"hashModel","page","sstid"),sorting:sorting,count:f.limit||100},i={total:v.filteredData,getData:function(e,t){w(t.filter(),t.page());var r=v.filteredData;f.embedded||(r=u("tableFilter")(r,t.filter())),f.currentFilter=_.clone(t.filter()),t.total(r.length),r=u("orderBy")(r,t.orderBy()),e.resolve(r.slice((t.page()-1)*t.count(),t.page()*t.count()))},filterDelay:100};f.tableParams=new m(r,i),o.circular.hide()});if(d.$on(f.model.toUpperCase()+"_CACHE_LIST_CHANGE",function(e,r){t.getCurrentTab()&&f.tab.fullUrl===t.getCurrentTab().fullUrl&&(v.applyFilter(g,f.tab.hash,f.customFilter),f.tableParams.reload())}),f.contextMenu=new n(f.model),"COMPTABILITE"===i.service){var C=_.findIndex(f.contextMenu.list,"title","Appels");if(C){var F=f.contextMenu.list[C];f.contextMenu.list.splice(C,1),f.contextMenu.list.push(F)}}f.rowRightClick=function(e,t){a[f.model].get(t.id,{populate:"sst"}).then(function(t){f.contextMenu.setData(t.data),f.contextMenu.setPosition(e.pageX-(s.sstid||f.embedded?50:0),e.pageY+(s.sstid||f.embedded?0:200)),f.contextMenu.open()})},f.rowClick=function(e,r){return f.contextMenu.active?f.contextMenu.close():void(e.metaKey||e.ctrlKey?t.addTab("/"+f.model+"/"+r.id,{title:"#"+r.id,setFocus:!1,allowDuplicates:!1}):f.expendedRow===r.id?f.expendedRow=void 0:f.expendedRow=r.id)}};angular.module("edison").directive("lineupIntervention",["$timeout","TabContainer","FiltersFactory","user","ContextMenu","LxProgressService","edisonAPI","DataProvider","$routeParams","$location","$rootScope","$filter","config","ngTableParams",function(e,t,r,i,n,o,a,l,s,c,d,u,p,m){"use strict";var f=arguments;return{replace:!1,restrict:"E",templateUrl:"/Templates/lineup-intervention.html",scope:{limit:"=",embedded:"=",filter:"="},controller:["$scope",function(e){e.model="intervention",Controller.apply(e,f)}]}}]),angular.module("edison").directive("lineupDevis",["$timeout","TabContainer","FiltersFactory","user","ContextMenu","LxProgressService","edisonAPI","DataProvider","$routeParams","$location","$rootScope","$filter","config","ngTableParams",function(e,t,r,i,n,o,a,l,s,c,d,u,p,m){"use strict";var f=arguments;return{replace:!1,restrict:"E",templateUrl:"/Templates/lineup-devis.html",scope:{filter:"="},controller:["$scope",function(e){e.model="devis",Controller.apply(e,f)}]}}]),angular.module("edison").directive("lineupArtisan",["$timeout","TabContainer","FiltersFactory","user","ContextMenu","LxProgressService","edisonAPI","DataProvider","$routeParams","$location","$rootScope","$filter","config","ngTableParams",function(e,t,r,i,n,o,a,l,s,c,d,u,p,m){"use strict";var f=arguments;return{replace:!1,restrict:"E",templateUrl:"/Templates/lineup-artisan.html",scope:{},controller:["$scope",function(e){e.model="artisan",Controller.apply(e,f)}]}}]);
angular.module("edison").directive("ngRightClick",["$parse",function(e){"use strict";return function(n,t,i){t.bind("contextmenu",function(t){t.altKey||t.ctrlKey||t.shiftKey||["INPUT","TEXTAREA"].indexOf(t.target.nodeName)>=0||n.$apply(function(){t.preventDefault(),e(i.ngRightClick)(n,{$event:t})})})}}]);
angular.module("edison").directive("link",["FiltersFactory","$rootScope",function(t,e){"use strict";return{restrict:"AE",replace:!0,template:'<li>      <a href="{{fullUrl}}" >            <i ng-if="icon" class = "menu-icon fa fa-{{icon}}"> </i>            <span ng-class="{bold : bold, textWhite: textWhite}" class="mm-text">{{title || exFltr.long_name}}</span>            <span ng-if="total"class="label label-{{_color}}">{{total}}</span>        </a>      </li>',scope:{fltr:"@",login:"@",today:"@",icon:"@",title:"@",url:"@",textWhite:"@",model:"@",bold:"@",count:"@",noCounter:"@",color:"@",hashModel:"@"},link:function(n,i,l){var o=function(){if(n.noCounter)return void 0;var t=0;if(n.login){var i=_.find(e.interventionsStats,function(t){return t.login===n.login});t+=_.get(i,n.fltr+".total",0)}else _.each(e.interventionsStats,function(e){t+=_.get(e,n.fltr+".total",0)});return t};e.$watch("interventionsStats",function(){n.total=o()}),n.$watch("login",function(e,i){n._color=n.color||"success",n._model=n.model||"intervention";var l=new t(n._model);n.exFltr=l.getFilterByName(n.fltr),n.total=o(),n.exFltr=n.exFltr||{url:""},n._url=n.exFltr.url.length?"/"+n.exFltr.url:n.exFltr.url,n._login=n.login&&!n.hashModel?"#"+n.login:"",n._hashModel=n.hashModel?"?"+n.hashModel+"="+n.login:"",n.fullUrl=n.url||"/"+n._model+"/list"+n._url+n._hashModel+n._login})}}}]),angular.module("edison").directive("simpleLink",["FiltersFactory","$rootScope",function(t,e){"use strict";return{restrict:"AE",replace:!0,template:'<li>      <a href="{{url}}"  target="{{target}}">            <i ng-if="icon" class = "menu-icon fa fa-{{icon}}"> </i>            <span class="mm-text">{{title}}</span>        </a>      </li>',scope:{icon:"@",title:"@",url:"@"},link:function(t,e,n){t.target="string"==typeof n.extern?"_blank":""}}}]),angular.module("edison").directive("linkSeparator",[function(){"use strict";return{restrict:"AE",replace:!0,template:'<li>      <a>            <i ng-if="icon" class = "menu-icon fa fa-{{icon}}"> </i>            <strong><span class="mm-text">{{title}}</span></strong>        </a>      </li>',scope:{icon:"@",title:"@"},link:function(t,e,n){}}}]),angular.module("edison").service("sidebarSM",function(){var t=function(){this.display=!1};return t.prototype.set=function(t,e){this[t]=e},new t}),angular.module("edison").directive("sideBar",["sidebarSM",function(t){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Directives/side-bar.html",transclude:!0,scope:{},link:function(e,n,i){e.sidebarSM=t}}}]),angular.module("edison").directive("dropDown",["config","sidebarSM","$timeout",function(t,e,n){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Directives/dropdown.html",transclude:!0,scope:{title:"@",icon:"@",isOpen:"@",openDefault:"&"},link:function(t,i,l){t.openDefault=t.$eval(t.openDefault),t.isopen=t.openDefault,t.toggleSidebar=function(l,o){var r=$(i).find(">ul");$("#main-menu").width()>200?t.isopen?r.velocity({height:0},200,function(){t.$apply(function(){t.isopen=!1})}):(r.css("height","100%"),t.isopen=!0):($("#mmc-ul > .mmc-wrapper").html(r.find("> *")),e.set("display",!0),n(function a(){$("#mmc-ul").is(":hover")?n(a,1e3):(e.set("display",!1),r.html($("#mmc-ul > .mmc-wrapper").find(">*")),$("#mmc-ul > .mmc-wrapper").html(""))},1e3))}}}}]);
angular.module("edison").directive("signalement",function(){"use strict";return{replace:!1,restrict:"E",templateUrl:"/Templates/signalement.html",scope:{sst:"=",exit:"&"},link:function(e,t){console.log("==>",e.exit),e.hide=function(){e.exit()}}}});
angular.module("edison").filter("contactFilter",["config",function(n){"use strict";var r=function(n){return _.deburr(n).toLowerCase()};return function(n,i){var t=[];return i=r(i),_.each(n,function(n){n.stringify||(n.stringify=r(JSON.stringify(n))),(!i||n.stringify.indexOf(i)>=0)&&t.push(n)}),t}}]);
angular.module("edison").filter("crlf",function(){"use strict";return function(n){return n.split(/\n/g).join("<br>")}});
angular.module("edison").filter("loginify",function(){"use strict";return function(e){return e?e.slice(0,1).toUpperCase()+e.slice(1,-2):""}});
angular.module("edison").filter("relativeDate",function(){"use strict";return function(e,r){var a=moment(1e3*(e+137e7)),n=moment().subtract(4,"days");if(n>a)return r?a.format("DD/MM"):a.format("DD/MM/YY");var t=a.fromNow().toString();return r&&(t=t.replace("quelques secondes","").replace(" minutes","mn").replace(" minute","mn").replace(" une","1").replace(" heures","H").replace(" heure","H").replace(" jours","J").replace(" jour","J").replace("il y a","-").replace(" un","1").replace("dans ","+")),t}});
angular.module("edison").filter("reverse",function(){"use strict";return function(e){return e?e.slice().reverse():[]}});
angular.module("edison").filter("tableFilter",["config",function(e){"use strict";var t=function(e){return _.deburr(e).toLowerCase()},r=function(e,r,n){return"string"==typeof e?t(e).includes(r):n?e===parseInt(r):t(String(e)).startsWith(r)},n=function(t,n,i){if("_categorie"===t){var a=e.categoriesHash()[n.c].long_name;return r(a,i)}if("_etat"===t){var a=e.etatsHash()[n.s].long_name;return r(a,i)}return!0},i=function(e,t,r){var n=1e3*(t[e]+137e7);return n>r.start.getTime()&&n<r.end.getTime()?!0:!1},a=function(e){if(!/^[0-9\/]+$/.test(e)||_.endsWith(e,"/"))return void 0;var t=e.split("/");if(1===t.length){var r=parseInt(t[0]);return{start:new Date(2015,r-1),end:new Date(2015,r)}}if(2===t.length){var n=parseInt(t[0]),r=parseInt(t[1]);return{start:new Date(2015,r-1,n),end:new Date(2015,r-1,n+1)}}return void 0};return function(e,u,s){var f=[];return u=_.mapValues(u,t),_.each(u,function(e,t){"∆"===t.charAt(0)&&(u[t]=a(e))}),_.each(e,function(e){if(e.id){var t=!0;_.each(u,function(a,u){if(a&&_.size(a)>0)if("_"===u.charAt(0)){if(!n(u,e,a))return t=!1,!1}else if("∆"===u.charAt(0)){if(!i(u.slice(1),e,a))return t=!1,!1}else if(!r(e[u],a,s))return t=!1,!1}),t===!0&&f.push(e)}}),f}}]);
angular.module("edison").factory("TabContainer",["$location","$window","$q","edisonAPI",function(t,e,s,i){"use strict";var n=function(t,e,s){"object"==typeof t?_.each(t,function(t,e){this[e]=t}):(this.prevTab=s||{},this.urlFilter=e.urlFilter,this.hash=e.hash,this.url=t,this.fullUrl=this.url+["",$.param(this.urlFilter)].join(_.isEmpty(this.urlFilter)?"":"?")+(this.hash?"#"+this.hash:""),this.title="",this.position=null,this.deleted=!1,this._timestamp=Date.now())};n.prototype.setData=function(t){this.data=t},n.prototype.setTitle=function(t,e){this.title=t};var o=function(){this._tabs=[],this.selectedTab=0};return o.prototype.loadSessionTabs=function(t){var e=this;return s(function(s,o){var a=!1;i.request({fn:"getSessionData"}).then(function(i){e.selectedTab=i.data.selectedTab;for(var r=0;r<i.data._tabs.length;r++)e._tabs.push(new n(i.data._tabs[r])),i.data._tabs[r].url===t&&(e.selectedTab=r,a=!0);return a?s():o()})["catch"](o)})},o.prototype.setFocus=function(t){this.selectedTab="number"==typeof t?t:t.position},o.prototype.createTab=function(t,e){var s=new n(t,e,this.getCurrentTab());return s.position=this._tabs.length,this._tabs.push(s),s},o.prototype.isOpen=function(t,e){var s=_.findIndex(this._tabs,function(s){return!s.deleted&&s.url===t&&(!e.hash&&!s.hash||e.hash==s.hash)&&_.isEqual(e.urlFilter,s.urlFilter)});return s>=0},o.prototype.getTab=function(t,e){return _.find(this._tabs,function(s){return!s.deleted&&s.url===t&&(!e.hash&&!s.hash||e.hash==s.hash)&&_.isEqual(e.urlFilter,s.urlFilter)})},o.prototype.getTabSimple=function(t,e){return _.find(this._tabs,function(e){return!e.deleted&&e.url.split("/")[1]===t.split("/")[1]})},o.prototype.len=function(){var t=0;return this._tabs.forEach(function(e){t+=!e.deleted}),t},o.prototype.getPrevTab=function(t){for(var e=t.position-1;e>=0;e--)if(this._tabs[e].deleted===!1)return this._tabs[e]},o.prototype.close=function(e){this.len()>1?(console.log("multiple tabs"),this.remove(e)&&t.url(e.prevTab.fullUrl||"/intervention/list")):(console.log("only tab"),t.url(e.prevTab.fullUrl||"/intervention/list"),this.noClose=!0)},o.prototype.remove=function(t){var e=[],s=0;if(this._tabs.length<=1)return!1;for(var i=this.selectedTab===t.position,n=0;n<this._tabs.length;n++)n!==t.position&&(e.push(this._tabs[n]),e[s].position=s,++s);return this._tabs=e,this.selectedTab===t.position&&0!==this.selectedTab&&this.selectedTab--,this.selectedTab>t.position&&this.selectedTab--,i},o.prototype.getCurrentTab=function(){return this._tabs[this.selectedTab]},o.prototype.addTab=function(t,e){var s,i=["/list","/search","/recap","lpa","/artisan/contact","/tools/edit"];s=this.noClose?this._tabs[0]:_.find(i,_.partial(_.includes,t))&&this.getTabSimple(t)?this.getTabSimple(t):this.noClose||this.isOpen(t,e)?this.getTab(t,e):this.createTab(t,e),this.noClose=!1,e&&e.setFocus===!1||this.setFocus(s),e&&e.title&&s.setTitle(e.title)},new o}]);
angular.module("edison").factory("Signalement",function(){"use strict";var n=function(n){this.intervention=n};return n.prototype.list={intervention:[{name:"Indisponibilité",id:"INDISPO",fn:function(){console.log("yay")}}],partenariat:[{name:"Facturier / Deviseur",id:"FACT_DEV",fn:function(){console.log("FACTDEV")}},{name:"Erreur SST",id:"ERREUR",fn:function(){console.log("ERR")}},{name:"Plainte SST",id:"PLAINTE",fn:function(){console.log("PLAINTE")}}],compta:[]},n});
angular.module("edison").factory("Tab",function(){var t=function(t){this.title="...",this.path=t.path(),this.url=t.path().split("/").slice(1),this.model=this.url[0],this.route=this.url[1],this.hash=t.hash(),this.title=this.url[this.url.length-1],this.date=new Date};return t.prototype.setTitle=function(t){return this.title=t,this},t.prototype.setData=function(t){return this.data=t,this},t}),angular.module("edison").factory("TabContainer",["Tab","$location",function(t,e){"use strict";var i={__tabs:[],__ordered:{}};return i.find=function(e){var i=new t(e);return _.find(this.__tabs,function(t){return"list"===t.route&&"list"===i.route?i.model===t.model:t.path==e.path()&&t.hash==e.hash()})},i.ordered=function(){return this.__ordered},i.close=function(t){var i=_.findIndex(this.__tabs,function(e){return e.path==t.path&&e.hash==location.hash});this.__tabs.splice(i,1),e.url("/intervention/list")},i.add=function(e){var i=this.find(e);return i?this.selectedTab=i:(this.selectedTab=new t(e),this.__tabs.push(this.selectedTab)),this},i.getCurrentTab=function(){return this.selectedTab},i.order=function(){var t=this,e=["intervention","artisan","devis","tools","compta"],i={};return _.each(t.__tabs,function(t){if(_.includes(e,t.model)&&"list"!==t.url[1]&&"contact"!==t.url[1])var s=_.endsWith(t.model,"s")?t.model:t.model+"s";else s="Recents";i[s]=i[s]||{title:s,tabs:[]},i[s].tabs.push(t)}),this.__ordered=i,this},i.getOrdered=function(){return this.__ordered},i}]);
angular.module("edison").factory("Address",function(){"use strict";var t=function(t,s){t.lat&&t.lng?(this.lt=t.lat,this.lg=t.lng):s?(this.getAddressProprieties(t),this.streetAddress=!0):this.isStreetAddress(t)?this.getPlaceProprieties(t):this.isLocalityAddress(t)&&this.getPlaceLocalityProprieties(t),t.geometry&&(this.lt=t.geometry.location.lat(),this.lg=t.geometry.location.lng()),this.latLng=this.lt+", "+this.lg};return t.prototype.getPlaceLocalityProprieties=function(t){var s=t.address_components;this.cp=s[1]&&s[1].short_name,this.v=s[0]&&s[0].short_name},t.prototype.getPlaceProprieties=function(t){var s=t.address_components;this.n=s[0]&&s[0].short_name,this.r=s[1]&&s[1].short_name,this.cp=s[6]&&s[6].short_name,this.v=s[2]&&s[2].short_name},t.prototype.getAddressProprieties=function(t){this.n=t.n,this.r=t.r,this.cp=t.cp,this.v=t.v,this.lt=t.lt,this.lg=t.lg,this.code=t.code,this.etage=t.etage,this.batiment=t.batiment},t.prototype.isLocalityAddress=function(t){return this.localityAddress=t.types.indexOf("locality")>=0,this.localityAddress},t.prototype.isStreetAddress=function(t){var s=["locality","country","postal_code","route","sublocality"];return this.streetAddress=s.indexOf(t.types[0])<0,this.streetAddress},t.prototype.toString=function(){return this.n+" "+this.r+" "+this.cp+", "+this.v+", France"},function(s,e){return new t(s,e)}});
angular.module("edison").factory("edisonAPI",["$http","$location","Upload",function(t,n,e){"use strict";return{product:{list:function(){return t.get("/api/product/list")},save:function(n){return t.post("/api/product/__save",n)}},compte:{list:function(){return t.get("/api/compte/list")},save:function(n){return t.post("/api/compte/__save",n)}},combo:{list:function(){return t.get("/api/combo/list")},save:function(n){return t.post("/api/combo/__save",n)}},stats:{telepro:function(){return t.get("/api/stats/telepro")},day:function(){return t.get("/api/stats/day")}},users:{logout:function(){return t.get("/logout")},save:function(n){return t.post("/api/user/__save",n)},list:function(){return t.get("/api/user/list")}},bfm:{get:function(){return t.get("/api/bfm")}},compta:{lpa:function(n){return t.get("/api/intervention/lpa?d="+(n.d||""))},flush:function(n){return t.post("/api/intervention/flush",n)},flushMail:function(n){return t.post("/api/intervention/flushMail",n)},archivesPaiement:function(){return t.get("/api/intervention/archivePaiement")},archivesReglement:function(){return t.get("/api/intervention/archiveReglement")},avoirs:function(){return t.get("/api/intervention/avoirs")},flushAvoirs:function(n){return t.post("/api/intervention/flushAvoirs",n)}},devis:{saveTmp:function(n){return t.post("/api/devis/temporarySaving",n)},getTmp:function(n){return t.get("/api/devis/temporarySaving?id="+n)},get:function(n,e){return t({method:"GET",cache:!1,url:"/api/devis/"+n,params:e||{}}).success(function(t){return t})},save:function(n){return n.id?t.post("/api/devis/"+n.id,n):t.post("/api/devis",n)},envoi:function(n,e){return t.post("/api/devis/"+n+"/envoi",e)},annulation:function(n,e){return t.post("/api/devis/"+n+"/annulation")},list:function(){return t.get("api/devis/getCacheList")}},intervention:{dashboardStats:function(n){return t.get("/api/intervention/dashboardStats",n)},getTelMatch:function(n){return t.post("/api/intervention/telMatches",n)},saveTmp:function(n){return t.post("/api/intervention/temporarySaving",n)},getTmp:function(n){return t.get("/api/intervention/temporarySaving?id="+n)},demarcher:function(n){return t({method:"POST",url:"/api/intervention/"+n+"/demarcher"})},reactivation:function(n){return t.post("api/intervention/"+n+"/reactivation")},list:function(){return t.get("api/intervention/getCacheList")},get:function(n,e){return t({method:"GET",cache:!1,url:"/api/intervention/"+n,params:e||{}}).success(function(t){return t})},getCB:function(n){return t.get("/api/intervention/"+n+"/CB")},save:function(n){return n.id?t.post("/api/intervention/"+n.id,n):t.post("/api/intervention",n)},getFiles:function(n){return t({method:"GET",url:"/api/intervention/"+n+"/getFiles"})},verification:function(n,e){return t.post("/api/intervention/"+n+"/verification",e)},annulation:function(n,e){return t.post("/api/intervention/"+n+"/annulation",e)},envoi:function(n,e){return t.post("/api/intervention/"+n+"/envoi",e)},sendFacture:function(n,e){return t.post("/api/intervention/"+n+"/sendFacture",e)},sendFactureAcquitte:function(n,e){return t.post("/api/intervention/"+n+"/sendFactureAcquitte",e)},statsBen:function(n){return t({method:"GET",url:"/api/intervention/statsBen",params:n})},commissions:function(n){return t({method:"GET",url:"/api/intervention/commissions",params:n})},scan:function(n){return t.post("/api/intervention/"+n+"/scan")}},artisan:{comment:function(n,e){return t.post("/api/artisan/"+n+"/comment",{text:e})},sendFacturier:function(n,e,i){return console.log("==>",e,i),t.post("/api/artisan/"+n+"/sendFacturier",{facturier:e,deviseur:i})},saveTmp:function(n){return t.post("/api/artisan/temporarySaving",n)},getTmp:function(n){return t.get("/api/artisan/temporarySaving?id="+n)},getCompteTiers:function(n){return t.get(["/api/artisan",n,"compteTiers"].join("/"))},envoiContrat:function(n,e){return t.post("/api/artisan/"+n+"/sendContrat",e)},upload:function(t,n,i){return e.upload({url:"/api/artisan/"+i+"/upload",fields:{name:n,id:i},file:t})},getFiles:function(n){return t({method:"GET",url:"/api/artisan/"+n+"/getFiles"})},reaStats:function(){return t.get("/api/artisan/reaStats")},extendedStats:function(n){return t.get("/api/artisan/"+n+"/extendedStats")},save:function(n){return n.id?t.post("/api/artisan/"+n.id,n):t.post("/api/artisan",n)},list:function(n){return t.get("api/artisan/getCacheList")},lastInters:function(n){return t({method:"GET",url:"/api/artisan/"+n+"/lastInters"})},get:function(n,e){return t({method:"GET",cache:!1,url:"/api/artisan/"+n,params:e||{}}).success(function(t){return t})},getNearest:function(n,e){return t({method:"GET",url:"/api/artisan/rank",cache:!1,params:{categorie:e,lat:n.lt,lng:n.lg,limit:50,maxDistance:100}})},getStats:function(n){return t({method:"GET",url:"/api/artisan/"+n+"/stats"})}},task:{add:function(n){return t.post("/api/task/add",n)},check:function(n){return t.post("/api/task/"+n+"/check")},listRelevant:function(){return t.get("/api/task/relevant")}},file:{uploadScans:function(t,n){return e.upload({url:"/api/document/uploadScans",fields:n,file:t})},upload:function(t,n){return e.upload({url:"/api/document/upload",fields:n,file:t})},scan:function(n){return t.post("/api/document/scan",n)}},call:{get:function(n,e){return t({method:"GET",url:"/api/calls/get",params:{q:JSON.stringify({link:e})}})},save:function(n){return t.post("/api/calls",n)}},sms:{get:function(n,e){return t({method:"GET",url:"/api/sms/get",params:{q:JSON.stringify({link:e,origin:n})}})},send:function(n){return t.post("/api/sms/send",n)}},getDistance:function(n,e){return t({method:"GET",cache:!0,url:"/api/mapGetDistance",params:{origin:n,destination:e}})},request:function(n){return t({method:n.method||"GET",url:"/api/"+n.fn,params:n.data})},searchPhone:function(n){return t({method:"GET",url:"api/arcep/"+n+"/search"})},getUser:function(){return t({method:"GET",cache:!0,url:"/api/whoAmI"})},searchText:function(n,e){return t({method:"GET",params:e,url:["api","search",n].join("/")})}}}]);
angular.module("edison").factory("Artisan",["$window","$rootScope","user","$location","LxNotificationService","LxProgressService","dialog","edisonAPI","textTemplate",function(t,n,o,e,i,a,r,c,s){"use strict";var u=function(t){if(!(this instanceof u))return new u(t);for(var n in t)this[n]=t[n]},l=function(n){console.log("---->",n),n&&t.open("callto:"+n,"_self",!1)};return u.prototype.callTel1=function(){l(this.telephone.tel1)},u.prototype.callTel2=function(){l(this.telephone.tel2)},u.prototype.typeOf=function(){return"Artisan"},u.prototype.ouvrirFiche=function(){e.url("/artisan/"+this.id)},u.prototype.ouvrirRecap=function(){e.url("/artisan/"+this.id+"/recap")},u.prototype.facturierDeviseur=function(){var t=this;r.facturierDeviseur(this,function(n,o){c.artisan.sendFacturier(t.id,n,o)})},u.prototype.call=function(n){var o=this;Date.now();t.open("callto:"+o.telephone.tel1,"_self",!1)},u.prototype.save=function(t){var n=this;c.artisan.save(n).then(function(n){i.success("Les données ont à été enregistré"),"function"==typeof t&&t(null,n.data)})["catch"](function(n){i.error(n.data),"function"==typeof t&&t(n.data)})},u.prototype.manager=function(t){var n=this;n.login.management=o.login,c.artisan.save(n).then(function(o){i.success("Vous manager désormais "+n.nomSociete),"function"==typeof t&&t(null,o.data)})["catch"](function(n){i.error(n.data),"function"==typeof t&&t(n.data)})},u.prototype.upload=function(t,n,o){var e=this;t&&(a.circular.show("#5fa2db","#fileUploadProgress"),c.artisan.upload(t,n,e.id).success(function(t){e.document=t.document,a.circular.hide(),"function"==typeof o&&o(null,t)})["catch"](function(t){a.circular.hide(),"function"==typeof o&&o(t)}))},u.prototype.envoiContrat=function(t){var n=this;r.sendContrat({data:n,text:_.template(s.mail.artisan.envoiContrat())(n)},function(o){a.circular.show("#5fa2db","#globalProgress"),c.artisan.envoiContrat(n.id,{text:o.text,signe:o.signe}).success(function(n){a.circular.hide(),"function"==typeof t&&t(null,n)})})},u.prototype.rappelContrat=function(t){var n=this;n.datePlain=moment(n.date.ajout).format("ll"),r.sendContrat({data:n,text:_.template(s.mail.artisan.rappelContrat())(n)},function(o){a.circular.show("#5fa2db","#globalProgress"),c.artisan.envoiContrat(n.id,{text:o.text,signe:o.signe,rappel:!0}).success(function(n){a.circular.hide(),"function"==typeof t&&t(null,n)})})},u.prototype.ouvrirFiche=function(){e.url("/artisan/"+this.id)},u}]);
angular.module("edison").factory("ContextMenu",["$rootScope","$location","edisonAPI","$window","$timeout","dialog","Devis","Intervention","Artisan","contextMenuData",function(t,o,e,i,n,s,a,r,c,u){"use strict";var p=function(o){var e=this;this.model=o,this.list=u[o],t.$on("closeContextMenu",function(){return e.active&&e.close()}),this.style={left:0,top:0,display:"none"}};return p.prototype.openSub=function(t){var o=this;this.openSubTimeout=n(function(){o.mouseOverCM=!0},t||0)},p.prototype.closeSub=function(){this.openSubTimeout&&n.cancel(this.openSubTimeout),this.mouseOverCM=!1},p.prototype.getData=function(){return this.data},p.prototype.setData=function(t){this.data=t},p.prototype.setPosition=function(t,o){this.style.left=t-$("#main-menu-inner").width()-4,this.style.top=o-48},p.prototype.active=!1,p.prototype.open=function(){var t=this;this.closeSub(),this.list.forEach(function(o){o.subs?_.each(o.subs,function(o){o.hidden=o.hide&&o.hide(t.data)}):o.hidden=o.hide&&o.hide(t.data)}),this.style.display="block",this.active=!0},p.prototype.close=function(){this.style.display="none",this.active=!1},p.prototype.modelObject={intervention:r,devis:a,artisan:c},p.prototype.tooltip=function(t){return _.get(this.data,t.binding,"")},p.prototype.click=function(t){return"function"==typeof t.action?t.action(this.getData()):"string"==typeof t.action?this.modelObject[this.model]()[t.action].bind(this.data)():void console.error("error here")},p}]);
angular.module("edison").factory("DataProvider",["$timeout","edisonAPI","socket","$rootScope","config",function(t,e,a,o,i){"use strict";var n=function(t,e){var o=this;this.model=t,this.hashModel=e||"t",this.rand=new Date,a.on(o.socketListChange(),function(t){-1===o.appliedList.indexOf(t.ts)&&(o.appliedList.push(t.ts),o.updateData(t.data))})};return n.prototype.socketListChange=function(){var t=this;return t.model.toUpperCase()+"_CACHE_LIST_CHANGE"},n.prototype.appliedList=[],n.prototype.data={},n.prototype.setData=function(t){this.data[this.model]=t},n.prototype.init=function(t){var a=this;return a.getData()?t(a.getData()):void e[a.model].list({cache:!0}).success(function(e){return a.setData(e),t(null,e)})},n.prototype.rowFilterFactory=function(t,e){var a=this;return!t&&e?function(t){return t[a.hashModel]===e}:t&&e?function(o){return o.f&&1===o.f[t.short_name]&&o[a.hashModel]===e}:t&&!e?function(e){return e.f&&1===e.f[t.short_name]}:void 0},n.prototype.applyFilter=function(t,e,a){this.filteredData=this.getData(),this.getData()&&(t||e||a)&&(this.filteredData=_.filter(this.getData(),a||this.rowFilterFactory(t,e)))},n.prototype.flash=function(e){e.flash=!0,t(function(){e.flash=!1},1e3)},n.prototype.updateData=function(t){var e=this;if(this.getData()){for(var a=_(t).flatten().map("id").value(),i=0;i<e.getData().length&&a.length;i++){var n=a.indexOf(e.getData()[i].id);n>=0&&(console.log("UPDATE DATA"),_.merge(e.getData()[i],t[n]),a.splice(n,1))}if(a.length){console.log("lol");var r=_.filter(t,function(t){return _.includes(a,t.id)});_.each(r,function(t){console.log("NEW DATA"),e.getData().unshift(t)})}o.$broadcast(e.socketListChange())}},n.prototype.getData=function(){return this.data[this.model]},n.prototype.isInit=function(){return this.model&&this.data&&this.data[this.model]},n}]);
angular.module("edison").factory("DateSelect",function(){"use strict";var t=function(){var t=this,e=new Date;t.start={m:9,y:2013},t.current={m:e.getMonth()+1,y:e.getFullYear()};var r=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"];t._list=[],_.times(t.current.y-t.start.y+1,function(e){_.times(12,function(i){t._list.push({m:i+1,y:t.start.y+e,t:r[i]+" "+(t.start.y+e)})})}),t._list.splice(t.current.m-12)};return t.prototype.list=function(){return this._list},t});
angular.module("edison").factory("Devis",["openPost","$window","$rootScope","$location","LxNotificationService","LxProgressService","dialog","edisonAPI","textTemplate",function(e,t,i,n,o,r,s,a,c){"use strict";var l=function(e){if(!(this instanceof l))return new l(e);for(var t in e)this[t]=e[t]},d=function(e){console.log("---->",e),e&&t.open("callto:"+e,"_self",!1)};return l.prototype.callTel1=function(){d(this.client.telephone.tel1)},l.prototype.callTel2=function(){d(this.client.telephone.tel2)},l.prototype.callTel3=function(){d(this.client.telephone.tel3)},l.prototype.typeOf=function(){return"Devis"},l.prototype.save=function(e){var t=this;console.log("yay"),a.devis.save(t).then(function(t){console.log("resp");var i=_.template("Les données du devis {{id}} ont à été enregistré")(t.data);o.success(i),"function"==typeof e&&e(null,t.data)},function(t){console.log("err"),o.error(t.data),"function"==typeof e&&e("une erreur est "+t.data)})["catch"](function(e){console.log("ERRRR:>",e)})},l.prototype.devisPreview=function(){return this.client.nom&&this.client.address.r&&this.client.address.v&&this.client.address.cp&&this.client.address.n?this.produits&&this.produits.length?void e("/api/intervention/devisPreview",{data:JSON.stringify(this),html:!0}):o.error("Veuillez renseigner au moins 1 produits"):o.error("Les coordonées du devis sont incompletes")},l.prototype.sendDevis=function(e){var t=this;if(!/\S+@\S+\.\S+/.test(t.client.email))return o.error("L'addresse email est invalide"),e("err");var n=l(this).devisPreview.bind(this);s.getTextDevis(n,{text:c.mail.devis.envoi.bind(t)(i.user),width:"900px",height:"700px"},function(i){r.circular.show("#5fa2db","#globalProgress"),a.devis.envoi(t.id,{text:i}).success(function(i){r.circular.hide();var n=_.template("le devis {{id}} à été envoyé")(t);o.success(n),"function"==typeof e&&(console.log("yes cb"),e(null,i))},function(i){r.circular.hide();var n=_.template("L'envoi du devis {{id}} à échoué\n")(t);i&&i.data&&"string"==typeof i.data&&(n+="\n("+i.data+")"),o.error(n),"function"==typeof e&&e(i)})["catch"](function(i){r.circular.hide();var n=_.template("L'envoi du devis {{id}} à échoué\n")(t);i&&i.data&&"string"==typeof i.data&&(n+="\n("+i.data+")"),o.error(n),"function"==typeof e&&e(i)})})},l.prototype.annulation=function(e){var t=this;a.devis.annulation(t.id).then(function(t){var i=_.template("Le devis {{id}} est annulé")(t.data);o.success(i),"function"==typeof e&&e(null,t.data)})},l.prototype.ouvrirFiche=function(){n.url("/devis/"+this.id)},l.prototype.transfert=function(){n.url("/intervention?devis="+this.id)},l}]);
angular.module("edison").factory("dialog",["openPost","$mdDialog","edisonAPI","config","$window","LxNotificationService",function(e,t,n,o,i,l){"use strict";return{verification:function(e,n){t.show({controller:["$scope","$mdDialog","config",function(t,o,a){t.data=e,t.config=a,t.answer=function(a){t.window=i,t.inter=e,a?o.hide():t.inter.prixFinal?(o.hide(),n(e)):l.error("Veuillez renseigner un prix final")}}],templateUrl:"/DialogTemplates/verification.html"})},recouvrement:function(e,n){t.show({controller:["$scope","$mdDialog","config",function(t,o,i){t.data=e,t.answer=function(t){o.hide(),t||n(e)}}],templateUrl:"/DialogTemplates/recouvrement.html"})},validationReglement:function(e,n){t.show({controller:["$scope","$mdDialog",function(t,o){t.data=e,t.answer=function(i){return t.data=e,o.hide(),null===i?n("nope"):(0!==t.data.compta.reglement.montant&&(t.data.compta.reglement.recu=i),n(null,t.data))}}],templateUrl:"/DialogTemplates/validationReglement.html"})},validationPaiement:function(n,o){t.show({controller:["$scope","$mdDialog",function(t,i){t.data=n,t.preview=function(){e("/api/intervention/autofacture",{data:JSON.stringify(t.data),html:!0})},t.answer=function(e){return t.data=n,i.hide(),null===e?o("nope"):o(null,t.data)}}],templateUrl:"/DialogTemplates/validationPaiement.html"})},facturierDeviseur:function(e,n){t.show({controller:["$scope","$mdDialog","config",function(t,o,i){t.sst=e,t.deviseur=!0,t.facturier=!0,t.answer=function(e){o.hide(),e||n(t.facturier,t.deviseur)}}],templateUrl:"/DialogTemplates/facturierDeviseur.html"})},envoiFacture:function(e,n,o,i){t.show({controller:["$scope","$mdDialog",function(e,t){e.text=n,e.date=new Date,e.showAcquitte=o,e.acquitte=o,e.answer=function(n){t.hide(),n?i("nope"):i(null,e.text,e.acquitte,e.date)}}],templateUrl:"/DialogTemplates/envoiFacture.html"})},recap:function(e){t.show({controller:["$scope","$mdDialog","config",function(t,n,o){t.inters=e,t.config=o,t.answer=function(){n.hide()}}],templateUrl:"/DialogTemplates/recapList.html"})},callsList:function(e){t.show({controller:["$scope","$mdDialog",function(t,n){t.sst=e,t.answer=function(){n.hide()}}],templateUrl:"/DialogTemplates/callsList.html"})},smsList:function(e){t.show({controller:["$scope","$mdDialog",function(t,n){t.sst=e,t.answer=function(){n.hide()}}],templateUrl:"/DialogTemplates/smsList.html"})},choiceText:function(e,n){t.show({controller:["$scope","$mdDialog",function(t,o){t.options=e,t.answer=function(e,t){return o.hide(),n(e,t)}}],templateUrl:"/DialogTemplates/choiceText.html"})},addProd:function(e){t.show({controller:["$scope","$mdDialog","$window",function(t,n,o){t.pu=0,t.window=o,t.quantite=1,t.prod={quantite:1,pu:0,title:"",ref:""},t.$watch("prod",function(){t.prod.ref=t.prod.ref.toUpperCase(),t.prod.title=t.prod.title.toUpperCase(),t.prod.desc=t.prod.title,t.prod.pu=t.prod.pu,t.prod.quantite=t.prod.quantite},!0),t.answer=function(o){return n.hide(),o?void 0:e(t.prod)}}],templateUrl:"/DialogTemplates/getProd.html"})},getCauseAnnulation:function(e,n){t.show({controller:["$scope","config",function(o,i){o.causeAnnulation=i.causeAnnulation,e.datePlain=moment(e.date.intervention).format("DD/MM/YYYY"),o.textSms=_.template("L'intervention {{id}} chez {{client.civilite}} {{client.nom}} à {{client.address.v}} le {{datePlain}} a été annulé. \nMerci de ne pas intervenir. \nEdison Services")(e),o.answer=function(e){return e&&!o.ca?l.error("Veuillez renseigner une raison d'annulation"):(t.hide(),e?n(null,o.ca,o.reinit,o.sendSms,o.textSms):n("nope"))}}],templateUrl:"/DialogTemplates/causeAnnulation.html"})},sendContrat:function(e,n){t.show({controller:["$scope","$mdDialog",function(t,o){e.signe=!0,t.options=e,t.answer=function(e){return o.hide(),e?void 0:n(t.options)}}],templateUrl:"/DialogTemplates/sendContrat.html"})},getText:function(e,n){t.show({controller:["$scope","$mdDialog",function(t,o){t.options=e,t.answer=function(e){return o.hide(),e?void 0:n(t.options.text)}}],templateUrl:"/DialogTemplates/text.html"})},getTextDevis:function(e,n,o){t.show({controller:["$scope","$mdDialog",function(t,i){t.options=n,t.previewFunction=e,t.answer=function(e){return i.hide(),e?void 0:o(t.options.text)}}],templateUrl:"/DialogTemplates/textDevis.html"})},getFileAndText:function(e,n,o,i){t.show({controller:["$scope","$mdDialog",function(e,t){e.Math=Math,e.xfiles=_.clone(o||[]),e.smsText=n,e.answer=function(n){return t.hide(),n===!1?i(null,e.smsText,e.addedFile):i("nope")}}],templateUrl:"/DialogTemplates/fileAndText.html"})},envoiIntervention:function(e,n,o){t.show({controller:["$scope","$mdDialog",function(t,i){t.data=e,t.smsText=n,t.answer=function(e){return i.hide(),e===!1?o(null,t.smsText,t.addedFile):o("nope")}}],templateUrl:"/DialogTemplates/envoi.html"})},editProduct:{open:function(e,n){t.show({controller:["$scope","$mdDialog",function(t,o){t.produit=_.clone(e),t.mdDialog=o,t.answer=function(e){return o.hide(e),n(e)}}],templateUrl:"/DialogTemplates/edit.html"})}},selectSubProduct:function(e,n){t.show({controller:["$scope","$mdDialog",function(t,o){t.elem=e,t.answer=function(e,t){return o.hide(),e?void 0:n(t)}}],templateUrl:"/DialogTemplates/selectSubProduct.html"})}}}]);
angular.module("edison").factory("fourniture",[function(){"use strict";return{init:function(t){return this.fourniture=t,this.fourniture||(this.fourniture=[]),this},remove:function(t){this.fourniture.splice(t,1)},moveTop:function(t){if(0!==t){var u=this.fourniture[t-1];this.fourniture[t-1]=this.fourniture[t],this.fourniture[t]=u}},moveDown:function(t){if(t!==this.fourniture.length-1){var u=this.fourniture[t+1];this.fourniture[t+1]=this.fourniture[t],this.fourniture[t]=u}},add:function(){this.fourniture.push({bl:"0",title:"Fourniture",fournisseur:"ARTISAN",quantite:1,pu:0})},total:function(){var t=0;return this.fourniture&&this.fourniture.forEach(function(u){t+=u.pu*u.quantite}),t}}}]);
angular.module("edison").factory("Intervention",["$location","$window","openPost","LxNotificationService","LxProgressService","dialog","user","config","edisonAPI","Devis","$rootScope","textTemplate",function(t,e,n,i,o,r,c,s,a,u,l,f){"use strict";var p=function(t){if(!(this instanceof p))return new p(t);for(var e in t)this[e]=t[e]},v=function(t){console.log("---->",t),t&&e.open("callto:"+t,"_self",!1)};return p.prototype.callTel1=function(){v(this.client.telephone.tel1)},p.prototype.callTel2=function(){v(this.client.telephone.tel2)},p.prototype.callTel3=function(){v(this.client.telephone.tel3)},p.prototype.callSst1=function(){v(this.sst.telephone.tel1)},p.prototype.callSst2=function(){v(this.sst.telephone.tel2)},p.prototype.callPayeur1=function(){v(this.facture.tel)},p.prototype.callPayeur2=function(){v(this.facture.tel2)},p.prototype.typeOf=function(){return"Intervention"},p.prototype.envoiDevis=function(t){u().envoi.bind(this)(t)},p.prototype.validerReglement=function(t){var e=this;r.validationReglement(this,function(n,o){return n?t&&t(n):void a.intervention.save(e).then(function(t){i.success("L'intervention "+e.id+" est modifié")},function(t){i.error("Une erreur est survenu ("+t.data+")")})})},p.prototype.validerPaiement=function(t){var e=this;r.validationPaiement(this,function(n,o){return n?t&&t(n):void a.intervention.save(e).then(function(t){i.success("L'intervention "+e.id+" est modifié")},function(t){i.error("Une erreur est survenu ("+t.data+")")})})},p.prototype.demarcher=function(t){a.intervention.demarcher(this.id).success(function(){i.success("Vous demarchez l'intervention")},function(){i.error("Une erreur est survenu")})},p.prototype.facturePreview=function(){n("/api/intervention/facturePreview",{data:JSON.stringify(this),html:!0})},p.prototype.factureAcquittePreview=function(){n("/api/intervention/factureAcquittePreview",{data:JSON.stringify(this),html:!0})},p.prototype.sendFactureAcquitte=function(t){var e=this,n=moment(this.date.intervention).format("LL"),c=f.mail.intervention.factureAcquitte.bind(e)(n),s=_.template(c)(this);r.envoiFacture(e,s,!0,function(n,r,c,s){return n?t("nope"):(o.circular.show("#5fa2db","#globalProgress"),void a.intervention.sendFactureAcquitte(e.id,{text:r,acquitte:c,date:s,data:e}).success(function(n){o.circular.hide();var r=_.template("La facture de l'intervention {{id}} à été envoyé")(e);i.success(r),"function"==typeof t&&t(null,n)})["catch"](function(n){o.circular.hide();var r=_.template("L'envoi de la facture {{id}} à échoué\n("+n.data+")")(e);i.error(r),"function"==typeof t&&t(n)}))})},p.prototype.sendFacture=function(t){var e=this,n=moment(this.date.intervention).format("LL"),c=f.mail.intervention.envoiFacture.bind(e)(n),s=_.template(c)(this);r.envoiFacture(e,s,!1,function(n,r,c,s){return n?t("nope"):(o.circular.show("#5fa2db","#globalProgress"),void a.intervention.sendFacture(e.id,{text:r}).success(function(n){o.circular.hide();var r=_.template("La facture de l'intervention {{id}} à été envoyé")(e);i.success(r),"function"==typeof t&&t(null,n)})["catch"](function(n){o.circular.hide();var r=_.template("L'envoi de la facture {{id}} à échoué\n("+n.data+")")(e);i.error(r),"function"==typeof t&&t(n)}))})},p.prototype.ouvrirFicheV1=function(){e.open("http://electricien13003.com/alvin/5_Gestion_des_interventions/show_res_bis_2.php?id_client="+this.id)},p.prototype.ouvrirFiche=function(){t.url("/intervention/"+this.id)},p.prototype.ouvrirRecapSST=function(){t.url(["/artisan",this.artisan.id,"recap"].join("/")+"#interventions")},p.prototype.smsArtisan=function(t){var e=this,n=f.sms.intervention.demande.bind(this)(c,s);n=_.template(n)(this),r.getFileAndText(e,n,[],function(n,o){return n?t(n):void a.sms.send({link:e.sst.id,origin:e.id||e.tmpID,text:o,to:e.sst.telephone.tel1}).success(function(n){var o=_.template("Un sms a été envoyé à M. {{sst.representant.nom}}")(e);i.success(o),"function"==typeof t&&t(null,n)})["catch"](function(e){i.success("L'envoi du sms a échoué"),"function"==typeof t&&t(e)})})},p.prototype.callClient=function(t){var n=this,i=Date.now();e.open("callto:"+n.client.telephone.tel1,"_self",!1),r.choiceText({subTitle:n.client.telephone.tel1,title:"Nouvel Appel Client"},function(e,o){a.call.save({date:i,to:n.client.telephone.tel1,link:n.id,origin:n.id||n.tmpID||0,description:o,response:e}).success(function(e){"function"==typeof t&&t(null,e)})["catch"](function(e){"function"==typeof t&&t(e)})})},p.prototype.callArtisan=function(t){var n=this,i=Date.now();e.open("callto:"+n.artisan.telephone.tel1,"_self",!1),r.choiceText({subTitle:n.artisan.telephone.tel1,title:"Nouvel Appel"},function(e,o){a.call.save({date:i,to:n.artisan.telephone.tel1,link:n.artisan.id,origin:n.id||n.tmpID||0,description:o,response:e}).success(function(e){"function"==typeof t&&t(null,e)})["catch"](function(e){"function"==typeof t&&t(e)})})},p.prototype.save=function(t){var e=this;a.intervention.save(e).then(function(n){var o=_.template("Les données de l'intervention {{id}} ont à été enregistré.")(n.data);(e.tmpID&&e.sst||e.sst__id&&e.sst&&e.sst__id!==e.sst.id)&&(o+="\n\n Un sms à été envoyé"),i.success(o),"function"==typeof t&&t(null,n.data)},function(e){i.error(e.data),"function"==typeof t&&t(e.data)})},p.prototype.envoi=function(t){var e=this,n=f.sms.intervention.envoi.bind(e)(c);r.envoiIntervention(e,n,function(n,r,c){return n?t(n):(o.circular.show("#5fa2db","#globalProgress"),void a.intervention.envoi(e.id,{sms:r,file:c}).then(function(e){o.circular.hide(),console.log("ok");var n=_.template("L'intervention est envoyé");i.success(n),"function"==typeof t&&t(null,e.data)},function(e){o.circular.hide(),console.log("error"),i.error(e.data),"function"==typeof t&&t(e.data)}))})},p.prototype.reactivation=function(t){var e=this;a.intervention.reactivation(this.id).then(function(){i.success("L'intervention "+e.id+" est à programmer")})},p.prototype.annulation=function(t){var e=this;r.getCauseAnnulation(e,function(n,o,r,c,s){return n?"function"==typeof t&&t("err"):void a.intervention.annulation(e.id,{causeAnnulation:o,reinit:r,sms:c,textSms:s}).then(function(e){var n=_.template("L'intervention {{id}} est annulé")(e.data);i.success(n),"function"==typeof t&&t(null,e.data)})})},p.prototype.envoiFactureVerif=function(t){var e=this;return this.produits.length?void e.sendFacture(function(n){return n?t(n):void e.verificationSimple(t)}):(i.error("Veuillez renseigner les produits"),t("nope"))},p.prototype.verificationSimple=function(t){var e=this;o.circular.show("#5fa2db","#globalProgress"),a.intervention.verification(e.id).then(function(e){o.circular.hide();var n=_.template("L'intervention {{id}} est vérifié")(e.data);i.success(n),"function"==typeof t&&t(null,e.data)},function(e){o.circular.hide(),i.error(e.data),t(e.data)})},p.prototype.verification=function(e){var n=this;return n.reglementSurPlace?void r.verification(n,function(t){p(t).save(function(t,n){return t?void 0:p(n).verificationSimple(e)})}):t.url("/intervention/"+this.id)},p.prototype.recouvrement=function(t){var e=this;r.recouvrement(e,function(e){p(e).save(function(e,n){return(t||_.noop)()})})},p.prototype.fileUpload=function(t,e){var n=this;t&&(o.circular.show("#5fa2db","#fileUploadProgress"),a.file.upload(t,{link:n.id||n.tmpID,model:"intervention",type:"fiche"}).success(function(t){o.circular.hide(),"function"==typeof e&&e(null,t)})["catch"](function(t){o.circular.hide(),"function"==typeof e&&e(t)}))},p.prototype.editCB=function(){var t=this;a.intervention.getCB(this.id).success(function(e){t.cb=e},function(t){i.error(t.data)})},p.prototype.reinitCB=function(){this.cb={number:0}},p}]);
angular.module("edison").directive("whenScrollEnds",function(){return{restrict:"A",link:function(l,n,r){var o=n.height(),c=100;n.scroll(function(){var e=n.prop("scrollHeight"),i=e-o;i-n.scrollTop()<=c&&l.$apply(r.whenScrollEnds)})}}});
angular.module("edison").factory("Map",function(){"use strict";var t=function(){this.display=!1};return t.prototype.setCenter=function(t){var o=new google.maps.LatLng(t.lt,t.lg);this.center=t,window.map&&window.map.setCenter(o)},t.prototype.setZoom=function(t){window.map&&window.map.setZoom(t),this.zoom=t},t.prototype.show=function(){this.display=!0},t});
angular.module("edison").factory("mapAutocomplete",["$q","Address",function(e,o){"use strict";var t=function(){this.service=new google.maps.places.AutocompleteService,this.geocoder=new google.maps.Geocoder};return t.prototype.search=function(o){var t=e.defer();return this.service.getPlacePredictions({input:o,componentRestrictions:{country:"fr"}},function(e){e&&e.forEach(function(t){t.description===o&&(e=null)}),t.resolve(e||[])}),t.promise},t.prototype.getPlaceAddress=function(t){var r=this;return e(function(e,n){r.geocoder.geocode({address:t.description},function(t,r){return r!==google.maps.places.PlacesServiceStatus.OK?n(r):e(o(t[0]))})})},new t}]);
angular.module("edison").factory("openPost",[function(){"use strict";return function(e,t){var n=document.createElement("form");n.target="_blank",n.method="POST",n.action=e,_.each(t,function(e,t){var o=document.createElement("input");o.type="text",o.name=t,o.value="object"==typeof e?JSON.stringify(e):e,n.appendChild(o)}),document.body.appendChild(n),n.submit(),n.remove()}}]);
angular.module("edison").factory("productsList",["$q","dialog","openPost","edisonAPI",function(t,i,s,o){"use strict";var r=function(t){this.produits=t;var i=this;this.ps||o.product.list().then(function(t){i.ps=t.data}),_.each(this.produits,function(t){t.desc.toLowerCase()!=t.title.toLowerCase()&&(t.showDesc=!0)}),this.lastCall=_.now()};return r.prototype={remove:function(t){this.produits.splice(t,1)},moveTop:function(t){if(0!==t){var i=this.produits[t-1];this.produits[t-1]=this.produits[t],this.produits[t]=i}},moveDown:function(t){if(t!==this.produits.length-1){var i=this.produits[t+1];this.produits[t+1]=this.produits[t],this.produits[t]=i}},edit:function(t){var s=this;i.editProduct.open(this.produits[t],function(i){s.produits[t]=i})},add:function(t){return this.lastCall+100>_.now()?0:(this.lastCall=_.now(),this.searchText="",t.quantite=1,void this.produits.push(t))},search:function(t){for(var i=[],s=0;s<this.ps.length;++s){if(t===this.ps[s].title)return[];var o=_.deburr(t).toLowerCase(),r=_.deburr(this.ps[s].title).toLowerCase(),e=_.deburr(this.ps[s].ref).toLowerCase(),n=_.deburr(this.ps[s].desc).toLowerCase();if(_.includes(r,o)||_.includes(e,o)||_.includes(n,o)){var u=_.clone(this.ps[s]);u.random=_.random(),i.push(u)}}return i},getDetail:function(t){if(!t)return 0;var s=this;i.selectSubProduct(t,function(i){var o={showDesc:!0,quantite:1,ref:i.ref,title:t.nom,desc:i.nom+"\n"+t.description.split("-").join("\n"),pu:Number(i.prix)};s.add(o)})},flagship:function(){return _.max(this.produits,"pu")},total:function(){var t=_.round(_.sum(this.produits,function(t){return(t.pu||0)*(t.quantite||0)}),2);return t}},r}]);
angular.module("edison").factory("socket",["socketFactory",function(t){"use strict";return t()}]);
angular.module("edison").factory("taskList",["dialog","edisonAPI",function(t,n){"use strict";var o=function(t){n.get({to:t,done:!1})};return o.prototype={check:function(t){n.check({_id:t})},add:function(t){n.add(t)}},o}]);
angular.module("edison").factory("user",["$window",function(n){"use strict";return n.app_session}]);
angular.module("edison").directive("infoAppelSst",["mapAutocomplete","edisonAPI","config",function(e,t,o){"use strict";return{restrict:"E",templateUrl:"/Templates/info-appel-sst.html",scope:{data:"="},link:function(e,t,o){console.log("sweg")}}}]);
angular.module("edison").directive("infoFacture",["mapAutocomplete","edisonAPI","config",function(t,a,e){"use strict";return{restrict:"E",templateUrl:"/Templates/info-facture.html",scope:{data:"="},link:function(c,n,r){c.data;c.config=e,c.autocomplete=t,c.changeAddressFacture=function(a){t.getPlaceAddress(a).then(function(t){c.data.facture=c.data.facture||{},c.data.facture.address=t})},a.compte.list().then(function(t){c.grndComptes=t.data}),c.changeGrandCompte=function(){var t=c.data.facture.compte;c.data.facture=_.find(c.grndComptes,"ref",c.data.facture.compte),c.data.facture.payeur="GRN",c.data.facture.compte=t}}}}]);
angular.module("edison").directive("infoFourniture",["config","fourniture",function(t,i){"use strict";return{restrict:"E",templateUrl:"/Templates/info-fourniture.html",scope:{data:"=",display:"=",small:"="},link:function(r,n,u){r.config=t,r.dsp=r.display||!1,r.data.fourniture=r.data.fourniture||[],r.fourniture=i.init(r.data.fourniture)}}}]);
angular.module("edison").directive("mainNavbar",["$q","edisonAPI","TabContainer","$timeout","$rootScope","$location","$window",function(e,n,t,o,a,c,r){"use strict";return{restrict:"E",templateUrl:"/Templates/main-navbar.html",scope:{data:"=",display:"=",small:"="},link:function(i,u,s){i.root=a,i._=_,i.tabContainer=t,i.select=function(e){i.selectedTab==e?i.selectedTab=null:i.selectedTab=e},$('input[type="search"]').ready(function(){o(function(){$('input[type="search"]').on("keyup",function(e,n){13==e.which&&$("ul.md-autocomplete-suggestions>li").length&&(c.url("/search/"+$(this).val()),$(this).val(""),$(this).blur())})},10)}),a.$on("closeContextMenu",function(){console.log("uau"),i.selectedTab=null}),i.logout=function(){n.users.logout().then(function(){r.location.reload()})},a.$on("closeSearchBar",function(){i.searchBarSize=100});var l="md-autocomplete.searchBar>md-autocomplete-wrap>input";$(l).ready(function(){o(function(){$(l).on("focus",function(){i.searchFocus=!0;var e=[".navbar-header",".navbar-nav",".dropdown-toggle.user-menu"];i.searchBarSize=_.reduce(e,function(e,n){return e-=$(n).width()},$(window).width()-100)}),$(l).on("blur",function(){i.searchFocus=!1,i.searchBarSize=100})},10)}),i.changeUser=function(e){a.displayUser=e},i.searchBox={search:function(t){var o=e.defer();return n.searchText(t,{limit:10,flat:!0}).success(function(e){o.resolve(e)}),o.promise},change:function(e){e&&c.url(e.link),o(function(){$(l).blur()}),i.searchText=""}}}}}]);
angular.module("edison").directive("artisanCategorie",["config",function(e){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/artisan-categorie.html",transclude:!0,scope:{model:"="},link:function(t,o,r){t.config=e,t.findColor=function(e){var o=_.find(t.model.categories,function(t){return t===e.short_name});return o?e.color:"white"},t.toggleCategorie=function(e){var o=t.model.categories.indexOf(e);o>=0?t.model.categories.splice(o,1):t.model.categories.push(e)}}}}]);
var ArtisanCtrl=function(t,e,n,i,o,a,r,s,l,c,u,d,f,m){"use strict";var g=this;g.config=u,g.dialog=d,g.moment=moment,g.contextMenu=new r("artisan");var p=c.getCurrentTab();if(p.data)var v=p.data;else{var v=new m(f.data);if(p.setData(v),a.id.length>12)g.isNew=!0,v.tmpID=a.id,p.setTitle("SST  "+moment(new Date(parseInt(v.tmpID)).toISOString()).format("HH:mm").toString());else if(p.setTitle("SST  "+a.id),!v)return l.error("Impossible de trouver les informations !"),o.url("/dashboard"),c.remove(p),0}g.data=p.data,g.saveArtisan=function(t){v.save(function(e,n){return e?!1:void(t.contrat?(v=new m(n),v.envoiContrat.bind(n)(c.close)):c.close(p))})},g.onArtisanFileUpload=function(t,e){s.circular.show("#5fa2db","#fileUploadProgress"),i.artisan.upload(t,e,v.id).then(function(){console.log("reload"),s.circular.hide(),g.loadFilesList()})},g.artisanClickTrigger=function(t){setTimeout(function(){angular.element("#file_"+t+">input").trigger("click")},0)},g.rightClick=function(t){console.log("rightClick"),g.contextMenu.setPosition(t.pageX,t.pageY),g.contextMenu.setData(v),g.contextMenu.open()},g.fileExist=function(t){return v.file?_.find(v.file,function(e){return _.startsWith(e,t)}):!1},g.loadFilesList=function(){i.artisan.getFiles(v.id).then(function(t){v.file=t.data,console.log("==>",v.file)},console.log)},v.id&&g.loadFilesList(),g.addComment=function(){v.comments.push({login:e.user.login,text:g.commentText,date:new Date}),g.commentText=""};var h=_.after(5,_.throttle(function(){i.artisan.saveTmp(v)},2e3));v.id||n.$watch(function(){return v},h,!0)};ArtisanCtrl.$inject=["$timeout","$rootScope","$scope","edisonAPI","$location","$routeParams","ContextMenu","LxProgressService","LxNotificationService","TabContainer","config","dialog","artisanPrm","Artisan"],angular.module("edison").controller("ArtisanController",ArtisanCtrl);
var archiveReglementController=function(e,r,t,n,o){var a=r.getCurrentTab(),i=this;i.title="Archives Reglements",a.setTitle("archives RGL"),o.circular.show("#5fa2db","#globalProgress"),e.compta.archivesReglement().success(function(e){o.circular.hide(),i.data=e}),i.moment=moment,i.openLink=function(e){n.url(e)}};archiveReglementController.$inject=["edisonAPI","TabContainer","$routeParams","$location","LxProgressService"],angular.module("edison").controller("archivesReglementController",archiveReglementController);var archivesPaiementController=function(e,r,t,n,o){var a=this,i=r.getCurrentTab();a.type="paiement",a.title="Archives Paiements",i.setTitle("archives PAY"),o.circular.show("#5fa2db","#globalProgress"),e.compta.archivesPaiement().success(function(e){o.circular.hide(),a.data=e}),a.moment=moment,a.openLink=function(e){n.url(e)}};archivesPaiementController.$inject=["edisonAPI","TabContainer","$routeParams","$location","LxProgressService"],angular.module("edison").controller("archivesPaiementController",archivesPaiementController);
var AvoirsController=function(o,r,i,t,a,n,e){"use strict";var s=this,l=o.getCurrentTab();l.setTitle("Avoirs"),s.loadData=function(o){a.circular.show("#5fa2db","#globalProgress"),i.compta.avoirs().then(function(o){console.log(o),t.avoirs=o.data,a.circular.hide()})},t.avoirs||s.loadData(),s.reloadAvoir=function(){s.loadData()},s.print=function(o){console.log(t.avoirs),r("/api/intervention/printAvoir",{data:t.avoirs})},s.flush=function(){var o=_.filter(t.avoirs,{checked:!0});i.compta.flushAvoirs(o).then(function(o){n.success(o.data),s.reloadAvoir()})["catch"](function(o){n.error(o.data)})}};AvoirsController.$inject=["TabContainer","openPost","edisonAPI","$rootScope","LxProgressService","LxNotificationService","FlushList"],angular.module("edison").controller("avoirsController",AvoirsController);
var ContactArtisanController=function(t,e,n,a,o,i,s,r,c,l,d,u,p,f,m){"use strict";var g=this;g.loadPanel=function(t){s.artisan.get(t).then(function(t){g.sst=t.data,g.tab.setTitle("@"+g.sst.nomSociete.slice(0,10))})},g.tbz=["informations","interventions","historique","stats","paiements"];var b=g.tbz.indexOf(l.hash());if(t.selectedIndex=b>=0?b:0,g.tab=n.getCurrentTab(),g.recap=l.url().includes("recap")?c.sstid:void 0,g.recap)g.loadPanel(g.recap);else{console.log("-->","yay"),a.circular.show("#5fa2db","#globalProgress");var h=new r("artisan");h.init(function(t,e){console.log("init"),g.config=f,g.moment=moment,h.isInit()||h.setData(e),g.tableFilter="",g.tableLimit=20,u.expendedRow=c.sstid||45,console.log(g.recap,l.url()),g.tableData=h.getData(),g.loadPanel(g.tableData[0].id),a.circular.hide()})}g.getStaticMap=function(t){return g.sst&&this.sst.address?"/api/mapGetStatic?width=500&height=400&precision=0&zoom=6&origin="+g.sst.address.lt+", "+g.sst.address.lg:void 0},g.reloadData=function(){g.tableData=p("contactFilter")(h.getData(),g.tableFilter)},g.loadMore=function(){g.tableLimit+=10},u.$on("ARTISAN_CACHE_LIST_CHANGE",function(){g.tab.fullUrl===n.getCurrentTab().fullUrl&&h.applyFilter(currentFilter,g.tab.hash)}),g.contextMenu=new i("artisan"),g.rowRightClick=function(t,e){console.log("contactclick"),g.contextMenu.setPosition(t.pageX,t.pageY+200),s.artisan.get(e.id).then(function(t){g.contextMenu.setData(t.data),g.contextMenu.open()})},t.addComment=function(){s.artisan.comment(g.sst.id,t.commentText).then(function(){g.loadPanel(g.sst.id),t.commentText=""})},g.rowClick=function(t,e){if(g.contextMenu.active)return g.contextMenu.close();if(t.metaKey||t.ctrlKey)n.addTab("/artisan/"+e.id,{title:"#"+e.id,setFocus:!1,allowDuplicates:!1});else{if(u.expendedRow===e.id)return 0;u.expendedRow=e.id,g.loadPanel(e.id),l.search("sstid",e.id)}},t.$watchCollection("[selectedIndex, expendedRow]",function(e,n){e&&void 0!==e[0]&&l.hash(g.tbz[e[0]]),n[1]&&4==t.selectedIndex&&(t.compteTiers=void 0,s.artisan.getCompteTiers(u.expendedRow).success(function(e){t.compteTiers=e}))}),t.$watch("selectedIndex",function(t,n){void 0!==t&&n!==t&&($("md-tabs-content-wrapper").hide(),e(function(){$("md-tabs-content-wrapper").show()},500))})};ContactArtisanController.$inject=["$scope","$timeout","TabContainer","LxProgressService","FiltersFactory","ContextMenu","edisonAPI","DataProvider","$routeParams","$location","$q","$rootScope","$filter","config","ngTableParams"],angular.module("edison").controller("ContactArtisanController",ContactArtisanController);
var DashboardController=function(a,t,o,r,e,n,s,l,i){var d=this;o._=_,d.openLink=function(a){l.url(a)},t.intervention.dashboardStats({user:a.login}).then(function(a){d.tableParams=new n({count:a.data.weekStats.length,sorting:{total:"desc"}},{counts:[],data:a.data.weekStats}),d.result=a.data})};DashboardController.$inject=["user","edisonAPI","$scope","$filter","TabContainer","NgTableParams","$routeParams","$location","LxProgressService"],angular.module("edison").controller("DashboardController",DashboardController);

angular.module("edison").directive("edisonMap",["$window","Map","mapAutocomplete","Address",function(e,t,a,s){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/autocomplete-map.html",scope:{data:"=",client:"=",height:"@",xmarkers:"=",markerClick:"&",isNew:"=",firstAddress:"="},link:function(n,r,d){n._height=n.height||315,n.map=new t,n.map.setZoom(_.get(n,"client.address")?12:6),n.isNew&&n.map.show(),n.autocomplete=a,n.mapShow=function(){n.mapDisplay=!0},_.get(n,"client.address")?(n.client.address=s(n.client.address,!0),n.map.setCenter(n.client.address)):n.map.setCenter(s({lat:46.3333,lng:2.6})),n.changeAddress=function(e){n.firstAddress=!0,a.getPlaceAddress(e).then(function(e){n.map.setZoom(12),n.map.setCenter(e),n.client.address=e})},n.getStaticMap=function(){if(!_.get(n,"data.client.address.lt")&&!_.get(n,"data.address.lt"))return 0;var t="?width="+Math.round(e.outerWidth*("small"===n.height?.8:1.2));return n.client&&n.client.address&&n.client.address.latLng&&(t+="&origin="+n.client.address.latLng),n.data.artisan&&n.data.artisan.address&&(t+="&destination="+n.data.artisan.address.lt+","+n.data.artisan.address.lg),"/api/mapGetStatic"+t},n.showClientMarker=function(){return n.client.address&&n.client.address.latLng},n.clickOnArtisanMarker=function(e,t){n.markerClick({sst:t})}}}}]);
angular.module("edison").directive("creditCard",["config",function(e){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/credit-card.html",scope:{model:"="},link:function(t,r,c){t.config=e}}}]);
var DevisCtrl=function(e,t,o,r,i,n,a,s,l,u,v,c){"use strict";var d=this;d.config=l,d.dialog=u,d.moment=moment;var f=s.getCurrentTab();if(f.data)var m=f.data;else{var m=new c(v.data);if(f.setData(m),i.id.length>12)d.isNew=!0,m.tmpID=i.id,f.setTitle("DEVIS "+moment(new Date(parseInt(m.tmpID)).toISOString()).format("HH:mm").toString());else if(f.setTitle("DEVIS "+i.id),!m)return a.error("Impossible de trouver les informations !"),r.url("/dashboard"),s.remove(f),0}d.data=f.data;var g=function(e){console.log("=========>",e),e||s.close(f)};d.saveDevis=function(e){return m.produits&&m.produits.length?void m.save(function(t,o){return t?!1:void(e.envoi?(console.log(o),c(o).sendDevis(g)):e.annulation?c(o).annulation(g):e.transfert?c(o).transfert():g())}):a.error("Veuillez ajouter au moins 1 produit")},t.$watch(function(){return m.client.civilite},function(e,t){t!==e&&(m.tva="Soc."==e?20:10)});var D=_.after(5,_.throttle(function(){e.devis.saveTmp(m)},2e3));m.id||t.$watch(function(){return m},D,!0)};DevisCtrl.$inject=["edisonAPI","$scope","$rootScope","$location","$routeParams","LxProgressService","LxNotificationService","TabContainer","config","dialog","devisPrm","Devis"],angular.module("edison").controller("DevisController",DevisCtrl);
angular.module("edison").directive("infoCategorie",["config",function(e){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/info-categorie.html",transclude:!0,scope:{model:"=",change:"&"},link:function(n,t,c){n.config=e,n.callback=function(e){n.model=e,"function"==typeof n.change&&n.change({newCategorie:e})}}}}]);
angular.module("edison").directive("infoClient",["config","edisonAPI",function(e,n){"use strict";return{replace:!0,restrict:"E",templateUrl:"/Templates/info-client.html",transclude:!0,scope:{client:"=model",data:"=",noDetails:"@"},link:function(c,t,i){c.config=e,c.searchPhone=function(e){e.length>2&&n.searchPhone(e).success(function(e){c.searchedPhone=e})["catch"](function(){c.searchedPhone={}})}}}}]);
angular.module("edison").directive("infoCompta",["config","Paiement",function(a,t){"use strict";return{restrict:"E",templateUrl:"/Templates/info-compta.html",scope:{data:"=",displayReglement:"@",dialog:"@",displayPaiement:"@"},link:function(e,n,o){e.config=a;var m=e.data.compta.reglement,p=e.data.compta.paiement;e.data.tva||(e.data.tva="Soc."==e.data.client.civilite?20:10),p.mode||(p.mode=_.get(e.data.sst,"document.rib.file")?"VIR":"CHQ"),e.compta=new t(e.data),m.montantTTC=e.compta.getMontantTTC(),e.$watchGroup(["data.compta.reglement.montantTTC","data.compta.reglement.avoir","data.tva"],function(a,n){var o=(m.montantTTC||0,100*(100/(100+e.data.tva)));m.montant=t().applyCoeff(m.montantTTC,o),p.base||(p.base=_.round(m.montant-(m.avoir||0),2))});var c=function(a,e,n){_.isEqual(a,e)||(n.compta=new t(n.data),p.montant=n.compta.montantTotal)};e.$watch("data.fourniture",c,!0),e.$watchGroup(["data.compta.reglement.montant","data.compta.paiement.base","data.compta.paiement.tva","data.compta.paiement.pourcentage.deplacement","data.compta.paiement.pourcentage.fourniture","data.compta.paiement.pourcentage.maindOeuvre"],c,!0),!e.data.compta.paiement.base&&e.data.compta.reglement.montant&&(e.data.compta.paiement.base=e.data.compta.reglement.montant,e.compta=new t(e.data),p.montant=e.compta.montantTotal)}}}]);
angular.module("edison").directive("produits",["config","productsList","dialog","openPost","LxNotificationService","Intervention","Devis","Combo","edisonAPI",function(t,i,e,n,o,a,r,d,s){"use strict";return{restrict:"E",templateUrl:"/Templates/info-produit.html",scope:{data:"=",tva:"=",display:"@",model:"@",embedded:"="},link:function(e,o,d){var c=e.data;e.config=t,c.produits=c.produits||[],e.config=t,e.produits=new i(c.produits),s.combo.list().then(function(t){e.combo=t.data}),e.Intervention=a,e.Devis=r,e.data.reglementSurPlace||(e.display=!0),e.$watch("data.produits",function(t,i){_.isEqual(t,i)||(e.data.prixFinal=e.produits.total(),e.data.prixAnnonce=e.produits.total())},!0),e.$watch("data.combo",function(t,n){if(t&&!_.isEqual(t,n)){var o=_.find(e.combo,function(i){return i.ref===t});_.each(o.produits,function(t){t.ref||(t.ref=t.desc.toUpperCase().slice(0,3)+"0"+_.random(9,99))}),c.comboText=o.text,c.produits=o.produits||[],e.produits=new i(c.produits)}},!0),e.displayfact=function(){return e.data.produits.length>0||!e.data.reglementSurPlace||e.dsf},e.changeElemTitle=function(t){t.showDesc||(t.desc=t.title)},e.createProd=function(){c.produits.push({showDesc:!1,desc:"",title:"",pu:0,quantite:0})},e.printDevis=function(){n("/api/intervention/printDevis",{data:JSON.stringify(e.data),html:!0})},e.printFactureAcquitte=function(){n("/api/intervention/printFactureAcquitte",{data:JSON.stringify(e.data),html:!0})}}}}]);
var InterventionCtrl=function(t,e,n,i,a,s,o,r,c,l,u,d,f,g,v,m,p,h,w,I,x,D,F){"use strict";var A=this;A.config=I,A.dialog=l,A.autocomplete=h;var L=g.getCurrentTab();if(L.data)var S=L.data;else{var S=new D(x.data);if(S.sst__id=S.sst?S.sst.id:0,L.setData(S),c.id.length>12)A.isNew=!0,S.tmpID=c.id,S.tmpDate=moment.unix(S.tmpID/1e3).format("HH[h]mm"),L.setTitle(S.tmpDate);else{if(S&&S.client.nom){var T=S.client.civilite+S.client.nom;T=T.slice(0,10)}else var T="#"+c.id;if(L.setTitle(T),!S)return d.error("Impossible de trouver les informations !"),r.url("/dashboard"),g.remove(L),0}}c.d&&(S.devisOrigine=parseInt(c.d),S.date={ajout:new Date,intervention:new Date},S.reglementSurPlace=!0,S.modeReglement="CH",S.remarque="PAS DE REMARQUES"),A.data=L.data;var C=_.throttle(function(){L.setTitle(_.template("{{typeof tmpDate == 'undefined' ? id : tmpDate}} - {{client.civilite}} {{client.nom}} ({{client.address.cp}})")(S))},1e3);o.$watch("vm.data.client",C,!0),C(),A.description=new t(S),A.signalement=new e(S),A.contextMenu=new n("intervention"),A.contextMenu.setData(S),A.rowRightClick=function(t,e){0==$(".listeInterventions").has(t.target).length&&(A.contextMenu.setPosition(t.pageX,t.pageY+200),A.contextMenu.open())},Mousetrap.bind(["command+k","ctrl+k","command+f1","ctrl+f1"],function(){return i.open("appurl:","_self"),v.intervention.scan(S.id).then(function(){o.loadFilesList(),d.success("Le fichier est enregistré")}),!1}),o.hideSignalements=function(){o.showSignalement=!1},o.calculPrixFinal=function(){S.prixFinal=0,_.each(S.produits,function(t){S.prixFinal+=t.pu*t.quantite}),S.prixFinal=Math.round(100*S.prixFinal)/100},o.addLitige=function(){l.getText({title:"Description du Litige",text:""},function(t){S.litiges||(S.litiges=[]),S.litiges.push({date:new Date,login:s.user.login,description:t,regle:!1})})},o.smsArtisan=function(){S.smsArtisan(function(t,e){t||S.sst.sms.unshift(e)})},o.clickTrigger=function(t){angular.element(t).trigger("click")},o.$watch("fileupload",function(t){t&&1===t.length&&S.fileUpload(t[0],function(t,e){o.fileUploadText="",o.loadFilesList()})}),o.loadFilesList=function(){v.intervention.getFiles(S.id||S.tmpID).then(function(t){S.files=t.data},console.log)},o.loadFilesList();var M=function(t,e,n){t&&t.envoiFacture&&t.verification?S.envoiFactureVerif(n):t&&t.envoiFacture?S.sendFacture(n):t&&t.envoi===!0?(e.files=S.files,S.envoi.bind(e)(n)):t&&t.annulation?S.annulation(n):t&&t.verification?S.verificationSimple(n):n(null)},P=function(t){o.saveInter=function(){console.log("noope")},S.save(function(e,n){if(e)o.saveInter=P;else{var i=S.files;S=new D(n),S.files=i,M(t,n,function(t){t||g.close(L),o.saveInter=P})}})};o.saveInter=P;var b=function(t){return t.lt+", "+t.lg};A.selectArtisan=function(t,e){return t?void p.all([v.artisan.get(t.id,{cache:!1}),v.artisan.getStats(t.id,{cache:!0})]).then(function(n){S.sst=S.artisan=n[0].data,S.sst.stats=n[1].data,e||(S.compta.paiement.pourcentage=_.clone(S.sst.pourcentage)),v.getDistance(b(t.address),b(S.client.address)).then(function(t){S.sst.stats.direction=t.data}),A.recapFltr={ai:S.sst.id}}):(S.sst=S.artisan=null,!1)},A.showInterList=function(){},A.sstBase=S.sst,S.sst&&A.selectArtisan(S.sst,!0),A.searchArtisans=function(t){_.get(S,"client.address.lt")&&v.artisan.getNearest(S.client.address,t||S.categorie).success(function(t){A.nearestArtisans=t})},A.searchArtisans(),o.$watch(function(){return S.client.address},function(){A.searchArtisans(S.categorie)}),o.$watch(function(){return S.client.civilite},function(t,e){t!==e&&"Soc."===t&&(S.tva=20,d.info("La TVA à été mise a 20%"))});var k=_.after(5,_.throttle(function(){v.intervention.saveTmp(S)},2e3));S.id||o.$watch(function(){return S},k,!0)};InterventionCtrl.$inject=["Description","Signalement","ContextMenu","$window","$timeout","$rootScope","$scope","$location","$routeParams","dialog","fourniture","LxNotificationService","LxProgressService","TabContainer","edisonAPI","Address","$q","mapAutocomplete","productsList","config","interventionPrm","Intervention","Map"],angular.module("edison").controller("InterventionController",InterventionCtrl);
var LpaController=function(e,t,o,n,a,i,l,c,r,s,u){"use strict";var h=this,d=i.getCurrentTab();d.setTitle("LPA"),h.search=n.search(),h.contextMenu=new o("intervention"),h.loadData=function(e){r.circular.show("#5fa2db","#globalProgress"),l.compta.lpa(n.search()).then(function(t){_.each(t.data,function(t){t.list=new u(t.list,e),h.search.d&&h.checkArtisan(t),h.reloadList(t)}),c.lpa=t.data,r.circular.hide()})},h.rowRightClick=function(e,t){l.intervention.get(t.id,{populate:"sst"}).then(function(t){h.contextMenu.setData(t.data),h.contextMenu.setPosition(e.pageX,e.pageY+200),h.contextMenu.open()})},c.lpa||h.loadData(),h.checkArtisan=function(e){e.checked=!e.checked,_.each(e.list.getList(),function(t){t.checked=e.checked})},h.updateNumeroCheque=function(e){var t=c.lpa[e].numeroCheque;if(t)for(var o=e;o<c.lpa.length;o++)"CHQ"===c.lpa[o].list.getList()[0].mode&&(c.lpa[o].numeroCheque=++t)},h.flush=function(){var e=[];_.each(_.cloneDeep(c.lpa),function(t){t.list.__list=_.filter(t.list.__list,"checked",!0),t.list.__list.length&&e.push(t)}),console.log(e),r.circular.show("#5fa2db","#globalProgress"),l.compta.flush(e).then(function(t){l.compta.flushMail(e).then(function(e){console.log("yayaya")})})},t.on("intervention_db_flushMail",function(e){100===e?(c.globalProgressCounter="",r.circular.hide(),h.reloadLPA()):c.globalProgressCounter=e+"%"}),h.selectToggle=function(e,t){return this.search.d?!1:(t.checked=!t.checked,void h.reloadList(e))},h.reloadList=function(e){e.total=e.list.getTotal(),e.total=e.list.getTotal(!0),e.total=e.list.getTotal()},h.reloadLPA=function(){var e=[];_.each(c.lpa,function(t){_.each(t.list.getList(),function(t){t.checked&&e.push(t.id)})}),h.loadData(e)},h.clickTrigger=function(e){window.setTimeout(function(){angular.element(e).trigger("click")},0)},h.onFileUpload=function(e){console.log("swad");var t=_(c.lpa).map(_.partial(_.pick,_,"numeroCheque","id")).value();r.circular.show("#5fa2db","#globalProgress"),l.file.uploadScans(e,{ids:t,date:h.search.d}).then(function(e){r.circular.hide(),console.log("==>",e)})},h.print=function(t){e("/api/intervention/print",{type:t,data:c.lpa})}};LpaController.$inject=["openPost","socket","ContextMenu","$location","$window","TabContainer","edisonAPI","$rootScope","LxProgressService","LxNotificationService","FlushList"],angular.module("edison").controller("LpaController",LpaController);
angular.module("edison").controller("ListeArtisanController",_.noop);
angular.module("edison").controller("ListeDevisController",_.noop);
angular.module("edison").controller("ListeInterventionController",_.noop);
var SearchController=function(r,e,o,a,n){var c=e.getCurrentTab();c.setTitle("Search");var l=this;n.circular.show("#5fa2db","#globalProgress"),r.searchText(o.query).success(function(r){n.circular.hide(),l.data=r}),l.openLink=function(r){a.url(r)}};SearchController.$inject=["edisonAPI","TabContainer","$routeParams","$location","LxProgressService"],angular.module("edison").controller("SearchController",SearchController);
var StatsController=function(e,t,a,r,n,o,s,i,c){"use strict";var l=this;l.tab=t.getCurrentTab(),l.tab.setTitle("Stats");var d=new e;l.yearSelect=[],_.times(d.current.y-d.start.y+1,function(e){l.yearSelect.push(d.start.y+e)}),o.selectedYear=d.current.y,o.$watch("selectedYear",function(e){r.intervention.statsBen({y:e}).then(function(e){console.log(e.data),$("#chartContainer2 > *").remove();var t=dimple.newSvg("#chartContainer2",1070,400),a=new dimple.chart(t,e.data);a.setBounds(60,30,1e3,300);var r=(a.addCategoryAxis("x","mth"),a.addMeasureAxis("y","montant"));r.tickFormat=",.0f",a.addSeries("potentiel",dimple.plot.bar),a.addLegend(60,10,410,20,"right"),a.draw(),o.totalYear={potentiel:0,recu:0},_.each(e.data,function(e){o.totalYear[e.potentiel?"potentiel":"recu"]+=e.montant}),console.log(o.totalYear)})}),o.$watch("selectedDate",function(e){return e&&e.m&&e.y?(s.search("m",e.m),s.search("y",e.y),void r.intervention.statsBen(e).then(function(e){$("#chartContainer > *").remove();var t=dimple.newSvg("#chartContainer",1300,400),a=new dimple.chart(t,e.data);a.setBounds(60,30,1e3,300);var r=(a.addCategoryAxis("x","day"),a.addMeasureAxis("y","prix"));r.tickFormat=",.0f",a.addSeries("recu",dimple.plot.bar),a.assignColor("En Attente","#2196F3"),a.assignColor("Encaissé","#4CAF50"),a.addLegend(60,10,410,20,"right"),a.draw()})):!1}),s.search().m&&(d.current.m=parseInt(s.search().m)),s.search().y&&(d.current.y=parseInt(s.search().y)),l.dateSelect=d.list(),o.selectedDate=_.find(d.list(),d.current)};StatsController.$inject=["DateSelect","TabContainer","$routeParams","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("StatsController",StatsController);
var CommissionsController=function(e,t,o,r,s,n,c,a,l){"use strict";var i=this;i.tab=t.getCurrentTab(),i.tab.setTitle("Coms."),i.xcalc=function(e){return"VT"===e.categorie?1.5:_.round(.01*e.compta.reglement.montant,2)},i.getTotal=function(){var e={com:0,all:0};return _.each(n.list,function(t){e.com+=i.xcalc(t),e.all+=t.compta.reglement.montant||0}),e};var m=new e;n.usrs=_.filter(window.app_users,"service","INTERVENTION"),n.selectedUser=c.search().l||n.usrs[0].login;var u=_.debounce(function(){a.circular.show("#5fa2db","#globalProgress"),r.intervention.commissions(_.merge(n.selectedDate,{l:n.selectedUser})).then(function(e){a.circular.hide(),n.list=e.data,n.total=i.getTotal()})},50);n.$watch("selectedUser",function(e,t){console.log("USER",e),c.search("l",e),u()}),n.$watch("selectedDate",function(e,t){console.log("datechange",e,t),c.search("m",e.m),c.search("y",e.y),u()}),c.search().m&&(m.current.m=parseInt(c.search().m)),c.search().y&&(m.current.y=parseInt(c.search().y)),i.dateSelect=m.list(),n.selectedDate=_.find(m.list(),m.current)};CommissionsController.$inject=["DateSelect","TabContainer","$routeParams","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("CommissionsController",CommissionsController);
var editCombos=function(e,t,o,n,i,r,a){"use strict";var s=this;s.tab=e.getCurrentTab(),s.tab.setTitle("Combos");var c={id:29300,categorie:"EL",description:"RECHERCHE DE PANNE ELCTRIQUE",sst:31,file:[],tva:10,coutFourniture:0,enDemarchage:!1,aDemarcher:!1,reglementSurPlace:!1,prixFinal:0,prixAnnonce:130,modeReglement:"CH",fourniture:[],produits:[],remarque:"Pas de remarque(s)",descriptionTags:[],artisan:{id:31,nomSociete:"SODESEN"},savEnCours:!0,litigesEnCours:!0,litiges:[],sav:[],client:{civilite:"M.",nom:"DELORME",email:"",location:[45.7592,4.77779],address:{n:"19",r:"RUE DES CERISIERS",v:"TASSIN-LA-DEMI-LUNE",cp:"69160",lt:45.7592,lg:4.77779},telephone:{tel1:"0478346059",origine:"0478346059"},prenom:"CHRISTIAN"},facture:{civilite:"M.",nom:"DELORME",email:"",location:[45.7592,4.77779],address:{n:"19",r:"RUE DES CERISIERS",v:"TASSIN-LA-DEMI-LUNE",cp:"69160",lt:45.7592,lg:4.77779},telephone:{tel1:"0478346059",origine:"0478346059"},prenom:"CHRISTIAN"},produits:[],historique:[],comments:[],date:{intervention:"2015-09-17T11:00:00.000Z",envoi:"2015-09-17T09:11:14.000Z",ajout:"2015-09-17T09:11:14.000Z"},login:{ajout:"clement_b",envoi:"clement_b"},status:"ENC"};t.combo.list().then(function(e){n.plSave=e.data,n.pl=_.map(e.data,s.extend)}),s.extend=function(e){var t=_.assign(_.clone(c),e);return console.log(t,e),t},s.save=function(){t.combo.save(n.pl).then(function(e){n.pl=_.map(e.data,s.extend),r.success("Les produits on été mis a jour")},function(e){r.error("Une erreur est survenu ("+JSON.stringify(e.data)+")")})},s.remove=function(e){n.pl.splice(_.findIndex(n.pl,"_id",e._id),1)},s.getInter=function(e){var t=_.clone(c);return t.produits=e.produits,t},s.add=function(){n.pl.push({produits:[],title:"",open:!0,text:""})}};editCombos.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editCombos",editCombos);
var editComptes=function(e,t,o,n,i,s,c){"use strict";var r=this;r.tab=e.getCurrentTab(),r.tab.setTitle("grand Comptes"),t.compte.list().then(function(e){n.pl=e.data,console.log(n.pl)}),r.save=function(){t.compte.save(n.pl).then(function(e){s.success("Les comptes on été mis a jour")},function(e){s.error("Une erreur est survenu ("+JSON.stringify(e.data)+")")})},r.remove=function(e){n.pl.splice(_.findIndex(n.pl,"_id",e._id),1)}};editComptes.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editComptes",editComptes);
var editProducts=function(t,e,o,r,i,n,s){"use strict";var u=this;u.tab=t.getCurrentTab(),u.tab.setTitle("Produits");var c=function(t){return t.single=_(t.desc).deburr().toLowerCase()!==_(t.title).deburr().toLowerCase(),t};e.product.list().then(function(t){r.pl=_.map(t.data,c)}),u.remove=function(t){r.pl.splice(_.findIndex(r.pl,"_id",t._id),1)},u.save=function(){e.product.save(r.pl).then(function(t){r.pl=_.map(t.data,c),n.success("Les produits on été mis a jour")},function(t){n.error("Une erreur est survenu ("+JSON.stringify(t.data)+")")})}};editProducts.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editProducts",editProducts);
var editUsers=function(e,s,t,i,r,n,o){"use strict";var u=this;u.tab=e.getCurrentTab(),u.tab.setTitle("Utilisateurs"),s.users.list().then(function(e){i.usrs=e.data}),u.save=function(){s.users.save(i.usrs).then(function(){n.success("Les utilisateurs on été mis a jour")},function(e){n.error("Une erreur est survenu ("+JSON.stringify(e.data)+")")})},u.remove=function(e){i.usrs.splice(_.findIndex(i.usrs,"_id",e._id),1)}};editUsers.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxNotificationService","socket"],angular.module("edison").controller("editUsers",editUsers);
var telephoneMatch=function(t,e,o,n,l,r,c){"use strict";var a=this;a.tab=t.getCurrentTab(),a.tab.setTitle("TelMatch"),n.__txt_tel=o.__txt_tel,o.getTelMatch=function(){r.circular.show("#5fa2db","#globalProgress"),o.__txt_tel=n.__txt_tel,e.intervention.getTelMatch({q:o.__txt_tel}).then(_.noop,function(){r.circular.hide()})},c.on("intervention_db_telMatches",function(t){console.log("uyau"),o.globalProgressCounter=t+"%"}),c.on("telephoneMatch",function(t){o.globalProgressCounter="",r.circular.hide(),n.resp=t})};telephoneMatch.$inject=["TabContainer","edisonAPI","$rootScope","$scope","$location","LxProgressService","socket"],angular.module("edison").controller("telephoneMatch",telephoneMatch);