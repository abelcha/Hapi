module.exports = function(schema) {
    var _ = require('lodash')
    var moment = require('moment-timezone')
    var request = require('request')
    var async = require('async')
    var V1 = requireLocal('config/_convert_V1');


    schema.statics.dmp = function(req, res) {

        if (!isWorker) {
            return edison.worker.createJob({
                name: 'db',
                model: 'intervention',
                method: 'dmp',
                req: _.pick(req, 'query', 'session')
            })
        }
        var lol = [1026, 106, 115, 1178, 1206, 1211, 1227, 1255, 1260, 1294, 1440, 149, 1511, 1512, 15172, 1520, 1546, 1565, 1669, 1699, 17371, 1739, 1760, 1794, 1795, 1796, 1797, 19444, 19955, 21304, 21431, 21628, 21833, 21994, 21998, 22439, 23148, 23405, 23620, 23649, 23785, 23913, 24031, 24094, 24255, 24272, 24415, 24458, 24689, 25032, 25192, 25251, 25610, 25873, 25909, 26010, 26013, 26079, 26222, 26565, 27630, 27887, 27942, 28005, 28134, 28427, 28474, 28486, 28488, 28683, 28704, 28726, 28730, 28739, 28845, 28876, 28939, 28985, 29007, 29080, 29101, 29125, 29162, 29166, 29256, 29320, 29400, 29452, 29466, 29506, 29582, 29602, 29641, 29643, 29662, 29698, 29701, 29710, 29746, 29778, 29803, 29821, 29825, 29890, 29895, 29903, 29911, 29936, 29961, 29963, 29966, 29983, 29989, 30000, 30008, 30010, 30018, 30019, 30026, 30029, 30040, 30077, 30078, 30079, 30090, 30101, 30107, 30124, 30125, 30126, 30130, 30134, 30142, 30145, 30151, 30154, 30158, 30159, 30160, 30163, 30168, 30179, 30180, 30181, 30181, 30182, 30183, 30184, 30184, 30185, 30186, 30187, 30187, 30188, 30189, 30190, 30191, 30191, 30192, 30193, 30194, 30195, 30196, 30197, 30198, 30199, 30200, 30201, 30202, 30203, 30204, 30204, 30205, 30207, 30210, 30212, 30213, 30214, 30215, 30216, 30217, 30218, 30220, 30221, 30222, 30224, 30225, 30226, 30227, 30228, 30229, 30230, 30231, 30232, 30233, 30234, 30235, 30236, 30237, 30238, 30239, 30240, 30241, 30242, 30243, 30244, 30245, 30246, 30247, 30248, 30249, 30250, 30251, 30252, 30253, 30254, 30255, 30256, 30258, 30259, 30260, 30261, 30262, 30263, 30264, 30265, 30266, 30267, 30268, 30269, 30270, 30271, 30272, 30273, 30274, 30275, 30276, 30277, 30278, 30279, 30280, 30281, 30282, 30283, 30284, 30285, 30286, 30287, 30288, 30289, 30290, 30291, 30292, 30293, 30294, 30295, 30296, 30297, 30298, 30299, 30300, 30301, 30302, 30303, 30304, 30305, 30306, 30307, 30308, 30309, 30310, 30311, 30312, 30313, 30314, 30315, 30316, 30317, 30318, 30319, 30320, 30321, 30322, 30323, 30324, 30325, 30326, 30327, 30328, 30329, 30330, 30331, 30332, 30333, 30334, 30335, 30336, 30337, 30338, 30339, 30340, 30341, 30342, 30343, 30344, 30345, 30346, 30347, 30348, 30349, 30350, 30351, 30352, 30353, 30354, 30355, 30356, 30357, 30358, 30359, 30360, 30361, 30362, 30363, 30364, 30365, 30366, 30367, 30368, 30369, 30370, 337, 37, 555, 581, 635, 781, 85, 981];
        return new Promise(function(resolve, reject) {
            db.model(req.query.model || "intervention").find({
                id: {
                    $in: lol
                }
            }).then(function(resp) {
                _.each(resp, function() {

                    })
                    /*console.log(_.pluck(resp, 'id').join(','))
                    var i = 0;
                    async.eachLimit(resp, 5, function(e, cb) {
                        console.log(i++, resp.length)
                        var v1 = new V1(e);
                        v1.send(function() {
                            cb(null);
                        });
                    }, resolve)*/
            })
        })
    }
}
