<!DOCTYPE html>
<html ng-app="signup">
<head>
    <title>
        Créer un compte
    </title>
<!-- Latest compiled and minified CSS -->
<meta name="viewport" content="width=device-width, initial-scale=1" />  
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.0/animate.min.css">
  <link rel="shortcut icon" href="https://angularjs.org/favicon.ico" />


</head>
    <body ng-controller="SignupController">
     <% include ../Interventions/partials/navbar %> 
            <div class="container">
          <br><br>  <br><br>
<form class="form-horizontal" method="POST">
<fieldset>

<!-- Form Name -->
<legend>Créer un compte</legend>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="prenom">Prenom</label>  
  <div class="col-md-4">
  <input id="prenom" name="prenom" type="text" autocomplete="off" required placeholder="Prenom" class="form-control input-md">
  </div>
</div>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="nom">Nom</label>  
  <div class="col-md-4">
  <input id="nom" name="nom" type="text" autocomplete="off"  required placeholder="Nom" class="form-control input-md">
  </div>
</div>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="login">Login</label>  
  <div class="col-md-4">
  <input id="login" name="login" type="text" autocomplete="off" placeholder="Login" readonly class="form-control input-md">
  </div>
</div>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="email">Email</label>  
  <div class="col-md-4">
  <input id="email" name="email" type="email" autocomplete="off" placeholder="Email Edison" class="form-control input-md">
  </div>
</div>


<div class="form-group">
  <label class="col-md-4 control-label" for="telephone">Telephone</label>  
  <div class="col-md-4">
  <input id="telephone" name="telephone" type="text" autocomplete="off" required placeholder="Telephone portable" class="form-control input-md">
  </div>
</div>

<div class="form-group">
  <label class="col-md-4 control-label" for="ligne">Ligne</label>
  <div class="col-md-4">
  <input id="ligne" name="ligne" type="text" autocomplete="off" placeholder="Ligne Téléphonique Edison" class="form-control input-md">
  <span class="help-block"></span>  
  </div>
</div>
<!-- Select Basic -->
<div class="form-group">
  <label class="col-md-4 control-label" for="service">Service</label>
  <div class="col-md-4">
    <select id="service" name="service" class="form-control"  required >
      <option value="INTERVENTION">Intervention</option>
      <option value="COMPTABILITE">Comptabilité</option>
      <option value="PARTENARIAT">Partenariat</option>
      <option value="118000">118000</option>
      <option value="ADMIN">Admin</option>
    </select>
  </div>
</div>

<!-- Multiple Checkboxes (inline) -->
<div class="form-group">
  <label class="col-md-4 control-label" for="Root">Root</label>
  <div class="col-md-4">
    <label class="checkbox-inline" for="Root">
      <input type="checkbox" name="root" id="root" value="1">
      L'utilisateur aura tous les droits sur son service
    </label>
  </div>
</div>

</fieldset>

<!-- Button -->
<div class="form-group">
  <label class="col-md-offset-1 col-md-4 control-label" for="envoyer"></label>
  <div class="col-md-4">
    <button id="envoyer" name="envoyer" type="submit" class="btn btn-success">Envoyer l'invitation</button>
  </div>
</div>
</form>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="/remarkable-bootstrap-growl/bootstrap-notify.min.js"></script>


<script>
/*var app = angular.module('signup', [])
.controller('SignupController', ['$scope',function($scope) {

}]);
*/
var updateLogin = function() {
    if ($('#prenom').val() == "" || $('#nom').val() == "")
      $('#login').val("");
    else {
      var login = $('#nom').val().substring(0,6) + '_' + $('#prenom').val()[0];
      $('#login').val(login)
    }
} 


function notify(title, message, type) {
 $.notify({
    title: title,
    message: message
  }, {
    animate: {
      enter: 'animated bounceInDown',
      exit: 'animated bounceOutUp'
    },
    template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
              '<img data-notify="icon" class="img-circle pull-left">' +
              '<span data-notify="title"><strong>{1}</strong></span><br>' +
              '<span data-notify="message">{2}</span>' +
              '</div>',
    type:type
  }); 
}

$('form').submit(function(event) {
  event.preventDefault();
  $.ajax({
    url: '/signup',
    type: 'POST',
    dataType: 'json',
    data: $(this).serialize(),
  })
  .fail(function(data) {
    notify('Erreur', data.flash, "Une erreur est survenu, contacté l'administrateur");
  })
  .success(function(data) {
    if (data.status == 'ERR')
      notify('Erreur', data.flash, 'danger');
    else {
      notify('Succes', data.flash, 'success');
     window.setTimeout(function() { window.history.back() }, 800)
    }
  });

});

$( "#nom" ).keypress(updateLogin);
$( "#prenom" ).keypress(updateLogin);
//$( "#nom" ).change(updateLogin);
</script>
    </body>
</html>
